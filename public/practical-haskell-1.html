<!DOCTYPE html>

<html lang="en">
<head><meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Practical Haskell 1</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>

<!-- Load mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML-full,Safe"> </script>

<link href="ph_1/xstatic/css/jptr_nb_1.css" rel="stylesheet">
<link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
<link href="ph_1/xstatic/css/pimping.css" rel="stylesheet">

<script src="ph_1/xstatic/js/jptr_nb_1.js" cross-origin="anonymous" type="module"></script>
<script src="ph_1/xstatic/js/components.js" cross-origin="anonymous" type="module"></script>
<script src="https://unpkg.com/d3@7.8.5/dist/d3.min.js" cross-origin="anonymous" type="module"></script>

<!-- End of mermaid configuration -->
</head>
<body class="jp-Notebook" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">
<main>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=bf302a87-2e65-4f72-9d21-8ba9a62dd062">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><b style="color: red">Run these 4 minimized cells to load the styles &amp; scripts to pimp the notebook and execute the full demo.</b></p>
</div>
</div>
</div>
</div>

<div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=74373fc5-3da7-4e5c-bfd6-8a45ff8d521e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<!-- HD -->
<div class="lm-Widget jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-active jp-mod-selected" aria-label="Code Cell Content with Output" data-windowed-list-index="1"><div class="lm-Widget jp-CellHeader jp-Cell-header"></div><div class="lm-Widget lm-Panel jp-Cell-inputWrapper"><div class="lm-Widget jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"><div class="jp-Collapser-child"></div></div><div class="lm-Widget jp-Placeholder jp-InputPlaceholder"><div class="jp-Placeholder-prompt jp-InputPrompt"></div><div class="jp-Placeholder-content" title="Click to expand"><div class="jp-Placeholder-contentContainer"><span class="jp-PlaceholderText">import qualified IHaskell.Display as ID</span><span class="jp-MoreHorizIcon f1m36mmi"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" data-icon="ui-components:ellipses" data-icon-id="88e8f725-e5b3-4965-a977-a3b281da555f"><g class="jp-icon3" fill="#616161"><circle cx="5" cy="12" r="2"></circle><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle></g></svg></span></div></div></div></div><div class="lm-Widget jp-CellResizeHandle"></div><div class="lm-Widget lm-Panel jp-Cell-outputWrapper"><div class="lm-Widget jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser"><div class="jp-Collapser-child"></div></div><div class="lm-Widget jp-OutputArea jp-Cell-outputArea" style=""><div class="lm-Widget lm-Panel jp-OutputArea-child"><div class="lm-Widget jp-OutputPrompt jp-OutputArea-prompt"></div><div class="lm-Widget jp-RenderedHTMLCommon jp-RenderedHTML jp-mod-trusted jp-OutputArea-output" data-mime-type="text/html"><script src="ph_1/xstatic/js/components.js" cross-origin="anonymous" type="module"></script></div></div><div class="jp-OutputArea-promptOverlay" title="Toggle output scrolling"></div></div></div><div class="lm-Widget jp-CellFooter jp-Cell-footer"></div></div>
<!-- HD-END -->
</div>
</div>

<div class="lm-Widget jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" aria-label="Code Cell Content" data-windowed-list-index="2"><div class="lm-Widget jp-CellHeader jp-Cell-header"></div><div class="lm-Widget lm-Panel jp-Cell-inputWrapper"><div class="lm-Widget jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"><div class="jp-Collapser-child"></div></div><div class="lm-Widget jp-Placeholder jp-InputPlaceholder"><div class="jp-Placeholder-prompt jp-InputPrompt"></div><div class="jp-Placeholder-content" title="Click to expand"><div class="jp-Placeholder-contentContainer"><span class="jp-PlaceholderText">-- Basic CORS parameter definitions</span><span class="jp-MoreHorizIcon f1m36mmi"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" data-icon="ui-components:ellipses" data-icon-id="88e8f725-e5b3-4965-a977-a3b281da555f"><g class="jp-icon3" fill="#616161"><circle cx="5" cy="12" r="2"></circle><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle></g></svg></span></div></div></div></div><div class="lm-Widget jp-CellResizeHandle"></div><div class="lm-Widget lm-Panel jp-Cell-outputWrapper"><div class="lm-Widget jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser"><div class="jp-Collapser-child"></div></div><div class="lm-Widget jp-OutputArea jp-Cell-outputArea"><div class="jp-OutputArea-promptOverlay" title="Toggle output scrolling"></div></div></div><div class="lm-Widget jp-CellFooter jp-Cell-footer"></div></div>

<div class="lm-Widget jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" aria-label="Code Cell Content" data-windowed-list-index="3"><div class="lm-Widget jp-CellHeader jp-Cell-header"></div><div class="lm-Widget lm-Panel jp-Cell-inputWrapper"><div class="lm-Widget jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"><div class="jp-Collapser-child"></div></div><div class="lm-Widget jp-Placeholder jp-InputPlaceholder"><div class="jp-Placeholder-prompt jp-InputPrompt"></div><div class="jp-Placeholder-content" title="Click to expand"><div class="jp-Placeholder-contentContainer"><span class="jp-PlaceholderText">-- Wrap Json Web Keys for JWT in easy-to-use functions for main logic.</span><span class="jp-MoreHorizIcon f1m36mmi"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" data-icon="ui-components:ellipses" data-icon-id="88e8f725-e5b3-4965-a977-a3b281da555f"><g class="jp-icon3" fill="#616161"><circle cx="5" cy="12" r="2"></circle><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle></g></svg></span></div></div></div></div><div class="lm-Widget jp-CellResizeHandle"></div><div class="lm-Widget lm-Panel jp-Cell-outputWrapper"><div class="lm-Widget jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser"><div class="jp-Collapser-child"></div></div><div class="lm-Widget jp-OutputArea jp-Cell-outputArea"><div class="jp-OutputArea-promptOverlay" title="Toggle output scrolling"></div></div></div><div class="lm-Widget jp-CellFooter jp-Cell-footer"></div></div>

<div class="lm-Widget jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" aria-label="Code Cell Content" data-windowed-list-index="4"><div class="lm-Widget jp-CellHeader jp-Cell-header"></div><div class="lm-Widget lm-Panel jp-Cell-inputWrapper"><div class="lm-Widget jp-Collapser jp-InputCollapser jp-Cell-inputCollapser"><div class="jp-Collapser-child"></div></div><div class="lm-Widget jp-Placeholder jp-InputPlaceholder"><div class="jp-Placeholder-prompt jp-InputPrompt"></div><div class="jp-Placeholder-content" title="Click to expand"><div class="jp-Placeholder-contentContainer"><span class="jp-PlaceholderText">-- Create some Runtime parameters for neater main logic.</span><span class="jp-MoreHorizIcon f1m36mmi"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" data-icon="ui-components:ellipses" data-icon-id="88e8f725-e5b3-4965-a977-a3b281da555f"><g class="jp-icon3" fill="#616161"><circle cx="5" cy="12" r="2"></circle><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle></g></svg></span></div></div></div></div><div class="lm-Widget jp-CellResizeHandle"></div><div class="lm-Widget lm-Panel jp-Cell-outputWrapper"><div class="lm-Widget jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser"><div class="jp-Collapser-child"></div></div><div class="lm-Widget jp-OutputArea jp-Cell-outputArea"><div class="jp-OutputArea-promptOverlay" title="Toggle output scrolling"></div></div></div><div class="lm-Widget jp-CellFooter jp-Cell-footer"></div></div>


<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c0becb75-e545-44fc-a75d-6f2e5a4f3daf">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet"/>
<div>
<h1>
Full Stack Deep Dive: What's the deal with Haskell?
</h1>
</div>
<div class="content flex py-2">
<div>
<p><span style="float: left; padding: 5px 10px 0px 0px;"><img alt="No description has been provided for this image" class="rounded" src="https://www.haskell.org/img/haskell-logo.svg" width="200"/></span>
is one of those languages that senior developers will have heard mysterious tales of. But as most stuff of legends, there are few people that can confirm or contradict the tales based on practical experience with Haskell. That is unfortunate: it makes a lot of sense for full-stack developers and CTO to count Haskell familiarity as part of their standard skillset.
</p>
<p>Why Haskell now? Simpler parts of software development projects are today primarely implemented by hoards of junior and mid-range coders that use Javascript, Python, Java and C#, together with their respective frameworks. Overall scarcity of programmers influence the rest of the application architecture, forcing it to match closely the same ecosystems. The significant change coming is <b>statistical programming</b> by large language models (LLMs), that will soon generate automatically most of the simpler code. Thus simple code is about to disappear from human developers sight, and at the same time a significant part of the coding community is about to disappear! Very likely this will remove a lot of the constraints on the ecosystems to develop in. Yet LLMs are not likely to solve the design of complex applications and the code evolution over projects lifespan for quite some time. Typical key issues software developers will still need to deal with in the foreseable future are:
<ul>
<li>bug-free logic,</li>
<li>assessable information security,</li>
<li>distributed execution</li>
<li>efficient evolution of complex data structures,</li>
<li>continuous integration of evolving code</li>
</ul>
These complex problems call for tools that aren't popular because they are <i>easily accessed</i> but rather because they are absolutely optimal no matter their learning curve. Senior developers and CTOs will be free from having to work with and support current simplistic ecosystems and instead apply their efforts and skills at mastering the powerful but currently exoteric solutions such as Elixir, Haskell, OCaml, Rust, etc.  I expect Javascript, Python and the other <i>beginner friendly</i> ecosystems to transition to runtime environment for AI-generated code by tools like <a href="v0.dev">Vercel's V0</a>, until AI-optimized runtime environments come along.
</p>
<p>
That's why I believe Haskell's moment to shine is coming up.  In my experience, it's THE tool to reach the Zen of programming, to get a balance between theory and real-life implementations, to achieve quick prototyping and long-term software designs, to use time-tested techniques and innovative ideas. I've not come to that reflection overnight... I have over 40 years of software development experience under my belt, during which I've worked with many many programming ecosystems in many many kind of software development projects with many many types of people. I got curious about Haskell over 10 years ago, slowly integrated its ecosystem into my daily workflow and especially over the last 5 years I've been able to use it efficiently for modern web application development.
</p>
<div class="float-right rounded"><img alt="No description has been provided for this image" class="rounded-full shadow-md shadow-gray-700" height="400" src="ph_1/xstatic/img/lib_1.png" style="float: right; margin: 0px 10px 0px 10px;" width="300"/></div>
<div><p>Hopefully you are now curious about Haskell... I wrote this Jupyter notebook to help you bootstrap, to get a feel for the applicability of the Haskell ecosystem in modern software development as quickly as possible. My goal is to show you that this is not wishful thinking, but that if you do spend time learning Haskell you'll be able to apply this knowledge in daily situations for getting the job done efficiently.</p>
<p>This introduction to Haskell in a Jupyter notebook does away with the need to set up a development environment, to compile and run a first simple piece of code. Instead the notebook is loaded with code that  works using a Haskell interpreter <i>kernel</i> for Jupyter. That gives you the quickest path to experiencing interactively the Haskell ecosystem to implement a <em>normal, modern, efficient</em> web app based, using HTMX and Tailwind on the frontend, server-side rendering of templates filled with data provided by SQL queries, and low-latency websocket communications on the backend.  Plus security, distributed computing, 3rd party APIs, Javascript/C++/Python integration, etc.
</p>
<p>Using a Jupyter notebook also means that <b style="color: red">you need to run all cells in order to get code to work out</b>, and that some issues may happen with CSS styling, HTML rendering and sub-process port management. You will get a better experience by using <a href="https://hub.docker.com/repository/docker/whatsupfudd/demo1/general"> a Docker image containing all notebook resources</a> on your own environment.
</p>
<p>If I manage to get you interested in Haskell with this notebook, your next step will be to develop in your own environment. It is actually easy to get the Haskell ecosystem on your local machine, read some of the many resources to learn how to write Haskell code with <a href="https://github.com/haskell/haskell-language-server"><i>language server</i></a> and <i>Copilot</i> support. You'll quickly be creating software through the <code>edit -- compile -- run -- observe</code> loop and reap the benefits of the ecosystem. Further more I hope to grow the <b><a href="https://www.whatsupfudd.com">What's up, FUDD?</a></b> community as a group focused on improving the Haskell ecosystem for web applications.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c3c673a6-0580-49f6-80e3-b9684946d13d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<div class="grid justify-items-stretch bg-gray-700 hover:bg-orange-100 transition ease-in-out duration-150 rounded-md" style="margin: 0em 0em 2em 0em;">
<img alt="No description has been provided for this image" class="rounded-full justify-self-center animation-bounce" src="ph_1/xstatic/img/lib_2.png" style="display: block; margin-left: auto; margin-right: auto; width: 50%" width="250"/>
</div>
<div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c94f265a-f1c4-4bf2-b96f-421b41d22138">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1>Basic ideas about Haskell</h1>
The following elements of the Haskell programming language influence the design of libraries and how one codes in its ecosystem:

<ul>
<li>it has a simple and clean syntax: quick to learn with little decorations and high readability.</li>
<li>it is properly functional: Haskell guts are based on <a href="!https://en.wikipedia.org/wiki/System_F">System F</a>, the foundation of high-order functional logic,</li>
<li>it enforces immutability: a variable is assigned only once (or as the functional people would say: <em>a term is bound to a name once only</em>),</li>
<li>it has a strong support for pure logic without side effects: logic provided with the same inputs will always produce the same results, as theoritical computing would have it,</li>
<li>it has a consistent support for practical computing: breaking the principles just mentioned for real-life software is cleverly integrated in the framework,</li>
<li>it has a very powerful typing system that is also strongly enforced: anything is typed (even types themselves!), type matching must be exact for code to be valid, there are types of types, type manipulations, etc,</li>
<li>the typing system is powerful enough that it disappears from normal use: you write your code without types (a la JS) and still everything turns out to be consistant and mostly bug-free (unlike JS!),</li>
<li>meta-programming is easily accessed: the GHC compiler contains a VM and can execute some code while it compiles some other code, leading to on-the-fly code generation, value derivation, interaction with the outside world, etc,</li>
<li>it is extendable: the compiler is introspective and open to express domain-specific ideas, eg embedded SQL,</li>
<li>it is opened to other languages: a powerful FFI provides an easy integration of existing C/C++ code,</li>
<li>it is optimizable: all kind of directives are available to tune the compiler to produce efficient machine code, and Linear Types can define very performant memory management like in Rust.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=4eaf2afa-dbad-4e7d-b35b-c83f8188ee01">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Additionally the GHC runtime system brings the following to the table:</p>
<ul>
<li>it puts an emphasis on compiled binaries, but you'll see with this notebook that it works just fine in interpreted mode,</li>
<li>it provides a memory-management support (a garbage collector) that is very configurable,</li>
<li>it is lazy: by default functions are not executed if they don't need to; on the upside this can provide significant optimizations, and on the downside it can create significant memory requirements,</li>
<li>it is parallel: the concept of multi-threading is built-in, and thread-safe code execution can happen in all kind of levels of parallelism depending on the underlying hardware,</li>
<li>it is debuggable: the interpreter is the main way of debugging Haskell code, but GDB is also able to step through logic execution,</li>
<li>it is observable: execution performance is recordable, with statistics providing valuable insights on optimizing execution time and/or resources utilisation, and the heap can be introspected by a socket-connected debugger,</li>
<li>it is self-contained: binaries can be statically linked, so a single executable file is all that's needed to run an application.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=fedd09b6-2ab5-493b-9d45-3d37e373aa80">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1>Reading Haskell code</h1>
Ok, enough with the overview, let's get practical. But before writing a minmal web app, you'll need to be able to read some Haskell code:

<div class="grid justify-items bg-gray-700 hover:bg-orange-100 rounded-md" style="padding:10px 0px 10px 0px">
<img alt="No description has been provided for this image" class="rounded-full justify-self-center" src="ph_1/xstatic/img/soft_linlog_1.png" style="display: block; margin-left: auto; margin-right: auto; width: 70%"/>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=13739829-213b-43c4-b477-6fecd353f5d1">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Just kidding, it's pretty simple. The main idea with Haskell syntax is that in general you write code in the following forms:</p>
<ul>
<li>function applications: <code>functionX argA argB</code></li>
<li>bindings: <code>left_hand_side = right_hand_side</code></li>
<li>access to existing logic (packages): <code>import AGreatPackage.BestModule (fctA, fctB)</code></li>
<li>name space creation (modules): <code>module TopNamespace.SubNameSpace (exportA, exportB)</code></li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=6c561a85-3820-4a26-8504-5aced0296aef">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Let's start with some baby code. Here is a infix function application:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=fb1dcd9f-b25e-4fb1-8cb8-3323f192cdc6">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [ ]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>3</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=e15f8719-7df1-4f3f-8ee1-8cdc6e8b4dad">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>This is what one expects: the <code>+</code> function is applied to 1 and 2.  In other language the <code>+</code> character may be a reserved symbol, but in Haskell it's just another function that has been defined in a core library. You'll see that some developers really enjoy this freedom of expression and come up with very original names, like <code>.:.:</code> or <code>:&gt;&gt;:</code>.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c078576e-273b-488a-9d0e-c4a7e85446d1">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Any function can be called in prefix or infix mode, so the previous line is equivalent to:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=1f0b031c-fedf-4742-8133-98a2e5ff30c9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [2]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="p">(</span><span class="o">+</span><span class="p">)</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>5</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=2c6d2910-2ffb-437c-9c19-6e394e2eda60">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Another typical example of baby code is the function application of the <i>is-equal</i> function:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=796aa74b-1bef-4962-8acc-92f66602ab14">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [8]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>False</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c1134775-9345-43c9-8284-1ec02d631ef0">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>That function returned the Boolean literal <code>False</code>.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=bbda1447-aa06-4578-9d4c-fe6992f19bcf">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Moving on, there's the right side binding to the left side, which in other languages is typically an assignment statmement.  The baby code version of that is:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=c7057ce9-d1c9-4027-8be8-ef9a0fa55bdb">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [9]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">x1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=eb6e95c5-b1cb-4237-a577-4ff742bfaf88">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>That simply says that <code>x1</code> takes the value of the <code>+</code> function applied to values <code>2</code> and <code>3</code>.  It's almost really simple, and in a non-lazy language you'll expect this to be converted to 6.  But Haskell is lazy, so deep down in the execution system it means that <code>x1</code> is going to be stay the unevaluated term <code>2 + 3</code> until <code>x1</code> needs to be used. Based on this example you may think it is completely useless, but if instead the code of <code>x1</code> takes hour of CPU time to return a value or terabytes of RAM to perform, it's great that none of these resources gets utilized until it's necessary to have a resulting value.  And as laziness is not always welcomed, it is possible to get immediate evaluation on an expression basis.</p>
<p>As Haskell is a functional language, remember that <code>x1 = 2 + 3</code> is actually a function definition where <code>x1</code> takes no argument and works with constants.  In a pure immutable functional language, there are no variables, just function applications and term bindings...</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=eba1e52a-430a-47ab-a11e-c287f3ab9aa8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The non-functional programmer will be more comfortable with the following function definition:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=74083c34-91f6-4ce5-8acc-b7baf0d6706d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [10]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">incByOne</span><span class="w"> </span><span class="n">arg_1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">arg_1</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=ee972a64-acf5-4c66-8cf9-3508ddbdb0e5">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>This code defines a function called <code>incByOne</code> which takes one argument.  When executed, it will add 1 to the <code>arg_1</code> argument, no surprise here.</p>
<p>In Haskell the function's arguments are simply listed one after the other. There is no need for other decoration in the syntax. Here's a function that takes 2 arguments, and adds them together:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=93edcabc-5ed6-412d-81a7-131400ecfc8a">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [11]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">yetAnotherAdd</span><span class="w"> </span><span class="n">arg_1</span><span class="w"> </span><span class="n">arg_2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">arg_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">arg_2</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=cebf1436-ec7f-46b5-a90c-445450212894">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Using that function is also baby code:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=636b8d5b-6fa0-4505-ad40-46d4438c6ce9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [12]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">yetAnotherAdd</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>3</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=3ee46340-1685-4b67-8a46-e6f842798f33">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Lambda notation is bread and butter in Haskell, so that function can be rewritten with the following syntax:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=bde894f8-0701-4c4a-970b-b7c0fd62bba3">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [13]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">aLambdaVersion</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nf">\</span><span class="n">arg_1</span><span class="w"> </span><span class="n">arg_2</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">arg_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">arg_2</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><div class="suggestion-name" style="clear:both;">Redundant lambda</div><div class="suggestion-row" style="float: left;"><div class="suggestion-warning">Found:</div><div class="highlight-code" id="haskell">aLambdaVersion = \ arg_1 arg_2 -&gt; arg_1 + arg_2</div></div><div class="suggestion-row" style="float: left; margin-left: 10em;"><div class="suggestion-warning">Why Not:</div><div class="highlight-code" id="haskell">aLambdaVersion arg_1 arg_2 = arg_1 + arg_2</div></div><div class="suggestion-name" style="clear:both;">Avoid lambda</div><div class="suggestion-row" style="float: left;"><div class="suggestion-warning">Found:</div><div class="highlight-code" id="haskell">\ arg_1 arg_2 -&gt; arg_1 + arg_2</div></div><div class="suggestion-row" style="float: left; margin-left: 10em;"><div class="suggestion-warning">Why Not:</div><div class="highlight-code" id="haskell">(+)</div></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=139076e4-1a0a-4898-b8e3-57d2225b828d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>You should see some message from GHC suggesting you avoid lambda. That's because defining a named function with the lambda notation is not as clear to read, so the wise men managing Haskell elegance will let you know you're better using the first form.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=e5402906-4a71-4194-bd46-068871a642eb">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Finally Haskell does all the expected tricks with curryfication:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=d42fae99-87fe-4fe0-995e-ddd8937fbf51">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [14]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">addSynonym</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="p">)</span>
<span class="nf">addTwo</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>

<span class="nf">addSynonym</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">3</span>
<span class="nf">addTwo</span><span class="w"> </span><span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>5</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>5</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d27ad65d-53ec-4b77-9efb-29022757a520">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Here <code>addSynonym</code> is a function with two implied arguments as it calls the <code>+</code> function (in prefix mode). The <code>addTwo</code> function has one implied argument, since the <code>+</code> function is provided with a value. Advanced Haskell programmers will often use the curryfication as in <code>addTwo</code> to remove redundancy in code, but I often find that it makes it harder to read and I prefer some redundancy.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=318d2000-9718-4f37-a6e5-f55b359084e7">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Note that up to now we haven't seen any typing anywhere, just like in Javascript.  Given Haskell is strongly-typed and has a very powerful typing system, where are all the types?</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=88b14894-4eca-4d64-8299-3af76be1bfc3">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Ok, let's introduce some typing notation.  First, a term can be given a specific type. Taking a previous example, we can specify that the <code>2 + 3</code> calculation will result in an <code>Int</code> value (the <code>::</code> mean <i>of type</i>):</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=3b412cd9-bc05-4af2-be4b-90be2ae49f13">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [15]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">x1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=03d79176-8e6d-4ef3-a79c-1279d50ef1d6">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>That tells the compiler that the right-hand-side value is of type <code>Int</code>.  The compiler will check that the <code>+</code> function and the <code>2</code> and <code>3</code> values all make sense, and then also give <code>Int</code> type to <code>x1</code>.  This is pretty obvious to anyone who has experience with typed languages. But given that Haskell typing system supports polymorphism, it means that <code>+</code> may exist for many different types (and it does!), and <code>2</code> and <code>3</code> literals may be representing different kind of intergers (16 bits, 32 bits, unbounded, ...). It is possible that in the first definition of <code>x1</code>, the resulting type was a more general kind of integer. Adding <code>:: Int</code> will lock in the meaning of <code>x1</code> and force its uses to be limited to <code>Int</code> applications.</p>
<p><strong>Important Note</strong> Haskell enforces that type names must start with an upper-case letter, while variable and function names must start with a lower-case letter or a non-letter symbol such as <code>+</code>.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=f314e90b-f398-4933-a92d-34601a55e1e1">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Programmers usually prefer to provide the typing information for the right-hand-side, as in:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=995b5a62-413d-47c9-823e-894620d46c14">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [16]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">x1</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span>
<span class="nf">x1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=3dcbdddb-8bd1-4bc5-89f2-4a5abf6a5aec">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>That looks more like a good old C or Java variable definition, where the variable is first declared together with a type, and the value that it represents is provided later and must be of the same type.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=92ae60bb-8d7d-41e1-9f4c-20b416914994">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>While we can often disregard typing information, typically Haskell programmers will specify the typing of functions as a way to documentent the intent of the code as well as locking in certain constraints on the arguments.</p>
<p>For example the following piece of code starts by clearly stating the intent of the developer on what the <code>showOneMore</code> function is expecting to work with: an <code>Int</code> argument (we know it's an argument because it's before the <code>-&gt;</code>). The <code>String</code> part specifies that it will return a <code>String</code> value. When reading code, that's often all the information required to move on and the logic of the function can be skipped.  Most popular languages these days have typing information as part of its argument specification, but if you think about it, the Haskell approach is simpler and more consistent in a typing-is-optional situation...</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=0b73db10-09cb-4532-950f-43bdcd3fe3aa">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [17]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">showOneMore</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">String</span>
<span class="nf">showOneMore</span><span class="w"> </span><span class="n">arg_1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">arg_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=319521b7-1f0a-4ab9-bbe2-8010cf701d9f">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The typing for a function with two arguments is simply going to list them all, separated by arrows:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=19a61354-f60e-4bc3-8a71-55191e7f396c">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [18]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">yetAnotherAdd</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Int</span>
<span class="nf">yetAnotherAdd</span><span class="w"> </span><span class="n">arg_1</span><span class="w"> </span><span class="n">arg_2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">arg_1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">arg_2</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=ec0b830c-01d7-4ee1-b4ce-0159595caceb">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Why the arrows as separator and the lack of difference between arguments and the result in the typing syntax? The arrows are from the deep theoritical foundations of Haskell: lambda calculus has used that notation for ... <a href="https://en.wikipedia.org/wiki/Lambda_calculus">a long time</a>.  The lack of difference between arguments and result is again consistency and simplicity of syntax: a function that takes no argument is types as <code>:: Result_Type</code> (like the <code>x1</code> seend before), a function that takes an argument will add a type and arrow before that, which looks like <code>Arg_Type -&gt; Result_Type</code>, and more arguments will add more <code>Arg_Type -&gt;</code>. Note that curryfication goes the other way: for each value passed to a function, there's one less <code>Arg_Type -&gt;</code> to deal with.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=61e02914-03e2-4a5e-a14e-d1ea2de3ce7f">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 class="year">The <i>Hello World</i> example.</h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=f2567e67-5da7-43d0-85a6-016b1ec0c571">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>At this point there's more than enough syntax knownledge to move on to the proverbial 'Hello World' example.  First, here's the code:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=0244dce1-3725-48c3-9405-d51db5d28563">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [19]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">main</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="n">putStrLn</span><span class="w"> </span><span class="s">"Hello World!!"</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=ffe60828-6ddb-48f7-8661-0292efc557dc">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Haskell runtime follows the long tradition of the <code>main</code> function being the entry point for an application.</p>
<p>The <code>putStrLn</code> function is part of the basic Haskell library; it takes a string (which is provided in literal form by using the double-quote character), and sends it to the <em>stdout</em> of the running program.</p>
<p>In the Jupyter Notebook, we can simply call the function and the Haskell kernel will redirect its <em>stdout</em> to be the output in the result cell:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=e08ad2c3-6432-440d-b956-6af226439494">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [20]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">main</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Hello World!!</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=4ef195fc-8779-4974-931e-dd126075b7ea">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2 class="year">Accessing existing logic</h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=5b31ed7e-2a73-4379-8cf0-cffb09482917">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Moving forward, let's introduce syntax to access existing code units: the <code>import</code> statement.  It instructs the compiler to go fetch code from some other place.  That was a simple concept in the good old days, but today it means resolving lots of sources and constraints.  In Haskell, a unit of code is called a <strong>module</strong>, and it is a hierchical concept. Modules are stored in <strong>packages</strong>, which is the equivalent of libraries for C++, crates for Rust, packages (yeah!) for Javascript, and so on.  The GHC compiler provided some package management tools early on (<em>ghc-pkg</em>); then more and more features have come up in that area over the years (<em>cabal</em>, <em>stack</em>, ...).  <a href="https://stackage.org">Stackage</a> is the main site for curated package distributions and <a href="https://hackage.haskell.org">Hackage</a> is the largest site. There are much less efforts in Hackage to curate the quality and stability of its content.</p>
<p><strong>Important Note</strong> Haskell enforces that module names start with an upper-case letter, just like types.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=bf1aa00d-9ce5-42c3-8c6d-982238cde568">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Bringing in the entire content of a module in the current code namespace is the simplest form of <code>import</code>:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=d4becc71-8004-4e92-a746-8ae408215c8b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [21]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="nn">Data.Char</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=82e0240c-9fb3-4cb5-8fb6-6057f663ab50">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>That code means that everything defined in the <code>Data.Char</code> package is now part of the current code namespace. Of course that leads to collisions and conflicts, so it is typical to control what is brought in the namespace and also add some prefix to what is imported, as in:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=9c8790df-43cc-49f6-9904-fb310e1deb51">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [22]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Text.Blaze.Html5</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">H</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Text.Blaze.Html5.Attributes</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">A</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=f694e365-54e3-4f49-9362-6838ef54ec1e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>This code adds two modules to the current code namespace but we must use the prefix <em>H</em> and <em>A</em> to access whatever is defined within these two modules.</p>
<p>It turns out that these two modules are part of the <a href="https://hackage.haskell.org/package/blaze-html">Blaze</a> package, which provides all elements and attributes of HTML as functions of the same name.  That's useful in web application development, so let's use that package.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=10f97f0c-2b63-49cc-9232-50b32f6b4afb">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Wait, I forgot two other syntax elements that you must know about.  First, the oh-so-powerful <strong>comment</strong>!  Same-line comments are written by prefixing them with two dashes, while the curly brackets and dashes provide multi-line comments, as in:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=72d647fb-2b46-4cda-ad00-6881a8103af8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [23]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="c1">-- Nothing impacts the compiler here...</span>
<span class="cm">{- and</span>
<span class="cm">  same</span>
<span class="cm">  here</span>
<span class="cm">-}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d493a4b8-1389-404c-ab86-3327a857999e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The second syntax element to know of is for providing compiler directives (pragmas): the GHC compiler has adopted a special version of curly-bracket comment, and we'll use that right now to turn on a processing mode that unfortunately isn't on by default, the <em>Overloaded String</em> mode:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=896aa65f-01e7-4eaa-ae2b-a789b56a8af7">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [24]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="cm">{-# LANGUAGE OverloadedStrings #-}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=996a3c36-88e1-46e8-ac43-a787a95b6813">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Adding processing modes when using the interpreter can also be done with an internal command:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=44748885-b625-4b00-8b3d-5661b08ab4f8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [25]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kt">:</span><span class="n">set</span><span class="w"> </span><span class="o">-</span><span class="kt">XOverloadedStrings</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=867028bf-d85d-45a4-a125-ec3629dd4efb">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>OverloadedStrings</code> mode means that the compiler will do polymorphism resolution of string literals.  In practical terms it means we can let the compiler figure out the right logic to transform a string literal into a <code>Html</code> value that Blaze wants for most of its DOM building functions.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=283d2b82-f073-477d-88a5-53d9b5390005">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Ok, now let's use Blaze functions to send some HTML into the notebook cells (remember, the <strong>H</strong> and <strong>A</strong> prefix are required by choice):</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=1bedd5c5-fa7e-4139-8943-a93f8c91fd37">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [26]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"text-red-400 bg-gray-700"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">style</span><span class="w"> </span><span class="s">"border-style: groove; border-color: red"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">p</span><span class="w"> </span><span class="s">"This is an example of creating DOM elements similarly to JSX or (better) Elm..."</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">style</span><span class="w"> </span><span class="s">"display: block; margin-left: auto; margin-right: auto; width: 30%"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">img</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="s">"https://pbs.twimg.com/media/F6ezdRuWMAAVJfT?format=png&amp;name=900x900"</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">b</span><span class="w"> </span><span class="s">"Hello"</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><div class="text-red-400 bg-gray-700" style="border-style: groove; border-color: red">
<p>
        This is an example of creating DOM elements similarly to JSX or (better) Elm...
    </p>
<div style="display: block; margin-left: auto; margin-right: auto; width: 30%">
<img alt="No description has been provided for this image" src="https://pbs.twimg.com/media/F6ezdRuWMAAVJfT?format=png&amp;name=900x900"/>
</div>
<b>
        Hello
    </b>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=428bd933-cf02-4834-8058-197bba8f4f54">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note:</strong> having CSS styling to work as expected in the Jupyter notebook is still magic to me. You need to make sure that you executed the first cell at the very beginning of the notebook to import TailwindCSS. But there are some issues in Jupyter and your mileage will vary on all the CSS working out (eg for me dark mode has never properly rendered within a cell).</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=eb961113-e58a-49a0-a602-d890726d6b2b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>There are two more syntax elements introduced in this example that need to be covered before looking at the code in details.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=4457a367-8d5a-4eac-9ab0-ede895687554">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The first one is used constantly: the <code>$</code> symbol. It is a short-code for putting the rest of an expression in parenthesis. It is like writing a <code>(</code> and not bothering with the matching <code>)</code>...</p>
<p>So <code>f1 $ 1 + 2</code> is the same as <code>f1 (1 + 2)</code>, and <code>f1 $ f2 $ 1 + 2</code> is the same as <code>f1 (f2 (1 + 2))</code>.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=0c58684c-6e2e-4946-8755-aa98f519e90f">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The second one is another classic: the <code>do</code> term. It is a short-hand notation for sequencing of a block of functions.  Function sequencing is a very long topic that brings in the famous <em>Monad</em> type, so we'll stick to using it rather than explaining it.</p>
<p>So the code:</p>
<pre><code>do
  f1
  ...
  fN</code></pre>
<p>means that first <code>f1</code> function will be called, and then <code>f2</code> will be called, and so on, and finally the result of <code>fN</code> will be passed as the result of the whole <code>do</code> block.</p>
<p>Remember than parallelism of logic is implied in Haskell and without enforcing a given sequencing the DOM elements could show up in any order based on optimization, as they have no relationship between each other. In a <code>do</code> block, the textual order is the execution order.</p>
<p><strong>Note</strong> that while <em>monads</em> are better known as a scare tactic associated with Haskell, they are just a computing pattern that is universal to programming. In fact the <code>Promise</code> of Javascript is exactly a <em>monad</em> construct! But unlike Haskell, Javascript has no generalized <em>monad</em> system and there's specialized syntax, like <code>await</code>, <code>async</code> and <code>.then(...)</code> to work with it.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c39560bc-0bb1-4923-b89d-3646e3e7143f">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Now let's inspect the code that generated HTML in the cell. First note that all the HTML elements have an equivalent function in Blaze. Elements-replicating functions take a <code>Html</code> value and returns a <code>Html</code> value, while attributes-replicating functions take additional parameters and return a <code>Html</code> value.  The IHaskell kernel has a trick to automatically merge the DOM elements from a resulting <code>Html</code> value into the notebook's cell, and that's why we see rendered HTML rather than some other form of representation.  Without that trick, we could see:</p>
<pre><code>&lt;div class='text-red-400 bg-gray-700' style="border-style: groove; border-color: red"&gt;&lt;p&gt;This ...</code></pre>
<p>as a text literal, or maybe a JSON representation with lots of escaped characters.</p>
<p>Second, note this is a typical Haskell <em>learning curve</em> situation.  The Blaze package is very efficient and simple to use, two great qualities that usually don't go together. But to accomplish that it uses advanced concepts (Monad, combinators, ...) and you'll stay a basic user of the package unless you go through the learning curve of monoids, semigroups, functors, and so on to properly understand how to get all the juice of Blaze or to add new feature to it.</p>
<p>Let's now look at the code: a <code>div</code> function from the <code>Text.Blaze.Html5</code> module will generate the enclosing DOM element.  Further more a <code>style</code> function creates the attribute specification (red color), and the <code>!</code> function links <code>div</code> and <code>style</code>, and then receives the result of the <code>do</code> block. The <code>!</code> function? Yes, that's a valid function name in Haskell, and the Blaze programmers have used it...</p>
<p>In that block, each line calls a function that respectively generates <em>img</em>, <em>p</em> and <em>b</em> DOM elements, with some attributes (<code>!</code> calls) and content (string literals). Using Blaze functions is very similar from writing template code for backend HTML generation.  But with all the advantages of Haskell language.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=97dc2e88-54eb-405a-bd27-5a1d4ecd4513">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note:</strong> Rewriting this code without the module prefix gives:</p>
<pre><code>div ! class_ "text-red-400 bg-gray-700" $ do
p "This is an example of creating DOM elements similarly to JSX or (better) Elm..."
div ! class_ "rounded-md pb-3 pl-3" $ img ! src "https://pbs.twimg.com/..." ! width "150"
    b "Hello"</code></pre>
<p>which is much more comfortable to read. In real-life you'll use an IDE with Haskell language server (HLS) and drop all that prefixing... but in this notebook we'll continue to use the prefixes to explicitely show the origin of functions.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=20ac4a60-8678-47e5-88bc-caede55ace1f">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Now let's say we want to make some components a la React to build up a HTML page section in a modular fashion.  We'd go with something like:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=23872b4e-8668-4410-8251-3a6f66b7d90d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [27]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Text</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">T</span>

<span class="c1">-- define two components that take some parameters:</span>
<span class="nf">componentA</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="n">postfix</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="kt">H</span><span class="o">.</span><span class="n">p</span><span class="w"> </span><span class="s">"This is an example of creating DOM elements similarly to JSX or (better) Elm..."</span>
<span class="w">  </span><span class="kt">H</span><span class="o">.</span><span class="n">img</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="p">(</span><span class="kt">H</span><span class="o">.</span><span class="n">textValue</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"https://pbs.twimg.com/media/"</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">postfix</span><span class="p">)</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">style</span><span class="w"> </span><span class="s">"display: block; margin-left: auto; margin-right: auto;"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">width</span><span class="w"> </span><span class="p">(</span><span class="kt">H</span><span class="o">.</span><span class="n">textValue</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">width</span><span class="p">)</span>

<span class="nf">componentB</span><span class="w"> </span><span class="n">someTxt</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">H</span><span class="o">.</span><span class="n">b</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="p">(</span><span class="kt">H</span><span class="o">.</span><span class="n">textValue</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"text-"</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">someTxt</span>

<span class="c1">-- then apply to get the main div by using the components:</span>
<span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"text-red-400 bg-gray-700"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">componentA</span><span class="w"> </span><span class="mi">150</span><span class="w"> </span><span class="s">"F6ezdRuWMAAVJfT?format=png&amp;name=900x900"</span>
<span class="w">  </span><span class="n">componentB</span><span class="w"> </span><span class="s">"Hello"</span><span class="w"> </span><span class="s">"orange-200"</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><div class="text-red-400 bg-gray-700">
<p>
        This is an example of creating DOM elements similarly to JSX or (better) Elm...
    </p>
<img alt="No description has been provided for this image" src="https://pbs.twimg.com/media/F6ezdRuWMAAVJfT?format=png&amp;name=900x900" style="display: block; margin-left: auto; margin-right: auto;" width="150"/>
<b class="text-orange-200">
        Hello
    </b>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=b521ae93-a443-4d15-9760-7ab08f81e53b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Fairly simple, and at this point you should be able to read most of the code.</p>
<p>A few more things are introduced in this example:</p>
<ul>
<li>the <code>++</code> function that concatenates two String values (it is an historical synonym for the more general concatenation function <code>&lt;&gt;</code>).</li>
<li>the Data.Text module that provides the <code>pack</code> function to convert <code>String</code> to <code>Text</code> values. The <code>Text</code> type is a more C++-like implementation of strings, while the <code>String</code> type is a basic list implementation.</li>
<li>the <code>.</code> operator, which concatenates functions, so <code>func1 . func2 $ a</code> means <code>func1 (func2 a)</code>.</li>
</ul>
<p>Previously when using a <em>string</em> literal such as <code>"something"</code>, the conversion from a <code>String</code> value to a <code>Text</code> value to a <code>Html</code> value was done automatically by the compiler through the <em>OverloadedStrings</em> mode. But the compiler doesn't do the work automatically when we're using variables. We must then specify the conversion, and  <code>H.textValue . t.pack $ &lt;something&gt;</code> is more consistent with <em>functional</em> code esthetics than <code>H.textValue (t.pack &lt;something&gt;)</code>.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=b3abc5c7-0941-440f-b003-b98ef8aa98bf">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We'll take a break from cool capabilities of the Blaze package and go back to introducing three more important syntaxic constructs.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=48ed73d2-e669-4a01-a397-ab305ca5ac74">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The first one is the <code>case</code> construct, which is the workhorse of conditional logic. It looks like:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=6e0f238f-d56a-414a-865b-0cb97af4cc84">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [28]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">aValue</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span>

<span class="kr">case</span><span class="w"> </span><span class="n">aValue</span><span class="w"> </span><span class="kr">of</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="s">"one"</span>
<span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="s">"two"</span>
<span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="s">"three"</span>
<span class="w">  </span><span class="kr">_</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="s">"something different than 1, 2 or 3"</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>"two"</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=b6a2070c-2b2d-4583-9a9b-257c4a5e389e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>This kind of construct exists in most modern language, for example the <em>switch</em> in C and JS or the <em>match</em> in Rust.  The selector is on the right side of the arrow and the code to execute is on the left side of the arrow. The first matching selector for a given value in the <code>case</code> part becomes the code that executes. The  <code>_</code> symbol matches anything so it acts as the <em>default</em> selector. The value of the entire construct is the value returned by the code that executed.</p>
<p>By the way we're referring to <em>construct</em> instead of <em>statement</em> because it returns a value (like an expression and unlike a statement).</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=87578ea0-ea03-4477-9743-d4eed1961dd3">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Secondly, Haskell also provides the <code>if-then-else</code> construct, which is just a short-hand for writing:</p>
<pre><code>case &lt;condition&gt; of
  True -&gt; &lt;then-part&gt;
  False -&gt; &lt;else-part&gt;</code></pre>
<p>So you can write that as <code>if &lt;condition&gt; then &lt;then-part&gt; else &lt;else-part&gt;</code>, and that construct returns either the result of the <code>&lt;then-part&gt;</code> or the <code>&lt;else-part&gt;</code> based on the True/False value of <code>&lt;condition&gt;</code>. Again, the <code>if-then-else</code> construct will return a value, it is not a statement.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=9aac921d-dc71-46f8-9205-22522fbcb520">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The third construct is the <code>let &lt;something&gt; in &lt;something else&gt;</code>.  Essentially the <code>let</code> construct split logic in multiple assignments, and then all these values are re-assembled in the <code>in</code> part to give a result.  Recovering the previous HTML example, we could write:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=9f891a94-c42e-47aa-8205-3e414e223461">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [29]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="c1">-- wrap up all the previous code into a new bigger component (function):</span>
<span class="nf">bigComponent</span><span class="w"> </span><span class="n">halfWidth</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="c1">-- first, compute all params</span>
<span class="w">  </span><span class="kr">let</span>
<span class="w">    </span><span class="n">width</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">halfWidth</span>
<span class="w">    </span><span class="n">urlPostfix</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"F6ezdRuWMAAVJfT?format=png&amp;name=900x900"</span>
<span class="w">    </span><span class="n">helloString</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"Hello"</span>
<span class="w">    </span><span class="n">helloColor</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"green-500"</span>
<span class="w">  </span><span class="kr">in</span>
<span class="w">    </span><span class="c1">-- then make the div element and its children:</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"text-red-400 bg-gray-700"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="n">componentA</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="n">urlPostfix</span>
<span class="w">      </span><span class="n">componentB</span><span class="w"> </span><span class="n">helloString</span><span class="w"> </span><span class="n">helloColor</span>

<span class="c1">-- Invoke the overall html block:</span>
<span class="nf">bigComponent</span><span class="w"> </span><span class="mi">75</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><div class="text-red-400 bg-gray-700">
<p>
        This is an example of creating DOM elements similarly to JSX or (better) Elm...
    </p>
<img alt="No description has been provided for this image" src="https://pbs.twimg.com/media/F6ezdRuWMAAVJfT?format=png&amp;name=900x900" style="display: block; margin-left: auto; margin-right: auto;" width="150"/>
<b class="text-green-500">
        Hello
    </b>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=4a72288a-bcb7-4ed5-b152-e6235b93e05e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The main idea with the <code>let ... in ...</code> construct is that it first provides a way to introduce names for a list of terms in a <em>small</em> namespace.  In an imperative language these would be consider variable declaration/assignements. Second it provides a way to break down logic in short sequences that can be assembled at will in the <code>in</code> part to provide a result. The implied esthetic of this construct isn't apparent immediately but after using for a little while it becomes dearly missed when using languages that don't provide it.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=f5240db0-2985-4c3f-98da-44599cf6f3b4">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<div class="grid justify-center">
<img alt="No description has been provided for this image" class="rounded-lg" src="ph_1/xstatic/img/trumpet_1.png" style="display: block; margin-left: auto; margin-right: auto; width: 30%" width="200"/>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=1b5ccb6d-db5d-4851-bfe0-2b19779c901d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2>WHAT ABOUT THE TYPES?!?</h2>
<p>Let's pause for a moment and note that so far there's been barely any explicit use of typing.  A significant advantage of the Haskell language is that the typing system is so powerful that you rarely need to bother with type annotation like one would do in C, Java or Rust. The compiler can figure out the logical typing arrangements and run code (idem for the interpreter); or if something is too vague it can alert the developer that the logic isn't sound and describe what isn't making sense.</p>
<p>Take a moment to reflect on this a bit more...</p>
<p>The popularity of Javascript and Python is very much related to the idea that strongly-typed languages are just a major pain in the lower back to deal with.  It might be so in Java/TypeScript/Rust/etc. But in Haskell the argument falls apart: one can write <em>simpler</em> code like with Python and Javascript, yet still benefit from all the advantages of stronly-typed logic.</p>
<p>What happens when you have a stronly-typed language that doesn't bother you with typing syntax as in Javascript? Interestingly in real life you find yourself enjoying to add type information, or to let the editor/LSP do it for you! Types end up being a powerful way to document your logic... having a typing system that is subtle rather than shoved down your throat turns out to be a fantastic way to code.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=6cd56e0d-dae3-4b0f-b026-fc85d65cf45c">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>While you're doing some thinking about all of these type-related ideas, I'll borrow some HTML &amp; CSS from the <strong>Tailwind</strong> site and make something more visually pleasing that what I've been putting together up to now... Haskell language features used here will be discussed further down.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=8935f6cd-9cc1-49bc-b4ad-98f515887bb9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [30]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kt">:</span><span class="n">set</span><span class="w"> </span><span class="o">-</span><span class="kt">XOverloadedRecordDot</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Monad</span><span class="w"> </span><span class="p">(</span><span class="nf">mapM_</span><span class="p">,</span><span class="w"> </span><span class="nf">forM_</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Text.Blaze.Svg11</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">S</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Text.Blaze.Svg11.Attributes</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Sa</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">Project</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Project</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">UserPrj</span><span class="w"> </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">UserPrj</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">UserPrj</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">unsplID</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="p">}</span>

<span class="nf">projects</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">  </span><span class="kt">Project</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"proj_1"</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="ow">=</span><span class="s">"First Project"</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"Testing"</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="kt">UserPrj</span><span class="w"> </span><span class="s">"Joe A"</span><span class="w"> </span><span class="s">"photo-1531123897727-8f129e1688ce"</span>
<span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="kt">UserPrj</span><span class="w"> </span><span class="s">"Jane B"</span><span class="w"> </span><span class="s">"photo-1494790108377-be9c29b29330"</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="kt">Project</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"proj_2"</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="ow">=</span><span class="s">"Second Project"</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"More testing"</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="kt">UserPrj</span><span class="w"> </span><span class="s">"Achmed A"</span><span class="w"> </span><span class="s">"photo-1494790108377-be9c29b29330"</span>
<span class="w">      </span><span class="p">,</span><span class="w"> </span><span class="kt">UserPrj</span><span class="w"> </span><span class="s">"Simona B"</span><span class="w"> </span><span class="s">"photo-1506794778202-cad84cf45f1d"</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="w"> </span><span class="p">]</span>

<span class="nf">sectionD</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">H</span><span class="o">.</span><span class="n">section</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">header</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"bg-white space-y-4 p-4 sm:px-8 sm:py-6 lg:p-4 xl:px-8 xl:py-6"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"flex items-center justify-between"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">        </span><span class="kt">H</span><span class="o">.</span><span class="n">h2</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"font-semibold text-slate-900"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">toHtml</span><span class="w"> </span><span class="s">"Projects"</span>
<span class="w">        </span><span class="kt">H</span><span class="o">.</span><span class="n">a</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">href</span><span class="w"> </span><span class="s">"javascript:void()"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"hover:bg-blue-400 group flex items-center rounded-md bg-blue-500 text-white text-sm font-medium pl-2 pr-3 py-2 shadow-sm"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">          </span><span class="kt">S</span><span class="o">.</span><span class="n">svg</span><span class="w"> </span><span class="kt">S</span><span class="o">.!</span><span class="w"> </span><span class="kt">Sa</span><span class="o">.</span><span class="n">width</span><span class="w"> </span><span class="s">"20"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">Sa</span><span class="o">.</span><span class="n">height</span><span class="w"> </span><span class="s">"20"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">Sa</span><span class="o">.</span><span class="n">fill</span><span class="w"> </span><span class="s">"currentColor"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"mr-2"</span><span class="w"> </span><span class="o">$</span>
<span class="w">            </span><span class="kt">S</span><span class="o">.</span><span class="n">path</span><span class="w"> </span><span class="kt">S</span><span class="o">.!</span><span class="w"> </span><span class="kt">Sa</span><span class="o">.</span><span class="n">d</span><span class="w"> </span><span class="s">"M10 5a1 1 0 0 1 1 1v3h3a1 1 0 1 1 0 2h-3v3a1 1 0 1 1-2 0v-3H6a1 1 0 1 1 0-2h3V6a1 1 0 0 1 1-1Z"</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">toHtml</span><span class="w"> </span><span class="s">"New"</span>
<span class="w">      </span><span class="n">form</span>
<span class="w">    </span><span class="n">projectsD</span><span class="w"> </span><span class="n">projects</span>

<span class="nf">form</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">H</span><span class="o">.</span><span class="n">form</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"group relative"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="kt">S</span><span class="o">.</span><span class="n">svg</span><span class="w"> </span><span class="kt">S</span><span class="o">.!</span><span class="w"> </span><span class="kt">Sa</span><span class="o">.</span><span class="n">width</span><span class="w"> </span><span class="s">"20"</span><span class="w"> </span><span class="kt">S</span><span class="o">.!</span><span class="w"> </span><span class="kt">Sa</span><span class="o">.</span><span class="n">height</span><span class="w"> </span><span class="s">"20"</span><span class="w"> </span><span class="kt">S</span><span class="o">.!</span><span class="w"> </span><span class="kt">Sa</span><span class="o">.</span><span class="n">fill</span><span class="w"> </span><span class="s">"currentColor"</span><span class="w"> </span><span class="kt">S</span><span class="o">.!</span><span class="w"> </span>
<span class="w">            </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"absolute left-3 top-1/2 -mt-2.5 text-slate-400 pointer-events-none group-focus-within:text-blue-500"</span><span class="w"> </span><span class="o">$</span>
<span class="w">        </span><span class="kt">S</span><span class="o">.</span><span class="n">path</span><span class="w"> </span><span class="kt">S</span><span class="o">.!</span><span class="w"> </span><span class="kt">Sa</span><span class="o">.</span><span class="n">fillRule</span><span class="w"> </span><span class="s">"evenodd"</span><span class="w"> </span><span class="kt">S</span><span class="o">.!</span><span class="w"> </span><span class="kt">Sa</span><span class="o">.</span><span class="n">clipRule</span><span class="w"> </span><span class="s">"evenodd"</span>
<span class="w">            </span><span class="kt">S</span><span class="o">.!</span><span class="w"> </span><span class="kt">Sa</span><span class="o">.</span><span class="n">d</span><span class="w"> </span><span class="s">"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">input</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"focus:ring-2 focus:ring-blue-500 focus:outline-none appearance-none w-full text-sm leading-6 text-slate-900 placeholder-slate-400 rounded-md py-2 pl-10 ring-1 ring-slate-200 shadow-sm"</span>
<span class="w">        </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">type_</span><span class="w"> </span><span class="s">"text"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">placeholder</span><span class="w"> </span><span class="s">"Filter projects..."</span>

<span class="c1">-- A components for showing projects</span>
<span class="nf">projectsD</span><span class="w"> </span><span class="n">projects</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">H</span><span class="o">.</span><span class="n">ul</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"bg-slate-50 p-4 sm:px-8 sm:pt-6 sm:pb-8 lg:p-4 xl:px-8 xl:pt-6 xl:pb-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2 gap-4 text-sm leading-6 dark:bg-slate-900/40 dark:ring-1 dark:ring-white/5"</span><span class="w"> </span><span class="o">$</span>
<span class="w">    </span><span class="n">mapM_</span><span class="w"> </span><span class="n">aProjectD</span><span class="w">  </span><span class="n">projects</span>

<span class="nf">aProjectD</span><span class="w"> </span><span class="n">aProj</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">H</span><span class="o">.</span><span class="n">li</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"group cursor-pointer rounded-md p-3 bg-white ring-1 ring-slate-200 shadow-sm hover:bg-blue-500 hover:ring-blue-500 hover:shadow-md dark:bg-slate-700 dark:ring-0 dark:highlight-white/10 dark:hover:bg-blue-500 hidden sm:block lg:hidden xl:block"</span><span class="w"> </span><span class="o">$</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">a</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">href</span><span class="w"> </span><span class="p">(</span><span class="kt">H</span><span class="o">.</span><span class="n">textValue</span><span class="w"> </span><span class="n">aProj</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"hover:bg-blue-500 hover:ring-blue-500 hover:shadow-md group rounded-md p-3 bg-white ring-1 ring-slate-200 shadow-sm"</span><span class="w"> </span><span class="o">$</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">dl</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"grid sm:block lg:grid xl:block grid-cols-2 grid-rows-2 items-center"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">        </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">dt</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"sr-only"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">toHtml</span><span class="w"> </span><span class="s">"Title"</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">dd</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"group-hover:text-white font-semibold text-slate-900"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">toHtml</span><span class="w"> </span><span class="n">aProj</span><span class="o">.</span><span class="n">title</span>
<span class="w">        </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">dt</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"sr-only"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">toHtml</span><span class="w"> </span><span class="s">"Category"</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">dd</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"group-hover:text-blue-200"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">toHtml</span><span class="w"> </span><span class="n">aProj</span><span class="o">.</span><span class="n">category</span>
<span class="w">        </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"col-start-2 row-start-1 row-end-3 sm:mt-4 lg:mt-0 xl:mt-4"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">dt</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"sr-only"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">toHtml</span><span class="w"> </span><span class="s">"Users"</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">dd</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"flex justify-end sm:justify-start lg:justify-end xl:justify-start -space-x-1.5"</span><span class="w"> </span><span class="o">$</span>
<span class="w">            </span><span class="n">forM_</span><span class="w"> </span><span class="n">aProj</span><span class="o">.</span><span class="n">users</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="n">u</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">img</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">src</span><span class="w"> </span><span class="p">(</span><span class="n">fullUnsplashUrl</span><span class="w"> </span><span class="n">u</span><span class="o">.</span><span class="n">unsplID</span><span class="p">)</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">alt</span><span class="w"> </span><span class="p">(</span><span class="kt">H</span><span class="o">.</span><span class="n">textValue</span><span class="w"> </span><span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"w-6 h-6 rounded-full bg-slate-100 ring-2 ring-white"</span><span class="p">)</span>
<span class="w">  </span><span class="kr">where</span>
<span class="w">  </span><span class="n">fullUnsplashUrl</span><span class="w"> </span><span class="n">anID</span><span class="w"> </span><span class="ow">=</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">textValue</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"https://images.unsplash.com/"</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">anID</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">"?auto=format&amp;fit=facearea&amp;facepad=2&amp;w=48&amp;h=48&amp;q=80"</span>

<span class="nf">demoPage</span><span class="w"> </span><span class="n">aReason</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span>
<span class="w">  </span><span class="kt">H</span><span class="o">.</span><span class="n">html</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">head</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">link</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">href</span><span class="w"> </span><span class="s">"https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">rel</span><span class="w"> </span><span class="s">"stylesheet"</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">link</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">href</span><span class="w"> </span><span class="s">"ph_1/xstatic/css/pack_1.css"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">rel</span><span class="w"> </span><span class="s">"stylesheet"</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">link</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">href</span><span class="w"> </span><span class="s">"ph_1/xstatic/css/pack_2.css"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">rel</span><span class="w"> </span><span class="s">"stylesheet"</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">body</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"dark antialiased text-slate-500 dark:text-slate-400 dark:bg-slate-900"</span><span class="w"> </span><span class="o">$</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">style</span><span class="w"> </span><span class="s">"color: red; background: rgb(115 120 128)"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"lg:col-span-5 xl:col-span-6 flex flex-col"</span><span class="w"> </span><span class="o">$</span>
<span class="w">        </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"relative z-10 rounded-xl bg-white shadow-xl ring-1 ring-slate-900/5 overflow-hidden my-auto xl:mt-18 dark:bg-slate-800"</span><span class="w"> </span><span class="o">$</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"container mx-auto p-4"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">            </span><span class="kt">H</span><span class="o">.</span><span class="n">h1</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"text-2xl font-bold mb-4"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">toHtml</span><span class="w"> </span><span class="n">aReason</span>
<span class="w">            </span><span class="n">sectionD</span>

<span class="nf">demoPage</span><span class="w"> </span><span class="s">"Just taking a break"</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><html>
<head>
<link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet"/>
<link href="ph_1/xstatic/css/pack_1.css" rel="stylesheet"/>
<link href="ph_1/xstatic/css/pack_2.css" rel="stylesheet"/>
</head>
<body class="dark antialiased text-slate-500 dark:text-slate-400 dark:bg-slate-900">
<div class="lg:col-span-5 xl:col-span-6 flex flex-col" style="color: red; background: rgb(115 120 128)">
<div class="relative z-10 rounded-xl bg-white shadow-xl ring-1 ring-slate-900/5 overflow-hidden my-auto xl:mt-18 dark:bg-slate-800">
<div class="container mx-auto p-4">
<h1 class="text-2xl font-bold mb-4">
                        Just taking a break
                    </h1>
<section>
<header class="bg-white space-y-4 p-4 sm:px-8 sm:py-6 lg:p-4 xl:px-8 xl:py-6">
<div class="flex items-center justify-between">
<h2 class="font-semibold text-slate-900">
                                    Projects
                                </h2>
<a class="hover:bg-blue-400 group flex items-center rounded-md bg-blue-500 text-white text-sm font-medium pl-2 pr-3 py-2 shadow-sm" href="javascript:void()">
<svg class="mr-2" fill="currentColor" height="20" width="20">
<path d="M10 5a1 1 0 0 1 1 1v3h3a1 1 0 1 1 0 2h-3v3a1 1 0 1 1-2 0v-3H6a1 1 0 1 1 0-2h3V6a1 1 0 0 1 1-1Z"></path>
</svg>
                                    New
                                </a>
</div>
<form class="group relative">
<svg class="absolute left-3 top-1/2 -mt-2.5 text-slate-400 pointer-events-none group-focus-within:text-blue-500" fill="currentColor" height="20" width="20">
<path clip-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" fill-rule="evenodd"></path>
</svg>
<input class="focus:ring-2 focus:ring-blue-500 focus:outline-none appearance-none w-full text-sm leading-6 text-slate-900 placeholder-slate-400 rounded-md py-2 pl-10 ring-1 ring-slate-200 shadow-sm" placeholder="Filter projects..." type="text"/>
</form>
</header>
<ul class="bg-slate-50 p-4 sm:px-8 sm:pt-6 sm:pb-8 lg:p-4 xl:px-8 xl:pt-6 xl:pb-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2 gap-4 text-sm leading-6 dark:bg-slate-900/40 dark:ring-1 dark:ring-white/5">
<li class="group cursor-pointer rounded-md p-3 bg-white ring-1 ring-slate-200 shadow-sm hover:bg-blue-500 hover:ring-blue-500 hover:shadow-md dark:bg-slate-700 dark:ring-0 dark:highlight-white/10 dark:hover:bg-blue-500 hidden sm:block lg:hidden xl:block">
<a class="hover:bg-blue-500 hover:ring-blue-500 hover:shadow-md group rounded-md p-3 bg-white ring-1 ring-slate-200 shadow-sm" href="proj_1">
<dl class="grid sm:block lg:grid xl:block grid-cols-2 grid-rows-2 items-center">
<div>
<dt class="sr-only">
                                                Title
                                            </dt>
<dd class="group-hover:text-white font-semibold text-slate-900">
                                                First Project
                                            </dd>
</div>
<div>
<dt class="sr-only">
                                                Category
                                            </dt>
<dd class="group-hover:text-blue-200">
                                                Testing
                                            </dd>
</div>
<div class="col-start-2 row-start-1 row-end-3 sm:mt-4 lg:mt-0 xl:mt-4">
<dt class="sr-only">
                                                Users
                                            </dt>
<dd class="flex justify-end sm:justify-start lg:justify-end xl:justify-start -space-x-1.5">
<img alt="Joe A" class="w-6 h-6 rounded-full bg-slate-100 ring-2 ring-white" src="https://images.unsplash.com/photo-1531123897727-8f129e1688ce?auto=format&amp;fit=facearea&amp;facepad=2&amp;w=48&amp;h=48&amp;q=80"/>
<img alt="Jane B" class="w-6 h-6 rounded-full bg-slate-100 ring-2 ring-white" src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&amp;fit=facearea&amp;facepad=2&amp;w=48&amp;h=48&amp;q=80"/>
</dd>
</div>
</dl>
</a>
</li>
<li class="group cursor-pointer rounded-md p-3 bg-white ring-1 ring-slate-200 shadow-sm hover:bg-blue-500 hover:ring-blue-500 hover:shadow-md dark:bg-slate-700 dark:ring-0 dark:highlight-white/10 dark:hover:bg-blue-500 hidden sm:block lg:hidden xl:block">
<a class="hover:bg-blue-500 hover:ring-blue-500 hover:shadow-md group rounded-md p-3 bg-white ring-1 ring-slate-200 shadow-sm" href="proj_2">
<dl class="grid sm:block lg:grid xl:block grid-cols-2 grid-rows-2 items-center">
<div>
<dt class="sr-only">
                                                Title
                                            </dt>
<dd class="group-hover:text-white font-semibold text-slate-900">
                                                Second Project
                                            </dd>
</div>
<div>
<dt class="sr-only">
                                                Category
                                            </dt>
<dd class="group-hover:text-blue-200">
                                                More testing
                                            </dd>
</div>
<div class="col-start-2 row-start-1 row-end-3 sm:mt-4 lg:mt-0 xl:mt-4">
<dt class="sr-only">
                                                Users
                                            </dt>
<dd class="flex justify-end sm:justify-start lg:justify-end xl:justify-start -space-x-1.5">
<img alt="Achmed A" class="w-6 h-6 rounded-full bg-slate-100 ring-2 ring-white" src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&amp;fit=facearea&amp;facepad=2&amp;w=48&amp;h=48&amp;q=80"/>
<img alt="Simona B" class="w-6 h-6 rounded-full bg-slate-100 ring-2 ring-white" src="https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&amp;fit=facearea&amp;facepad=2&amp;w=48&amp;h=48&amp;q=80"/>
</dd>
</div>
</dl>
</a>
</li>
</ul>
</section>
</div>
</div>
</div>
</body>
</html>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=6e52b8dc-4595-465a-ba7e-8937fd0716c1">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Ok, not as good as the original, but still really cool to get that kind of result directly into Jupyter's cells. Doing some thinking of my own while looking at the CSS classes in the code, I feel that spending time understanding how Haskell helps me discover so many computational concepts ends up being much more rewarding than spending time on learning stylesheet rules...</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=a79bba25-efa0-41fe-a7c4-a46aab31562d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2>Data Structures</h2>
<p>The definition of data structures is an essential part of software development. The most basic construct for introducing a new structure in Haskell is the <code>data</code> construct.  For example, one would define a new structure to keep track of the width and height of a raster image in the following way:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=2dec912a-ffd8-41ab-b5f7-ae45b21bc906">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [31]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">data</span><span class="w"> </span><span class="kt">ImageSize_1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">ImgSz_1</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="kt">Int</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c817bb04-3541-4f42-8aa9-33d11b11648e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>which means that a value of the new structure called <code>ImageSize_1</code> is the assembly of two values of type <code>Int</code>, and that an <code>ImageSize_1</code> value is introduced by using the <em>value constructor</em> <code>ImgSz_1</code>.</p>
<p>And if you haven't guessed it already, a new data structure is a new type!</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=55e75c98-96be-46ea-bf65-d9939d9b8e0d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note</strong> that in real life programmers prefer to the same name for the <em>value constructor</em> as for the structure name, as in:</p>
<pre><code>data ImageSize_1 = ImageSize_1 Int Int</code></pre>
<p>but that's just a convention and it can be anything that starts with an upper-case letter.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=8a7046cd-4b36-4877-8f1d-97eaeb4b39f9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Why is Haskell using the keyword <code>data</code> for types instead of the more logical keyword <code>type</code>? It seems the aliasing concepts the language designers first early on for the keyword <code>type</code> weren't broad enough, and when the more powerful features came along there was already too many things dependant on the <code>type</code> keyword for a refactoring so the <code>data</code> keyword came about.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=9c98e98b-ce9f-4325-8572-884bc2b53068">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>To create a value of type <code>ImageSize_1</code>, one would write:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=af67bbb8-9942-42a0-a89f-b5ef56071a7b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [32]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">isz_1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">ImgSz_1</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="mi">300</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=a10ede3e-2bb9-462c-be6a-b635df47975c">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>It is valid, but it makes for rather uninformative code. It would be much better if we could immediately identify which of the two numbers is the width and which is the height. To solve this lack of information, we can use the classic <code>Value.field</code> record notation.  It's classic but up to 2021 it wasn't part of Haskell at all (!!), and still today it requires the <em>OverloadedRecordDot</em> mode to be activated:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=6e3b454e-4310-4973-850f-fb1b25c7ff39">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [33]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kt">:</span><span class="n">set</span><span class="w"> </span><span class="o">-</span><span class="kt">XOverloadedRecordDot</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">ImageSize_2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">ImgSz_2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=76e1a5a5-ea51-46c0-89b5-adf77ab3241d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Now we have essentially the same structure as <code>ImageSize_1</code> but it is better documented. To create a value of type <code>ImageSize_2</code> with more explicit information, one can write:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=4c4af9bd-8496-4c2a-b85c-a9808efc7b83">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [34]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">isz_2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">ImgSz_2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="p">}</span>

<span class="c1">-- the first syntax for is also valid:</span>
<span class="nf">isz_2_alt</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">ImgSz_2</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="mi">300</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=925c4d81-10c0-4fa8-b287-f28785f14409">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>With the record notation, the code for accessing field values in a data structure is as expected:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=c58ea935-adf1-4703-a93d-fd67972f7281">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [35]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">if</span><span class="w"> </span><span class="n">isz_2</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">isz_2</span><span class="o">.</span><span class="n">depth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="s">"Out of bound"</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="s">"No problemo"</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>"No problemo"</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=a2e0da33-3d35-4b96-ad30-40facb02bf82">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Haskell also uses an old school technique: pattern matching (<strong>Prolog</strong> anyone?). So to inspect the content of a ImageSize_1 value, we can use pattern matching to do so:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=01cff019-464d-46cd-8f38-61e17d2f6ef2">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [36]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kt">ImgSz_1</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="n">nh</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">isz_1</span>
<span class="kr">if</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">nh</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="s">"Kaboom"</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="s">"All good"</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>"All good"</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=fde327d4-33de-43b8-b73f-729ce48cd972">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>ImgSz_1 &lt;v1&gt; &lt;v2&gt;</code> syntax on the left-hand side provides a pattern that will match a value of type <code>ImageSize_1</code>.  If the right-hand side is of the same type, there is a binding for the <code>&lt;v1&gt;</code> and <code>&lt;v2&gt;</code> terms to the internal components of the value.</p>
<p>While it's old school, it turns out to be an elegant way to write code.  Back in the days of expert systems and <strong>Prolog</strong>, it was a big thing. The syntax turns out to be very readable, especially when dealing with more complex definitions, so it makes it is still in use today.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=dbecf5a7-be45-41a9-b6ef-276b3bc97fde">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Ok we can read fields, but how about modifying values of a record structure? Given the immutability of variables, we use a copy-on-write kind of approach:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=55b55b1b-ab5b-442d-9d39-9b20719908cb">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [37]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">isz_3</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">isz_2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="p">}</span>
<span class="s">"Length: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">isz_3</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">", depth: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">isz_3</span><span class="o">.</span><span class="n">depth</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>"Length: 500, depth: 300"</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=5b86e616-d1d1-4e5b-a67c-f73de45871d1">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>As we can't modify the <code>isz_2</code> content, ie <code>isz_2.length = 500</code> isn't allowed, we create a new <code>ImageSize_2</code> value with the same <code>depth</code> as <code>isz_2</code> but with a <code>length</code> of 500.</p>
<p>The newcomer's reaction to this approach of creating new values instead of mutating existing values is often that Haskell code is wasting a lot of memory. But as the underlying mechanism for the value creation use copy-on-write, Haskell immutability constraint effect on memory consumption is the essentially the same as with other garbage-collected languages like Javascript, Python or Java. The real impact of this approach is that more variable names that may appear in the code as structure values are modified over the length of a function, and that is a good thing from a code clarity perspective. Computer memory isn't wasted, and in fact given the overall set of features in Haskell the memory consumption can end up to be equivalent to a <strong>C</strong> or <strong>Rust</strong> program.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=715a65f3-ae50-40cf-8d1f-e11dedd5e240">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The kind of structure we have defined with <code>ImageSize_&lt;x&gt;</code> is a <a href="https://en.wikipedia.org/wiki/Algebraic_data_type">product type</a>. By contrast, a sum type represents a choice amongst alternatives provided in the structure definition. That's known as an <em>union</em> in C, <em>enum</em> in Rust, etc.</p>
<p>A sum type is defined by putting a list of type definitions seperated by the <code>|</code> symbol, ie giving the alternatives (think of the <code>|</code> symbol as a <em>or</em> keyword):</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=f3c83ad6-9839-4dad-8141-cab0efd87bea">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [38]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">data</span><span class="w"> </span><span class="kt">Sizing</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">Image</span><span class="w"> </span><span class="kt">ImageSize_2</span><span class="w">            </span><span class="c1">-- expressing the size for an image based on previous definition</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">Video</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="kt">Double</span><span class="w">   </span><span class="c1">-- expressing the size based on some video concepts (width, height, duration, resolution)</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">Unknown</span><span class="w"> </span><span class="kt">String</span><span class="w">             </span><span class="c1">-- an escape route to express some other size parameters.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=36be399e-c8f7-4d45-8855-dfb886f30eb9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Then we can create some values of type Sizing by writing:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=6a46cd59-9315-4cba-9587-53163d7ff0b0">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [39]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="c1">-- Sizing for an image:</span>
<span class="nf">imgSz</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Image</span><span class="w"> </span><span class="n">isz_2</span>
<span class="c1">-- Sizing for a video:</span>
<span class="nf">vidSz</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Video</span><span class="w"> </span><span class="mi">1920</span><span class="w"> </span><span class="mi">1080</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="mf">29.9</span>
<span class="c1">-- Sizing somethign we don't know about:</span>
<span class="nf">unkSz</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Unknown</span><span class="w"> </span><span class="s">"1,2,3 and 4,5,6, and let's say big, big"</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=0ebe687c-1710-4724-81be-e42409bda118">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>It is now a good time to revisit the <code>case</code> construct and see how it's used with sum types:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=6a8aff25-8fcf-417c-ab1d-e4a4dacbd57e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [40]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">someSize</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">vidSz</span>

<span class="kr">case</span><span class="w"> </span><span class="n">someSize</span><span class="w"> </span><span class="kr">of</span>
<span class="w">  </span><span class="kt">Image</span><span class="w"> </span><span class="n">imgSize</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="s">"length: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">imgSize</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">", depth: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">imgSize</span><span class="o">.</span><span class="n">depth</span>
<span class="w">  </span><span class="kt">Video</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="s">"width: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">", height: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">h</span>
<span class="w">  </span><span class="kt">Unknown</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="s">"Who knows!"</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>"width: 1920, height: 1080"</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=93f92d65-d051-49b4-be78-77516255dd10">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>This code shows both the pattern matching and sum types in action to give readable code (but not necessarely clever or useful code...).</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d0d05fb1-baa1-462c-9b7b-a9d7a97bd83e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The combination of pattern matching with function definition is another way to provide readable code. In the following example, the function <code>f1</code> is defined using pattern matching. The compiler is in charge of collecting all definitions of <code>f1</code> and then verifying the argument at runtime to launch the execution of the right version of the function. This looks like:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=e31ff61c-8e51-4f36-b966-48259e404a33">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [41]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="c1">-- create a synonym of the string conversion combined function for more readable code later on:</span>
<span class="nf">useString</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">toMarkup</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span>

<span class="c1">-- define a function that works with Image values:</span>
<span class="nf">f1</span><span class="w"> </span><span class="p">(</span><span class="kt">Image</span><span class="w"> </span><span class="n">imgSize</span><span class="p">)</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">b</span><span class="w"> </span><span class="s">"IMAGE"</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">ul</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">li</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">useString</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"length: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">imgSize</span><span class="o">.</span><span class="n">length</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">li</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">useString</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"depth: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">imgSize</span><span class="o">.</span><span class="n">depth</span>

<span class="c1">-- define a function that works with Video values:</span>
<span class="nf">f1</span><span class="w"> </span><span class="p">(</span><span class="kt">Video</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="kr">_</span><span class="p">)</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">b</span><span class="w"> </span><span class="s">"VIDEO"</span>
<span class="w">    </span><span class="kt">H</span><span class="o">.</span><span class="n">ul</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">li</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">useString</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"width: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">w</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">li</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">useString</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"height: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">h</span>

<span class="c1">-- define a function that works with Unknown values:</span>
<span class="nf">f1</span><span class="w"> </span><span class="p">(</span><span class="kt">Unknown</span><span class="w"> </span><span class="kr">_</span><span class="p">)</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">b</span><span class="w"> </span><span class="s">"Who knows!"</span>

<span class="c1">-- apply the f1 function to a value of type Sizing:</span>
<span class="nf">f1</span><span class="w"> </span><span class="n">vidSz</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><b>
    VIDEO
</b>
<ul>
<li>
        width: 1920
    </li>
<li>
        height: 1080
    </li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=2d193c85-7347-4544-a39f-ae05fc652343">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note</strong> that this code uses</p>
<pre><code>H.li $ useString $ "length: " &lt;&gt; show imgSize.length</code></pre>
<p>instead of</p>
<pre><code>H.li useString "length: " &lt;&gt; show imgSize.length</code></pre>
<p>Why is that? We don't bother with parenthesis or commas to delimit the parameters of a function in Haskell. But in return, there's a basic rule to disambiguate which parameters are part of which function call, and that is left-to-right precedence.</p>
<p>If we used the second version of the code instead of the first one, the left-to-right precedence rule means that the <code>H.li</code> function, which takes a single parameter, will use the <code>useString</code> function and thus it doesn't compute! So we must tell the compiler that the right parameter to use is the result of the <code>useString</code> application to the rest of the line, and that's what the first <code>$</code> symbol indicates. Then we have a similar issue with <code>"length: "</code> not being the right parameter for <code>useString</code>, so we put another <code>$</code> to group the rest of the line into a string value. But then why isn't there a <code>$</code> to group the <code>show imgSize.length</code> function call? That's because the left-to-right rule has level of precedence for each function, and it turns out that <code>&lt;&gt;</code> precendence is lower than normal. So unlike the two previous situation, the <code>show imgSize.length</code> will be executed first, and that will become the 2nd parameter of the <code>&lt;&gt;</code> function call, <code>"length: "</code> being the first parameter.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=4bcff8d5-a9bb-4b84-8209-6cd0c47ce323">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2>Looking at lists</h2>
<p>We have so far covered a lot of ground, but we still have managed to stay away from a very important structure of programming languages: the <strong>list</strong>!  Lists are especially important in functional languages as they normally constitute the basis for iteration. It is an essence of functional programming to use the <em>scan</em> and <em>accumulate</em> concept as a better way of doing of what other languages implement with the <em>for-loop</em> or <em>do-while</em> statements, and a central point of debate for the functional vs non-functional discussions.</p>
<p>The very first thing about a list in Haskell is that it's written with the same syntax that most other popular languages use for arrays:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=d0c652c1-6df4-4b99-ab39-ac42a06ccc53">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [42]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">aList</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=64e75513-02d3-4c1e-8f75-18c2ca4d0b39">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>But that's not an array, it's a <strong>list</strong>. As in "think <em>Lisp</em>", ie singly linked list...
That means there's no index to get elements and instead you have to use the head and tail or <a href="https://en.wikipedia.org/wiki/CAR_and_CDR"><em>car : cdr</em></a> technique.
Haskell uses the <code>:</code> function to put a new element at the head of an existing list, as in:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=a0e5ea9c-e6f5-4672-96c9-a6f69437aa65">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [43]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="mi">6</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">aList</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[6,1,2,3,4,5]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=ec7861b5-ca89-4ed7-b28c-c3a4057773a5">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>And conversely, pattern matching with <code>:</code> is used to extract the first element of a list:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=61cf796d-66fd-4125-8303-1a2414bc94d8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [44]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">firstElement</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">restOfList</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">aList</span>
<span class="nf">firstElement</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>1</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d39fa781-1c47-4178-8e6c-a2381e975dba">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Adding more entries at the end of a list is a concatenation, and that's done with the <code>&lt;&gt;</code> function as seen before.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=a3e3a55b-5a31-44db-b0d5-7ba3becc5181">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [45]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">aList</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">]</span>
<span class="s">"allo"</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">" byebye"</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>[1,2,3,4,5,6]</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>"allo byebye"</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=0689af52-54bc-410b-a87b-57f6e8692d39">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Developers that don't have a formal computer science will find it weird to use lists for all kind of iterative and recursive flow control, but hopefully those with the formal background will remember that they used that approach in all kind of algorithms instead of the lowly index scans.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=63bbf12e-bf15-4261-8d86-b0ecf68eea4e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note</strong> that the <code>String</code> type is defined simply as a synonym for the list of <code>Char</code> type, or again <code>[Char]</code>. There is an important consequence to this definition: the basic string in Haskell is a singly linked list of Unicode characters! That is not necessarely the most efficient string implementation there is, and as we'll see soon it is a popular hobby amongst Haskell programmers to use alternative types for optimal string operations.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=cb7781a2-dcae-4e08-b642-fca2e7c7f9dc">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The typical iterations and recursions on list are done with either the <code>map</code> and <code>fold</code> family of functions, or using <code>case</code> construct with pattern matching on the <em>car : cdr</em> values.  For example:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=93869f9c-0c3f-435e-947a-d06b083f190f">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [46]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kt">Prelude</span><span class="o">.</span><span class="n">map</span><span class="w"> </span><span class="p">(</span><span class="kt">H</span><span class="o">.</span><span class="n">b</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">useString</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">show</span><span class="p">)</span><span class="w"> </span><span class="n">aList</span><span class="w">      </span><span class="c1">-- apply a function to each element of aList</span>

<span class="kt">Prelude</span><span class="o">.</span><span class="n">foldl</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">aList</span><span class="w">   </span><span class="c1">-- multiply recursively each value of the list and double that.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><b>
    1
</b>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><b>
    2
</b>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><b>
    3
</b>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><b>
    4
</b>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><b>
    5
</b>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>240</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=72450677-e1bd-47bd-abad-982b4ef94683">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Basic stuff...</p>
<p>For a bit more advanced list processing:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=fcca4a55-1090-4f74-a11b-5ed9154a3453">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [47]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">showOff</span><span class="w"> </span><span class="n">inList</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">ul</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">fRecur</span><span class="w"> </span><span class="n">inList</span>

<span class="c1">-- Call itself recursively, but operate as an iterator over a list of values.</span>
<span class="nf">fRecur</span><span class="w"> </span><span class="n">inList</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kr">case</span><span class="w"> </span><span class="n">inList</span><span class="w"> </span><span class="kr">of</span>
<span class="w">    </span><span class="kt">[]</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">b</span><span class="w"> </span><span class="s">"-- 0 --"</span><span class="w">        </span><span class="c1">-- Edge case, the list is empty.</span>
<span class="w">    </span><span class="p">[</span><span class="n">car</span><span class="p">]</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">itemize</span><span class="w"> </span><span class="n">car</span><span class="w">       </span><span class="c1">-- The list is a single element.</span>
<span class="w">    </span><span class="n">car</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">cdr</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">itemize</span><span class="w"> </span><span class="n">car</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">fRecur</span><span class="w"> </span><span class="n">cdr</span><span class="w">       </span><span class="c1">-- There are more than 1 element in the list, call itself to iterate over all elements.</span>
<span class="w">  </span><span class="kr">where</span>
<span class="w">    </span><span class="n">itemize</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">li</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">useString</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">show</span>

<span class="nf">showOff</span><span class="w"> </span><span class="n">aList</span>

<span class="nf">fRecur</span><span class="w"> </span><span class="kt">[]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><ul>
<li>
        1
    </li>
<li>
        2
    </li>
<li>
        3
    </li>
<li>
        4
    </li>
<li>
        5
    </li>
</ul>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><b>
    -- 0 --
</b>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=421e19cb-2f1e-4d8b-b9af-2a4e93b88a8c">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>This example uses recursive accumulation to get things done. It also introduces the <code>where</code> construct that lets us provide a set of definitions <strong>after</strong> the main logic rather than before. So you can consider <code>let</code> and <code>where</code> as mirror of each other. Using <code>let</code> or <code>where</code> makes no difference to code execution sequencing, it's just providing flexibility for writing helper code either before or after the main logic.</p>
<p>Also in this example there's a function definition instead of a variable definition in the <code>where</code> construct.  At the end of the day, variables are just functions with 0 argument, so defining functions or variables is exactly the same thing, both in the <code>let</code> and <code>where</code> syntax.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=5bc6c945-0bab-4dee-86ca-7378384510af">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We have now covered a good base of Haskell syntax and functional concepts. And beside the section where we explicitely wanted to talk about typing, still no typing to bother with! <span>😀</span></p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=fb0bb199-e620-4638-b4fc-392c696ba395">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2>Fetching web data</h2>
We'll now start to look at more relevant topics to web application development, starting with using HTTP, the basic communication protocol of the web.

<p>To build an example we'll use a simple REST api provider, the USA's <a href="https://vpic.nhtsa.dot.gov/api/">Car Vehicle API</a>, to provide a live endpoint to work with. The API provides us with some information about vehicles that are used in the USA, embedded in JSON format.</p>
<p>The basic HTTP tool of Haskell, the <a href="https://hackage.haskell.org/package/http-client-0.7.14/docs/Network-HTTP-Client.html">Network.HTTP.Client</a> package, to fetch data easily. We'll then use the popular <a href="https://hackage.haskell.org/package/aeson">Aeson</a> package to upgrade automagically the JSON into Haskell data structures.</p>
<p>Also to illustrate a point about monadic stuff, we'll put the logic in a toy function.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=80645a12-756b-448e-8d6d-932f4872ba46">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [48]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Network.HTTP.Client</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">N</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Network.HTTP.Client.TLS</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">N</span>

<span class="nf">vehicleFetch</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kr">let</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"GET https://vpic.nhtsa.dot.gov/api/vehicles/"</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">query</span>
<span class="w">    </span><span class="n">request</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">N</span><span class="o">.</span><span class="n">setQueryString</span><span class="w"> </span><span class="p">[(</span><span class="s">"format"</span><span class="p">,</span><span class="w"> </span><span class="kt">Just</span><span class="w"> </span><span class="s">"json"</span><span class="p">)]</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">N</span><span class="o">.</span><span class="n">parseRequest_</span><span class="w"> </span><span class="n">url</span>
<span class="w">    </span><span class="n">settings</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">N</span><span class="o">.</span><span class="n">tlsManagerSettings</span>
<span class="w">  </span><span class="kr">in</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="n">reqMgr</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kt">N</span><span class="o">.</span><span class="n">newManager</span><span class="w"> </span><span class="n">settings</span>
<span class="w">    </span><span class="kt">N</span><span class="o">.</span><span class="n">httpLbs</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">reqMgr</span>
<span class="w"> </span>
<span class="nf">response</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">vehicleFetch</span><span class="w"> </span><span class="s">"getallmakes"</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre></pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=1a3e9fd3-59e0-4cea-b1bd-99230efdd6ba">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The function is split in two parts using a <code>let</code> construct.  The first part specifies the values for <code>url</code>, <code>req</code> and <code>settings</code> terms.</p>
<p>The HTTP fetch happens in the second part, ie the <code>in</code>. Now we know that fetching data on the web is far from being a <em>pure</em> operation, ie consistently repeatable. In the Haskell world, that means the computations need to be wrapped in one of those famous <em>monads</em>, in this case the <code>IO</code> <em>monad</em> which contains the <em>impure</em> state of the real world. There is no indication that the <code>IO</code> type is being used in the code as it is all deduced by the compiler. But the two <em>impure</em> computations need to be performed in a strict context and order, and that's why the <code>do</code> keyword shows up just after <code>in</code>.</p>
<p>Once results are generated within the <code>IO</code> monad, we'll want to get them back into the <em>pure</em> world. The <code>&lt;-</code> (left-pointing arrow) symbol does exactly that, extracting the values from the <code>IO</code> <em>impure</em> context and making them available for the <em>pure</em> computations.</p>
<p>The first <em>impure</em> operation is the definition of a HTTP communication manager. Having to specify that is the price to pay for using a low-level package which exposes the connection layer.</p>
<p>The next operation is the actual fetching of data, achieved by the <code>httpLbs</code> function.  This being the last value encountered in the <code>vehicleFetch</code> function, it also become its result. That means that <code>vehicleFetch</code> returns values embedded in the <code>IO</code> monad.</p>
<p>If we were to specify typing for that function, it would gain:</p>
<pre><code>vehicleFetch :: String -&gt; IO (N.Response Data.ByteString)</code></pre>
<p>meaning that the function takes a <code>String</code> parameter, and returns a <code>ByteString</code>-based HTTP <code>Response</code> wrapped in the <code>IO</code> type (<code>ByteString</code> is yet another string implementation!).</p>
<p>But why bother with type annotation?</p>
<p>Once the data is received from the web after invoking the <code>vehicleFetch</code>, the <code>&lt;-</code> symbol is used again to extract it out of the <code>IO</code> monad and back in the <em>pure</em> world.
If the Internet is working properly, the <code>response</code> value you get in the cell is a 200 HTTP reply with a body full of JSON data.
I'll assume your Internet is fine, and first take a peek at the status and first 150 characters of the body, just to have an idea of what's inside.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=5aaad563-86d0-4cff-a6d7-0e9a4f551a52">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [49]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.ByteString.Lazy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">LBS</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Text.Lazy.Encoding</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TL</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Text.Lazy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TL</span>

<span class="nf">print</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"status: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">response</span><span class="o">.</span><span class="n">responseStatus</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">", body: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="kt">Prelude</span><span class="o">.</span><span class="n">take</span><span class="w"> </span><span class="mi">150</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">TL</span><span class="o">.</span><span class="n">unpack</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">TL</span><span class="o">.</span><span class="n">decodeUtf8</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">response</span><span class="o">.</span><span class="n">responseBody</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>"status: Status {statusCode = 200, statusMessage = \"OK\"}, body: {\"Count\":11316,\"Message\":\"Response returned successfully\",\"SearchCriteria\":null,\"Results\":[{\"Make_ID\":12858,\"Make_Name\":\"#1 ALPINE CUSTOMS\"},{\"Make_ID"</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=64adbb79-9471-426c-9416-f11d964a5749">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>That example should show you a 200 <code>statusCode</code>, and then a body where you can see the beginning of a long JSON payload of strings-in-a-string full of escaped sequences ('' is the escape character).</p>
<p>The example also shows the string conversion gymnastic that is typical of Haskell programming. There are many ways to encode string data (for scanning, for compactness, for high-speed string manipulations, etc). Given Haskell extensive level of precision available to manage strings, it becomes a habit to convert strings between the optimal implementations required by different utilisations. In our example, 3 typical string packages are imported and then the <code>unpack</code> and <code>decodeUtf8</code> functions get the job done.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=fac4b39b-32b0-49ca-9a0a-86a19dc0468d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Assuming the HTTP response is indeed a 200, then we can move to upgrading the JSON string to Haskell data structures.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c6ec3c6f-9681-46d2-b332-483dbafb056d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2>Using JSON and meta-programming</h2>
<p>The conversion between JSON and Haskell values is normally done <em>automagically</em>. Nonetheless we'll look at how the magic happens, since it is an introduction to meta-programming features of Haskell.</p>
<p>The basic setup to <strong>manipulate code with code</strong> during compilation is the use of the <code>GHC.Generics</code> core Haskell package together with the <code>DeriveGeneric</code> and <code>DeriveAnyClass</code> modes.</p>
<p><strong>Golang</strong> and other recent language compilers provide some features to transform a JSON string into a <code>struct</code> and vice-versa, something that is achieved through support logic that is fairly hidden within the compiler itself.</p>
<p>In Haskell the meta-programming system is used so that one can extend or modify at will the behavior of the transformation.  It is a blessing for automatizing the generation of boiler-plate code and doing all kind of further code generation from a few lines provided by the developer.</p>
<p>The <a href="https://hackage.haskell.org/package/aeson">Aeson</a> package comes with the necessary logic to introspect a data structure, ie a <em>type</em>, and automatically generate at compile-time the additional logic to parse JSON strings into values of that given type, and/or generate JSON representations of values of that type.</p>
<p>For example:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=11a25973-b4f6-436e-84a5-7304b4d9f05c">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [50]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="cm">{-# LANGUAGE DeriveGeneric #-}</span>
<span class="cm">{-# LANGUAGE DeriveAnyClass #-}</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">GHC.Generics</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Aeson</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">J</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">SimpleThing</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">ST</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">aField</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">anotherField</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="p">,</span><span class="w"> </span><span class="kt">Generic</span><span class="p">,</span><span class="w"> </span><span class="kt">J</span><span class="o">.</span><span class="kt">FromJSON</span><span class="p">,</span><span class="w"> </span><span class="kt">J</span><span class="o">.</span><span class="kt">ToJSON</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=fa58cf1b-3b41-405f-8b62-4c6d9d12d4c9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>SimpleThing</code> type defined here is a simple record with a <code>String</code> and an <code>Int</code> fields, there's nothing special about that. The interesting part is the <code>deriving</code> keyword that comes after the data structure definition, together with the tuple of type names (remember, upper case first letter is for types and modules). That <em>derivation</em> command triggers the Haskell compiler to launch meta-programming handling and effectively generate all the required logic to convert a value into a string representation (<code>Show</code>), to create an introspective representation of the type (<code>Generic</code>), and finally to create conversion logic to go back and forth between a value of <code>SimpleThing</code> and its JSON representation (<code>FromJSON</code>, <code>ToJSON</code>).</p>
<p>None of that generated code shows up, but the compiler will remember it's there and will use it whenever required.</p>
<p><strong>Note</strong> that <code>Show</code>, <code>Generic</code> and etc aren't really types, they are <em>typeclasses</em>... we'll talk about the difference in a few cells.</p>
<p>Now let's create a value of <code>SimpleThing</code> type, then show it as a string and go between Haskell internal representation and JSON. All that is standard operations in web applications:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=ba2767ec-5fb4-42ba-a65b-a7ef7e3ee606">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [51]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">simpleThing</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">ST</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">aField</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"first value"</span><span class="p">,</span><span class="w"> </span><span class="n">anotherField</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="p">}</span>

<span class="c1">-- Use the Show code to convert the value to a string.</span>
<span class="nf">print</span><span class="w"> </span><span class="n">simpleThing</span>

<span class="c1">-- Use the ToJSON code to get a JSON string out of the value.</span>
<span class="kt">J</span><span class="o">.</span><span class="n">encode</span><span class="w"> </span><span class="n">simpleThing</span>

<span class="c1">-- Parse the JSON string to get a SimpleThing value.</span>
<span class="nf">simpleJson</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"{</span><span class="se">\"</span><span class="s">aField</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="s">first value</span><span class="se">\"</span><span class="s">,</span><span class="se">\"</span><span class="s">anotherField</span><span class="se">\"</span><span class="s">:100}"</span>
<span class="nf">show</span><span class="w"> </span><span class="p">(</span><span class="kt">J</span><span class="o">.</span><span class="n">decode</span><span class="w"> </span><span class="n">simpleJson</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">SimpleThing</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>ST {aField = "first value", anotherField = 100}</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>"{\"aField\":\"first value\",\"anotherField\":100}"</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>"Just (ST {aField = \"first value\", anotherField = 100})"</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=daed3b5d-50e9-4f4b-b4da-93ffc21d39e9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Having derived <code>SimpleThing</code> with <code>ToJSON</code>, the <code>encode</code> function will apply the <em>Aeson</em> conversion logic and convert a <code>SimpleThing</code> value to a JSON string as we'd expect.</p>
<p>Then the <code>decode simpleJson</code> function is asked to be of type <code>Maybe SimpleThing</code>.  That instructs the compiler to apply the <em>Aeson</em> conversion logic to go from a JSON string to a <code>SimpleThing</code> value.</p>
<p>This is the first time we encounter the <code>Maybe</code> type, a pillar of Haskell programming. It is the standard way to manage optional results, similarly to the <code>?</code> symbol in <strong>Rust</strong> or <strong>TypeScript</strong>. Most importantly <code>Maybe</code> does away with the usual <code>null</code> or <code>undefined</code> issues of so many other programming languages.  It is an additive type, which uses two value constructors: <code>Nothing</code> and <code>Just &lt;a-value&gt;</code>. So when a function can either emit a result or return a void, we'll define it as a <code>Maybe &lt;some-type&gt;</code> function.</p>
<p>In this example the <code>decode</code> function does its magic and returns a <code>Just SimpleThing</code> value, which is then shown as a string. If the <code>decode</code> function couldn't figure out how to parse the JSON, it would simply return a <code>Nothing</code>. If you worry about error management, <code>decodeEither</code> is the answer but I won't get into that now.</p>
<p>The way <em>Aeson</em> meta-programming logic can be expanded for extension/modification is especially important given the way AI code generation is coming about. Unfortunately meta-programming is a huge topic and we need to keep moving, so we'll cover very little of that amazing Haskell feature.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=a955e48b-7742-4c3e-8864-f414903c2357">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Going back to the <code>vehicleFetch</code> example, we can now define the <code>ResponseVehicle</code> and <code>CarDescription</code> data structures to hold the content returned in JSON format.</p>
<p>When using 3rd party APIs in real life, it's not always neat and simple to parse the JSON fields.  In the case of the <em>Vehicle API</em>, the top-level JSON object fields start with an uppercase letter, and then the individual car description object has a 'Make_' prefix for its fields that's redundant.  On the other hand, Haskell fields in a record must start with a lowercase letter, and we don't want to have to carry the 'make_' prefix in our code.</p>
<p>To deal with the structure impedence, we'll inject a few modifications to the default meta-programming logic that deals with the conversion of JSON representations, using the <code>instance</code> keyword instead of <code>deriving</code> one to specify our own FromJSON implementation.  And yes, <code>instance</code> means <em>instance of a class</em>! As mentioned previously, Haskell as a <em>typeclass</em> concept. It isn't object-oriented programming but it does enable to group common features into <em>classes</em> and then assign them to types through <em>derivation</em>. Further more these features can be extended as required for meta-programming purposes through <em>instantiation</em> specialization.  It's yet another very interesting aspect of Haskell that we don't have time to dig into!</p>
<p>Here's the code to represent the vehicle info in Haskell as a <code>ResponseVehicle</code> and <code>CarDescription</code> types, and parse the respective JSON representations:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=4fe257de-17f2-4c48-9007-5cc65c9ac549">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [52]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Char</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">C</span>

<span class="c1">-- Specify the structures for holding the API overall reply and each car specification.</span>
<span class="kr">data</span><span class="w"> </span><span class="kt">ResponseVehicle</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">ResponseVehicle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">count</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">searchCriteria</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">String</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">CarDescription</span><span class="w"> </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="p">,</span><span class="w"> </span><span class="kt">Generic</span><span class="p">)</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">CarDescription</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">CarDescription</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">uid</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="p">,</span><span class="w"> </span><span class="kt">Generic</span><span class="p">)</span>


<span class="c1">-- Extend the JSON-conversion logic of Aeson with specific logic for the Vehicle API format:</span>
<span class="kr">instance</span><span class="w"> </span><span class="kt">J</span><span class="o">.</span><span class="kt">FromJSON</span><span class="w"> </span><span class="kt">CarDescription</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">parseJSON</span><span class="w"> </span><span class="p">(</span><span class="kt">J</span><span class="o">.</span><span class="kt">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">CarDescription</span><span class="w"> </span><span class="o">&lt;$&gt;</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="kt">J</span><span class="o">..:</span><span class="w"> </span><span class="s">"Make_ID"</span><span class="w"> </span><span class="o">&lt;*&gt;</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="kt">J</span><span class="o">..:</span><span class="w"> </span><span class="s">"Make_Name"</span>

<span class="kr">instance</span><span class="w"> </span><span class="kt">J</span><span class="o">.</span><span class="kt">FromJSON</span><span class="w"> </span><span class="kt">ResponseVehicle</span><span class="w"> </span><span class="kr">where</span>
<span class="w">    </span><span class="n">parseJSON</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">J</span><span class="o">.</span><span class="n">genericParseJSON</span><span class="w"> </span><span class="kt">J</span><span class="o">.</span><span class="n">defaultOptions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">J</span><span class="o">.</span><span class="n">fieldLabelModifier</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">firstUpper</span><span class="w"> </span><span class="p">}</span>

<span class="c1">-- Define a 'make first letter upper-case' helper:</span>
<span class="nf">firstUpper</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="kt">:</span><span class="n">cs</span><span class="p">)</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">C</span><span class="o">.</span><span class="n">toUpper</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="kt">:</span><span class="w"> </span><span class="n">cs</span>
<span class="nf">firstUpper</span><span class="w"> </span><span class="kt">[]</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">[]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=e54f7abf-1a52-4beb-be58-6ca0f1bb449e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>parseJSON</code> function of the FromJSON typeclass in the <em>Aeson</em> package is the entry point for the basic conversion from JSON to a Haskell value. In the code above, the <code>instance J.FromJSON CarDescription where</code> means that we'll add to the existing meta-programming logic of <em>Aeson</em>'s <code>FromJSON</code> typeclass. We then provide a new definition for <code>parseJSON</code> that builds a <code>CarDescription</code> value from the <code>Make_ID</code> and <code>Make_Name</code> fields found in the JSON data.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=56692e6c-8cfa-4248-bbe8-a35091019ad0">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The somewhat cryptic <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code> symbols are simply helper functions used to apply other functions within the <em>containers</em> the JSON values are stored in.  They are worth looking into a bit more.</p>
<p>Let's use these helpers for doing math with values that are within the <code>Maybe</code> container. Let's say we have some numbers from a function that may return nothing, so they are contained by a <code>Just</code>:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=46e4759d-a5f4-4ff9-b7dd-3cded02edcf9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [53]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="p">(</span><span class="o">+</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;$&gt;</span><span class="w"> </span><span class="kt">Just</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&lt;*&gt;</span><span class="w"> </span><span class="kt">Just</span><span class="w"> </span><span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Just 7</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=2bfe996b-8242-424f-ada7-237a64763c4b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>&lt;$&gt;</code> push the <code>+</code> function into the first parameter, and the <code>&lt;*&gt;</code> connects it into the second one. That means we can add the integers and then put the sum back into the same kind of <code>Just</code> container.  The neat thing is that those helpers follow the rules of the container, so in the case of:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=cdb75691-4981-4322-8a6f-c7350d0ceb9a">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [54]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="p">(</span><span class="o">+</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;$&gt;</span><span class="w"> </span><span class="kt">Just</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">&lt;*&gt;</span><span class="w"> </span><span class="kt">Nothing</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Nothing</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=2dccda22-80d7-4bbb-8f65-c4194d8b56a6">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>we see that the result isn't a crash but rather a reasonable <code>Nothing</code> value. That's because the rules of the <code>Maybe</code> type are enforced by <code>&lt;$&gt;</code> and <code>&lt;*&gt;</code>, leading to the <code>+</code> function behaving correctly even with a <code>Nothing</code> value although it doesn't know anything about the <code>Maybe</code> container.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=597f1e7a-1027-4240-a8f2-da68f5f0efab">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note:</strong> the weird <code>J..:</code> syntax is <em>Aeson</em>'s field value extractor function <code>.:</code> prefixed with the <code>J</code> package.  As noted before, there are just few syntax rules in Haskell, so exotic function names are frequent, such as <code>.:</code>, or <code>!</code> for Blaze. The decision to use the package prefix everywhere in the code of this notebook is resulting in some weird looking code...</p>
<p>Going back to the <code>parseJSON</code> function extended for the <code>ResponseVehicle</code> data structure, we use a different strategy. Instead of providing new extraction logic in the extension we simply modify the configuration parameters of <em>Aeson</em>'s <code>genericParseJSON</code> function: the <code>fieldLabelModifier</code> of the <code>defaultOptions</code> value is updated with a function that maps the first character of each field name to an uppercase value. That's it.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=3c584434-6dfd-4af7-9ac0-d6d07d09dbea">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Getting the JSON data returned by the Vehicle API to Haskell values is then a simple <code>J.decode</code> call; the on-the-fly generated logic takes care of field mapping, sub-objects resolution, array parsing, etc. Further more, if you were to look at the generated code (it's possible to ask the compiler to spit it out), you'd see it is fast and efficient because it's fine-tuned for each kind of JSON conversion required. For example we used the <code>Text</code> type for the <code>name</code> field in the <code>CarDescription</code>, which is a more efficient string implementation than <code>String</code>, and thus the generated JSON parsing logic for that perticular kind of string will also be used in the <code>CarDescription</code> JSON translation logic. Compare that to for example <strong>Go</strong> JSON parsing of complex structures with conditionals and recursion...</p>
<p>In the next block of code, we bring back Blaze to get HTML beautification for the values converted from JSON and to show how we typically deal with <code>Maybe</code> situations. Why do <em>print</em> when it's simple and so much nicer preview values of complex types in HTML?</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=992d2f8e-1781-4a66-a5a3-9b11a071bd8b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [55]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">showCar</span><span class="w"> </span><span class="n">aDescription</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="kt">H</span><span class="o">.</span><span class="n">b</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">useString</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">unpack</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">aDescription</span><span class="o">.</span><span class="n">name</span>
<span class="w">  </span><span class="kt">H</span><span class="o">.</span><span class="n">i</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">useString</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">" (id: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">aDescription</span><span class="o">.</span><span class="n">uid</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">")"</span>

<span class="nf">mbApiResponse</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">J</span><span class="o">.</span><span class="n">decode</span><span class="w"> </span><span class="n">response</span><span class="o">.</span><span class="n">responseBody</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">ResponseVehicle</span>

<span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">case</span><span class="w"> </span><span class="n">mbApiResponse</span><span class="w"> </span><span class="kr">of</span>
<span class="w">  </span><span class="kt">Nothing</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">b</span><span class="w"> </span><span class="s">"No result."</span>
<span class="w">  </span><span class="kt">Just</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">    </span><span class="kr">let</span>
<span class="w">      </span><span class="n">count</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">result</span><span class="o">.</span><span class="n">count</span>
<span class="w">    </span><span class="kr">in</span>
<span class="w">      </span><span class="kr">if</span><span class="w"> </span><span class="kt">Prelude</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="n">result</span><span class="o">.</span><span class="n">results</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="kr">then</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">b</span><span class="w"> </span><span class="s">"Nothing???"</span>
<span class="w">        </span><span class="kr">else</span><span class="w"> </span><span class="kr">do</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">b</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">useString</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"Got "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">" descriptions, the first few ones are:"</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">br</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">ul</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">mapM_</span><span class="w"> </span><span class="p">(</span><span class="kt">H</span><span class="o">.</span><span class="n">li</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">showCar</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">Prelude</span><span class="o">.</span><span class="n">take</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">result</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><div>
<b>
        Got 11316 descriptions, the first few ones are:
    </b>
<br/>
<ul>
<li>
<b>
                #1 ALPINE CUSTOMS
            </b>
<i>
                 (id: 12858)
            </i>
</li>
<li>
<b>
                1/OFF KUSTOMS, LLC
            </b>
<i>
                 (id: 4877)
            </i>
</li>
<li>
<b>
                102 IRONWORKS, INC.
            </b>
<i>
                 (id: 11257)
            </i>
</li>
<li>
<b>
                12832429 CANADA INC.
            </b>
<i>
                 (id: 12255)
            </i>
</li>
<li>
<b>
                17 CREEK ENTERPRISES
            </b>
<i>
                 (id: 6387)
            </i>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=843d9c9b-45ce-4d74-b55a-69780f0c8fc7">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>At this point you should be able to read the code easily. The only new item is the <code>mapM_</code> function, which is an iterator specialized for <em>Monads</em> values.</p>
<p>As you can see, server-side HTML content generation from scratch is simple. But for many people, it's even simpler to work out of text templates.  Let's do that too!</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c859e178-414f-43ca-802a-bbc477844e16">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2>Using Jinja2 HTML templates</h2>
<p>In the Haskell ecosystem, the Ginger package is the go-to for using Jinja2 templates.</p>
<p>In the following example, the <code>DotValue</code> structure will represent our app-specific information. We extend the Ginger logic using meta-programming on the <code>DotValue</code> that will later be applied in the template runtime context.  Then a text file is loaded (it's the template!), it is parsed and finally the Ginger VM runs the template logic with the data context to produce HTML.</p>
<p>The first test template is using <strong>Tailwind CSS</strong> to add styling to the Jupyter notebook bland look, and it's also using the <strong>D3.js</strong> library for implementing data visualization. That has nothing to do with Haskell but at this point using <em>markdown</em> is boring.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=e606982f-1316-4b8e-8634-ad18c5c8af91">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>First let's define <code>DotValue</code>, which will be a sum type that holds 2 simple data structures, for string and circle, and two container values, for list and dictionary.  You can see here the common functional habit of using self-referencing definitions:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=b2343132-41c2-4b60-b079-7535833889c2">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [56]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="nn">Control.Monad.Identity</span><span class="w"> </span><span class="p">(</span><span class="nf">runIdentity</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Map</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Mp</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Text.Ginger</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Gi</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Text.Ginger.Html</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Gi</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">DotValue</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">StrV</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">CircleV</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="kt">String</span><span class="w">  </span><span class="c1">-- quick and dirty way to provide x,y pos, radius and color.</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">DictV</span><span class="w"> </span><span class="p">(</span><span class="kt">Mp</span><span class="o">.</span><span class="kt">Map</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span><span class="w"> </span><span class="kt">DotValue</span><span class="p">)</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">ListV</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">DotValue</span><span class="w"> </span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d273a514-5961-4c8a-9890-a62cf51a4ca8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Then we provide the logic for transforming a <code>DotValue</code> value into a <em>Ginger</em>'s <code>GVal</code>.  For the first 3 of the 4 kind of values, Ginger default converter will do the remap automatically. The <code>CircleV</code> conversion requires some work, as each of the record's fields needs to be mapped into a named value. That additional informatin will tell the <strong>Javascript</strong> code in the template how to pass along the right data to the <strong>D3.js</strong> functions for getting <strong>SVG</strong> diagrams.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=f9167f6c-c881-4e6d-ab30-dfcef724f3db">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [57]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="c1">-- Enable the use of the "\case" shortcut (f x = case x of ... =&gt; f = \case ...):</span>
<span class="cm">{-# LANGUAGE LambdaCase #-}</span>

<span class="kr">instance</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="kt">ToGVal</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="kt">DotValue</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">toGVal</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="nf">\</span><span class="kr">case</span>
<span class="w">    </span><span class="kt">StrV</span><span class="w"> </span><span class="n">aString</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">toGVal</span><span class="w"> </span><span class="n">aString</span>
<span class="w">    </span><span class="kt">DictV</span><span class="w"> </span><span class="n">aMap</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">toGVal</span><span class="w"> </span><span class="n">aMap</span>
<span class="w">    </span><span class="kt">ListV</span><span class="w"> </span><span class="n">aList</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">toGVal</span><span class="w"> </span><span class="n">aList</span>
<span class="w">    </span><span class="kt">CircleV</span><span class="w"> </span><span class="n">cX</span><span class="w"> </span><span class="n">cY</span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">toGVal</span><span class="w"> </span><span class="o">$</span>
<span class="w">            </span><span class="kt">Mp</span><span class="o">.</span><span class="n">fromList</span><span class="w"> </span><span class="p">[</span>
<span class="w">              </span><span class="p">(</span><span class="s">"cx"</span><span class="p">,</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">cX</span><span class="p">)</span><span class="w">  </span><span class="ow">::</span><span class="w"> </span><span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span><span class="p">,</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>
<span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"cy"</span><span class="p">,</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">cY</span><span class="p">)</span>
<span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"radius"</span><span class="p">,</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">radius</span><span class="p">)</span>
<span class="w">              </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"color"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">)</span>
<span class="w">            </span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=8c03f158-24fa-4558-8e2c-7d4bdad9bcd3">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>Map</code> dictionary is initialized from a list of pairs (2-tuples).</p>
<p><span class="text-red-800">WARNING: TYPES INVOLVED!</span> The <code>Map</code> requires that we specify the key and value types given there are many valid choices. We provide that information for the first value of the list and that is enough to get all the rest of the typing figured out.</p>
<p>In this example we use a common Haskell structure, the tuple <code>(&lt;value&gt;, &lt;value&gt;)</code>.  Tuples are standard in most modern languages, and I expect they work just like you think they should.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=ce1185e9-c05f-4e8f-8db4-162b8a22e7ae">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We then assemble some mock data and store it all as the <code>demoData_1</code> term.  Although we're dealing with complex typing possibilities, the compiler is still able to figure out what is what and we have no typing details for any function to provide.</p>
<p>Also let's recycle the data from the Vehicle API used earlier on if there's some available.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=bcc86940-d4a4-497f-81e3-1f9add9058a4">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [58]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">demoNavList</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">case</span><span class="w"> </span><span class="n">mbApiResponse</span><span class="w"> </span><span class="kr">of</span>
<span class="w">  </span><span class="kt">Nothing</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">    </span><span class="kr">let</span>
<span class="w">      </span><span class="n">nav_1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Mp</span><span class="o">.</span><span class="n">fromList</span><span class="w"> </span><span class="p">[</span>
<span class="w">         </span><span class="p">(</span><span class="s">"url"</span><span class="p">,</span><span class="w"> </span><span class="kt">StrV</span><span class="w"> </span><span class="s">"https://gaga.com/url_1"</span><span class="p">)</span>
<span class="w">       </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"label"</span><span class="p">,</span><span class="w"> </span><span class="kt">StrV</span><span class="w"> </span><span class="s">"Gaga"</span><span class="p">)</span>
<span class="w">       </span><span class="p">]</span>
<span class="w">      </span><span class="n">nav_2</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Mp</span><span class="o">.</span><span class="n">fromList</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="p">(</span><span class="s">"url"</span><span class="p">,</span><span class="w"> </span><span class="kt">StrV</span><span class="w"> </span><span class="s">"https://gougou.com/url_1"</span><span class="p">)</span>
<span class="w">       </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"label"</span><span class="p">,</span><span class="w"> </span><span class="kt">StrV</span><span class="w"> </span><span class="s">"Gougou"</span><span class="p">)</span>
<span class="w">       </span><span class="p">]</span>
<span class="w">    </span><span class="kr">in</span><span class="w"> </span>
<span class="w">    </span><span class="kt">ListV</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">DictV</span><span class="w"> </span><span class="n">nav_1</span><span class="p">,</span><span class="w"> </span><span class="kt">DictV</span><span class="w"> </span><span class="n">nav_2</span><span class="w"> </span><span class="p">]</span>
<span class="w">  </span><span class="kt">Just</span><span class="w"> </span><span class="n">apiResponse</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">    </span><span class="kr">let</span>
<span class="w">      </span><span class="n">subList</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Prelude</span><span class="o">.</span><span class="n">take</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">apiResponse</span><span class="o">.</span><span class="n">results</span>
<span class="w">    </span><span class="kr">in</span>
<span class="w">      </span><span class="kt">ListV</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Prelude</span><span class="o">.</span><span class="n">map</span><span class="w"> </span><span class="n">carDescToTuple</span><span class="w"> </span><span class="n">subList</span>
<span class="w">  </span><span class="kr">where</span>
<span class="w">    </span><span class="n">carDescToTuple</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="ow">=</span>
<span class="w">        </span><span class="kt">DictV</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Mp</span><span class="o">.</span><span class="n">fromList</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">(</span><span class="s">"url"</span><span class="p">,</span><span class="w"> </span><span class="kt">StrV</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"http://https://vpic.nhtsa.dot.gov/api/vehicles/getmake?id="</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">cd</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"label"</span><span class="p">,</span><span class="w"> </span><span class="kt">StrV</span><span class="w"> </span><span class="n">cd</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="w">        </span><span class="p">]</span>

<span class="nf">circles</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="kt">CircleV</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="s">"green"</span><span class="w">  </span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="kt">CircleV</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="mi">45</span><span class="w"> </span><span class="s">"red"</span><span class="w">  </span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="kt">CircleV</span><span class="w"> </span><span class="mi">85</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="s">"blue"</span><span class="w">  </span>
<span class="w">  </span><span class="p">]</span>

<span class="nf">demoData_1</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Mp</span><span class="o">.</span><span class="n">fromList</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">(</span><span class="s">"title"</span><span class="p">,</span><span class="w"> </span><span class="kt">StrV</span><span class="w"> </span><span class="s">"Haskell, Hidden Gem"</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"navigation"</span><span class="p">,</span><span class="w"> </span><span class="n">demoNavList</span><span class="p">)</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"circles"</span><span class="p">,</span><span class="w"> </span><span class="kt">ListV</span><span class="w"> </span><span class="n">circles</span><span class="p">)</span>
<span class="w">  </span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c4366ada-de84-4ace-92e0-9644e46907d9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>As usual, no need to bother with type annotations. Yet it's worth looking under the hood and find out what was inferred for the <code>demoData_1</code>. That's done with the <code>:t</code> feature of the notebook, as in:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=274923e1-a726-483a-bbf2-62678f431981">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [59]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kt">:</span><span class="n">t</span><span class="w"> </span><span class="n">demoData_1</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><span class="get-type">demoData_1 :: forall {k}. (Ord k, IsString k) =&gt; Map k DotValue</span>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=63d3d0ee-7524-4cb3-b98a-140c55ace3d8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The type definition provided by the compiler shows there are a <code>Map</code> of <code>DotValue</code> values involved (that's the dictionary and its values). Interestingly for the keys the only possible inference is on polymorphic constraints: <code>Ord k</code> means <code>k</code> can be ordered, and <code>IsString k</code> means <code>k</code> must be able to be dealth with as a String. Even if the inference is partial, it's enough to move forward. Furter use of that <code>demoData_1</code> function will resolve what kind of string variation the keys are using.</p>
<p>While it may be convenient to let the compiler do all the type management, it is a good habit to lock in some of the types, so a more prudent approach of writing the <code>demoData</code> definition would be to specify:</p>
<pre><code>demoData_1 :: Mp.Map T.Text DotValue</code></pre>
<p>if we want to make sure that the <code>Text</code> implementation of strings is used.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=b1cac00b-82e8-42e2-b599-00cb109ed0c9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>readFile</code> function takes care of loading data from a file, that's basic stuff.  But as this is an <em>impure</em> operation, we use the <code>&lt;-</code> symbol to extract the result back into the <em>pure</em> context.
If the file doesn't exist, the <code>readFile</code> function will throw an exception. Yes, the Haskell runtime uses exceptions...</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=ff66df01-b67f-493d-80d8-2fdd66d7eb42">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [60]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">template_1</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kt">Prelude</span><span class="o">.</span><span class="n">readFile</span><span class="w"> </span><span class="s">"ph_1/xstatic/templates/templ_1.html"</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=3e0a72b5-baeb-42b3-b7fd-e178491993c0">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The handling of included templates and errors that can show up during the parsing of the template text just loaded up requires to provide a few things when calling the `parseGinger' function:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=add5f898-c97f-4ebf-881b-1db5e40c7918">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [61]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">loadTemplate</span><span class="w"> </span><span class="n">aTemplate</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">either</span><span class="w"> </span><span class="p">(</span><span class="ne">error</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">show</span><span class="p">)</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">runIdentity</span><span class="w"> </span><span class="o">$</span>
<span class="w">    </span><span class="kt">Gi</span><span class="o">.</span><span class="n">parseGinger</span><span class="w"> </span><span class="p">(</span><span class="n">const</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="kt">Nothing</span><span class="p">)</span><span class="w"> </span><span class="kt">Nothing</span><span class="w"> </span><span class="n">aTemplate</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=7a183276-ebd3-4b35-9828-404f683ba9b7">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The first parameter of <code>parseGinger</code> is a file resolver to handle additional templates included in the first one; it is a function that will receive a path and figure out how to fetch additional content. In our case, we pass a do-nothing function, <code>const $ return Nothing</code>, so no additional templates can be included.</p>
<p><strong>Note:</strong> this being Haskell, <code>return</code> is not a keyword, but a function! It does the opposite of the <code>&lt;-</code> extractor used in monadic context, embedding a <em>naked</em> value into a monadic container. In the case of the <strong>IO</strong> monad, it makes the <code>Nothing</code> value become the equivalent of an IO operation that didn't produce anything.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=a5c0865f-684e-4172-8592-22f2dba3bff7">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The Ginger VM needs a way to dereference values during the template execution. We use the <code>lookup</code> function to do that: it simply gets the template variable name as a parameter called <code>needle</code> and finds that in the <code>demoData</code> dictionary.</p>
<p>Then the logic provided in the instance of <code>ToGVal</code> for <code>DotValue</code> will do the rest of the work in getting the data into the constructed HTML.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=083e67fa-0d8b-40f8-9a40-ba476d5821e0">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [62]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">derefLabel</span><span class="w"> </span><span class="n">needle</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">Gi</span><span class="o">.</span><span class="n">toGVal</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Mp</span><span class="o">.</span><span class="n">lookup</span><span class="w"> </span><span class="n">needle</span><span class="w"> </span><span class="n">demoData_1</span>

<span class="nf">tmplDemo</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">Gi</span><span class="o">.</span><span class="n">runGinger</span><span class="w"> </span><span class="p">(</span><span class="kt">Gi</span><span class="o">.</span><span class="n">makeContextHtml</span><span class="w"> </span><span class="n">derefLabel</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">loadTemplate</span><span class="w"> </span><span class="n">template_1</span><span class="p">)</span>

<span class="kt">Gi</span><span class="o">.</span><span class="n">htmlSource</span><span class="w"> </span><span class="n">tmplDemo</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet"/>
<title>Haskell, Hidden Gem</title>
<script cross-origin="anonymous" src="https://unpkg.com/d3@7.8.5/dist/d3.min.js" type="text/javascript"></script>
</head>
<body>
<div class="container bg-gray-500 mx-auto p-4">
<h1 class="text-2xl text-red-900 font-bold mb-4">Haskell, Hidden Gem</h1>
<table class="min-w-full bg-orange-500 border border-gray-300">
<thead>
<tr>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-100 uppercase tracking-wider border-b">Name</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-100 uppercase tracking-wider border-b">Destination</th>
</tr>
</thead>
<tbody>
<tr>
<td class="text-blue-800">#1 ALPINE CUSTOMS</td>
<td class="text-green-600"><a href="http://https://vpic.nhtsa.dot.gov/api/vehicles/getmake?id=12858">#1 ALPINE CUSTOMS</a></td>
</tr>
<tr>
<td class="text-blue-800">1/OFF KUSTOMS, LLC</td>
<td class="text-green-600"><a href="http://https://vpic.nhtsa.dot.gov/api/vehicles/getmake?id=4877">1/OFF KUSTOMS, LLC</a></td>
</tr>
<tr>
<td class="text-blue-800">102 IRONWORKS, INC.</td>
<td class="text-green-600"><a href="http://https://vpic.nhtsa.dot.gov/api/vehicles/getmake?id=11257">102 IRONWORKS, INC.</a></td>
</tr>
<tr>
<td class="text-blue-800">12832429 CANADA INC.</td>
<td class="text-green-600"><a href="http://https://vpic.nhtsa.dot.gov/api/vehicles/getmake?id=12255">12832429 CANADA INC.</a></td>
</tr>
<tr>
<td class="text-blue-800">17 CREEK ENTERPRISES</td>
<td class="text-green-600"><a href="http://https://vpic.nhtsa.dot.gov/api/vehicles/getmake?id=6387">17 CREEK ENTERPRISES</a></td>
</tr>
</tbody>
</table>
</div>
<div class="flex p-5 justify-center" id="d3 demo">
<svg height="200" id="dataviz_area" width="450"></svg>
<script>
          var svg = d3.select("#dataviz_area")
          var x = d3.scaleLinear()
            .domain([0, 100])         // This is the min and the max of the data: 0 to 100 if percentages
            .range([0, 400]);       // This is the corresponding value I want in Pixel

          // Show the axis that corresponds to this scale
          svg.call(d3.axisBottom(x));

                      svg.append("circle").attr("cx", x(20))
              .attr("cy", 90).attr("r", 40 )
              .style("fill", "green");
                      svg.append("circle").attr("cx", x(50))
              .attr("cy", 90).attr("r", 45 )
              .style("fill", "red");
                      svg.append("circle").attr("cx", x(85))
              .attr("cy", 90).attr("r", 50 )
              .style("fill", "blue");

        </script>
</div>
</body>
</html>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d1daed75-1959-4e81-bcc5-9e01c3f0ac6b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>htmlSource</code> function simply converts the <code>Ginger</code> internal representation of HTML produced by the <code>runGinger</code> function into the one required by the notebook.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=83a5eb6a-1a8b-4221-9217-0d536a1f0337">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>You now know how to deal with JSON, fetch data from the web, create HTML content with either html-like code or Jinja2 templates.</p>
<p>Before moving forward, have a quick reflection on the template-based HTML generation vs going through interpreted Blaze logic. When doing quick iterations on developing a good looking HTML page, I now find myself to prefer the later... In fact, using <strong>Elm</strong> is my preferred way to generate HTML.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=41203194-065b-46d3-8895-4fb65cc87823">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>What else does a full-stack web app developer continuously work with in daily tasks? Databases and HTTP endpoint servicing!</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=fc7d13ae-7197-40df-a13d-fd7ab7033728">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2>Domain Specific Language and DB access</h2>
<p>The Domain Specific Language (DSL) capability of Haskell is a very cool feature that is somewhat at odds with it.  You have a language that is promoting a simple syntax and a functional approach... and then boom! with DSL the door opens up to pretty much any syntax and computing model you can come up with.</p>
<p>DSLs syntax are brought in by doing the relevant package import and then using the <em>QuasiQuotes</em> blocks to switch between Haskell and a DSL syntax.  This also requires to enable the <em>QuasiQuotes</em> mode with:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=90f61a21-471d-4916-a674-87a28d0f9d4d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [63]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="cm">{-# LANGUAGE QuasiQuotes #-}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=4c92aa15-9588-43a5-a029-0563f6f2e797">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We'll use some database interactions to showcase the benefits of DSLs. No matter how many ORM packages people come up with in their favorite ecosystem, they'll eventually conclude that <strong>SQL</strong> is the way to go for manipulations on anything bigger than toy datasets. Normally that means you have to write <strong>SQL</strong> statements as string constants with a bunch of question marks for parameter holes, invoke some execution functions, map out the results, etc.  It's error prone, it's very error prone, it's incredibly error prone and actually awkward.  If only you could write <strong>SQL</strong> as a first-class citizen, merged into the rest of the logic you can express with your favorite syntax.</p>
<p>The solution exists, it is <em>embedded SQL</em>: the ability to use your preferred language together with <strong>SQL</strong> statements that will be analyzed, syntax-verified, type-impedence resolved, and finally that will be executed transparently at runtime.  And if you have <strong>embedded SQL</strong>, you also want that in the latest version of the compiling toolchain at your disposition (when was the last version of the Pro*C compiler released?).</p>
<p>This is exactly what we can achieve with a <strong>SQL</strong> <em>DSL</em> in the GHC compiler, which means Haskell instantly becomes your favorite programming language.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=4b4cb582-1d04-4d61-987c-43a68145953d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <a href="https://hackage.haskell.org/package/hasql-th">Hasql-th</a> package provides the <strong>SQL</strong> syntax as a DSL as part of the excellent <a href="https://hackage.haskell.org/package/hasql">Hasql</a> family of facilities for Postgresql operations. In other words, you get a great support for embedded <strong>SQL</strong> in Haskell code.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=4337955b-ea67-44f5-a03a-4c390ee5a7e1">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Rather than doing function calls that pass <strong>SQL</strong> statements as strings, we can instead do <strong>SQL</strong> queries that are syntax- and type-checked at compile time.  So much for code breaks at runtime because you wrote <code>slect a from ...</code> instead of <code>select a from ...</code>.</p>
<p>To get started, a bunch of packages are brought into the namespace.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=f7487cc8-b757-4b0f-9c4d-db0ab494b56b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [64]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="nn">Data.ByteString</span>

<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Hasql.Connection</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DbC</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Hasql.Session</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Se</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Hasql.TH</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Th</span>

<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Vector</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Vc</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=8efce9b7-a4ca-4ca9-9c16-2a96a86858ea">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>To connect to the DB, credentials should be to get them from <em>outside</em> the notebook, eg from the Jupyter process' environment. If there's a <code>DBINFO</code> env var that contains the connection params separated by ':' symbol, it would be a matter of spliting that var value into 4 entries and then use that to define the <code>dbSettings</code>, as in:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=26808fac-d78c-4d03-8cae-de701a5b2623">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [65]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">System.Environment</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">SE</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Text.Encoding</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">T</span>

<span class="nf">dbInfo</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kt">SE</span><span class="o">.</span><span class="n">getEnv</span><span class="w"> </span><span class="s">"DBINFO"</span>

<span class="p">[</span><span class="w"> </span><span class="n">host</span><span class="p">,</span><span class="w"> </span><span class="n">db</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">paswd</span><span class="p">]</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Prelude</span><span class="o">.</span><span class="n">map</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">encodeUtf8</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">splitOn</span><span class="w"> </span><span class="s">":"</span><span class="w"> </span><span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="n">dbInfo</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=6ebc33c8-43e8-450a-ba1e-ab0fb92ebd8f">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note:</strong> the expectation here is that the env variable is made of a set of colon-separated values, it is loaded as a <code>String</code>, converted into <code>Text</code>, passed to the <code>splitOn</code> function (<code>String</code> has no such feature) which returns an array of values, each value is converted to a <code>ByteString</code> with the <code>encodeUtf8</code>, and finally stored in specific variables.  Always fun to do some string gymnastics.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=8b42f169-6233-4ed2-bab4-6221238d50ab">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>But as it's not clear how the Jupyter runtime for this notebook is spawned and given we use a free-tier demo db from SupaBase, hiding the connection information isn't even worth it:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=eb8c4c30-004d-4dd2-8219-4d7d8f7e34cd">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [66]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">dbSettings</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">DbC</span><span class="o">.</span><span class="n">settings</span><span class="w"> </span><span class="s">"aws-0-eu-central-1.pooler.supabase.com"</span><span class="w"> </span><span class="mi">5432</span><span class="w"> </span><span class="s">"demoa.vtjcwbccdutdqcsxdaqr"</span><span class="w"> </span><span class="s">"justForDemo"</span><span class="w"> </span><span class="s">"demoha"</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=7b3fe49d-25e2-4c56-8708-8ca96475af2a">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Our demo database provides basic information about the top starred and forked GitHub repos for the last 5 years. The source information is at <a href="https://github.com/EvanLi/Github-Ranking">GitHub Top 100</a>; I've simply parsed and normalized the CSV files into a more efficient SQL representation.</p>
<p>The <code>GhProject</code> structure provides a way to hold the de-normalized data within the interpreter runtime context. The example <strong>SQL</strong> code simply does a <em>select/join</em> over all normalized tables to fetch the data in the de-normalized format straight off the DB rather than having to performi that work in the Haskell side. In real life, you'll consider that such a de-normalization puts the workload on the RDBMS and the network bandwidth, and that it might be more efficient to fetch the data normalized to minimze RDBMS resources and network bandwidth utilization, and de-normalize in the app runtime context instead.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=96a2426e-c677-4a45-a06f-2ffc029f89ef">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [67]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Time.LocalTime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Lt</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Int</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DI</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">GhProject</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">GhProject</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">rank</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">DI</span><span class="o">.</span><span class="kt">Int32</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">stars</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">DI</span><span class="o">.</span><span class="kt">Int32</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">forks</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">DI</span><span class="o">.</span><span class="kt">Int32</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">language</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">uname</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">issues</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">DI</span><span class="o">.</span><span class="kt">Int32</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">lastCommit</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Lt</span><span class="o">.</span><span class="kt">LocalTime</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="p">}</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">TopGithubCtxt</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">TopGithubCtxt</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">headColumns</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span><span class="w"> </span><span class="p">]</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">GhProject</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=f030141f-571e-4690-a5c0-26e8ad7ecbdf">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Now we're getting to the real stuff: write a <strong>SQL</strong> statement to extract rows from the DB.</p>
<p><strong>Note:</strong> the syntax switch between Haskell and <strong>SQL</strong> is done using the <code>[&lt;context&gt;| &lt;statements ]</code> <em>QuasiQuoter</em> block.</p>
<p>The <em>Hasql-th</em> package provides a <code>[Th.vectorStatement|... |]</code> block to indicate that the <strong>SQL</strong> statement will return a vector of values. In that block, the query is written in almost standard <strong>SQL</strong>; that code will go through a proper <strong>SQL</strong> parser to produce internally the logic that will run in the DB engine.  Additionally the compiler will create glue code to pass values to the query from the Haskell world, and convert the raw data returned by the DB into a <code>Vector</code> of Haskell values. Being able to use the compiler to verify the <strong>SQL</strong> increases tremendously the reliability of the data manipulation code at runtime and eliminates a lot of testing requirements.</p>
<p>To retrieve a bunch of rows from our GitHub dataset, we define the <code>simpleQuery</code> function with embedded <strong>SQL</strong>:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=c03efb3e-c110-44c0-bbfa-c7a2afea892a">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [68]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Profunctor</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Pf</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Tuple.Curry</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Tc</span>

<span class="nf">simpleQuery</span><span class="w"> </span><span class="n">repoName</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">Se</span><span class="o">.</span><span class="n">statement</span><span class="w"> </span><span class="p">(</span><span class="n">repoName</span><span class="p">)</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Pf</span><span class="o">.</span><span class="n">dimap</span><span class="w"> </span><span class="n">matcherFromString</span><span class="w"> </span><span class="n">toGhProject</span>
<span class="w">    </span><span class="p">[</span><span class="kt">Th</span><span class="o">.</span><span class="n">vectorStatement</span><span class="o">|</span>
<span class="w">        </span><span class="n">select</span>
<span class="w">            </span><span class="n">o</span><span class="o">.</span><span class="n">rank</span><span class="ow">::</span><span class="n">int4</span><span class="p">,</span><span class="w"> </span><span class="n">ta</span><span class="o">.</span><span class="n">label</span><span class="ow">::</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">tb</span><span class="o">.</span><span class="n">label</span><span class="ow">::</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="o">.</span><span class="n">stars</span><span class="ow">::</span><span class="n">int4</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="o">.</span><span class="n">forks</span><span class="ow">::</span><span class="n">int4</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">tc</span><span class="o">.</span><span class="n">label</span><span class="ow">::</span><span class="n">text</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="n">td</span><span class="o">.</span><span class="n">label</span><span class="ow">::</span><span class="n">text</span><span class="o">?</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">te</span><span class="o">.</span><span class="n">label</span><span class="ow">::</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="o">.</span><span class="n">issues</span><span class="ow">::</span><span class="n">int4</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="o">.</span><span class="n">last_commit</span><span class="ow">::</span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="o">.</span><span class="n">description</span><span class="ow">::</span><span class="n">text</span><span class="o">?</span>
<span class="w">        </span><span class="n">from</span><span class="w"> </span><span class="kt">GithubTop100</span><span class="w"> </span><span class="n">o</span>
<span class="w">            </span><span class="n">left</span><span class="w"> </span><span class="n">join</span><span class="w"> </span><span class="n">itemu</span><span class="w"> </span><span class="n">ta</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">o</span><span class="o">.</span><span class="n">itemfk</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">ta</span><span class="o">.</span><span class="n">id</span>
<span class="w">            </span><span class="n">left</span><span class="w"> </span><span class="n">join</span><span class="w"> </span><span class="kt">RepoNameU</span><span class="w"> </span><span class="n">tb</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">o</span><span class="o">.</span><span class="n">reponamefk</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">tb</span><span class="o">.</span><span class="n">id</span>
<span class="w">            </span><span class="n">left</span><span class="w"> </span><span class="n">join</span><span class="w"> </span><span class="kt">LanguageU</span><span class="w"> </span><span class="n">tc</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">o</span><span class="o">.</span><span class="n">languagefk</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">tc</span><span class="o">.</span><span class="n">id</span>
<span class="w">            </span><span class="n">left</span><span class="w"> </span><span class="n">join</span><span class="w"> </span><span class="kt">UrlU</span><span class="w"> </span><span class="n">td</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">o</span><span class="o">.</span><span class="n">urlfk</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">td</span><span class="o">.</span><span class="n">id</span>
<span class="w">            </span><span class="n">left</span><span class="w"> </span><span class="n">join</span><span class="w"> </span><span class="kt">UserU</span><span class="w"> </span><span class="n">te</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">o</span><span class="o">.</span><span class="n">unamefk</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">te</span><span class="o">.</span><span class="n">id</span>
<span class="w">        </span><span class="kr">where</span><span class="w"> </span><span class="n">tb</span><span class="o">.</span><span class="n">label</span><span class="w"> </span><span class="n">ilike</span><span class="w"> </span><span class="o">$</span><span class="mi">1</span><span class="ow">::</span><span class="n">text</span>
<span class="w">        </span><span class="n">order</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">date_trunc</span><span class="p">(</span><span class="n">'day'</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="o">.</span><span class="n">last_commit</span><span class="p">)</span><span class="w"> </span><span class="n">desc</span>
<span class="w">            </span><span class="p">,</span><span class="w"> </span><span class="n">itemfk</span><span class="p">,</span><span class="w"> </span><span class="n">rank</span>
<span class="w">        </span><span class="n">limit</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="o">|</span><span class="p">]</span>
<span class="w">  </span><span class="kr">where</span>
<span class="w">  </span><span class="n">matcherFromString</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"%"</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">"%"</span>
<span class="w">  </span><span class="n">toGhProject</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">fmap</span><span class="w"> </span><span class="p">(</span><span class="kt">Tc</span><span class="o">.</span><span class="n">uncurryN</span><span class="w"> </span><span class="kt">GhProject</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=0a89631a-3e99-4915-b863-2f7c59664bd3">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>By <em>almost standard SQL</em>, I meant that the standard <strong>SQL</strong> syntax is extended with some type-annotations so that fields in the <code>select</code> statement are typed to both check consistency and specify <strong>SQL</strong>-to-Haskell value conversion.</p>
<p>The first parameter to the <code>statement</code> function specifies the values to use as dynamic entries in the <strong>SQL</strong> statement. In this case we only pass the <code>repoName</code> variable to limit the data fetch to a single repository. The 2nd parameter to the <code>statement</code> function can be either the <em>QuasiQuoter</em> block by itself or, as in the case here, conversion logic for dynamic entries and returned values that can be applied with a <code>dimap</code> association. Detailing the <a href="https://hackage.haskell.org/package/profunctors/docs/Data-Profunctor.html">ProFunctor</a> package where <code>dimap</code> is defined goes beyond the scope of this notebook, but you can figure out that the <code>matchterFromString</code> is an <em>encoder</em> function which simply adds <strong>SQL</strong> wildcards around the repo name, and a <em>decoder</em> function <code>toGhProject</code> which simply converts raw tuples of values returned by the select <strong>SQL</strong> statement into <code>GhProject</code> values through the application of the <code>uncurryN</code> helper (<code>uncurryN aFct (a1, a2, a3) = aFct a1 a2 a3</code>).</p>
<p>Parameters passed to the <strong>SQL</strong> block are referred to using their position. The <code>$1::text</code> notation that is used in the <code>where</code> clause means the <code>repoName</code> wildcard-wrapped by the <code>matcherFromString</code> <em>encoder</em>. The implementator of <em>Hasql-TH</em> preferred to use positional referencing, but with Haskell DSL it is also possible to use named params in <em>QuasiQuoter</em> blocks. In fact the <a href="https://hackage.haskell.org/package/hasql-interpolate/docs/Hasql-Interpolate.html">Hasql-Interpolate</a> extension package to <em>Hasql</em> will let you do just that and use <code>#{repoName}</code> notation instead of <code>$1::&lt;type&gt;</code>. The Haskell-to-<strong>SQL</strong> conversion is in this case automatic, but it will normally use meta-programming modifications when <strong>SQL</strong> or Haskell values are complex.</p>
<p>Given we have a <code>simpleQuery</code> function with embedded <strong>SQL</strong>, the next thing is to execute it within a DB session to get a <code>Vector</code> of <code>GhProject</code> values (or an error).</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=8f77311a-6fd9-4367-b2ba-c902d7aa7e1f">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Enough blah-blah, let's get a session to the DB server:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=8eb0ff3a-f59e-408e-a96a-92fd3a83e421">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [69]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">dbConn</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kt">DbC</span><span class="o">.</span><span class="n">acquire</span><span class="w"> </span><span class="n">dbSettings</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre></pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d450444d-5e51-4cef-9fc3-c8e073e12fbc">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Going out over a socket to a DB server somewhere on the Internet is definitely not <em>pure</em>, so we use the <code>&lt;-</code> to bring back the result from the <code>acquire</code> call in <em>pure</em> form.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c1298f2d-d247-4432-8596-1ef398391b69">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The next step is to execute the query, and then continue based on whether a correct or erronous  result was sent by the DB engine.</p>
<p>It's essentially now just a matter of invoking <em>Hasql</em>'s <code>run</code> function. But we live in an imperfect world so we'll wrap the <code>run</code> call with proper error management that will catch any anomaly.  It's always a very good approach to put a maximum of runtime checking around distributed data operations:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=8c457ce0-1a35-45ce-880c-d7f67c9e0169">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [70]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">dbVal</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kr">case</span><span class="w"> </span><span class="n">dbConn</span><span class="w"> </span><span class="kr">of</span>
<span class="w">  </span><span class="kt">Right</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="n">rezA</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kt">Se</span><span class="o">.</span><span class="n">run</span><span class="w"> </span><span class="p">(</span><span class="n">simpleQuery</span><span class="w"> </span><span class="s">"bootcamp"</span><span class="p">)</span><span class="w"> </span><span class="n">conn</span>
<span class="w">    </span><span class="kr">case</span><span class="w"> </span><span class="n">rezA</span><span class="w"> </span><span class="kr">of</span>
<span class="w">      </span><span class="kt">Left</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">Left</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">err</span>
<span class="w">      </span><span class="kt">Right</span><span class="w"> </span><span class="n">vcVal</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Right</span><span class="w"> </span><span class="n">vcVal</span>
<span class="w">  </span><span class="kt">Left</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">Left</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">err</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre></pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d6c6cb27-15d3-4c60-8475-893ced6a6b6d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Once that cell has run, either the DB server executed the <strong>SQL</strong> statement and we've got back a vector of values, or there has been a runtime error. The no-error/error situation is indicated with the <a href="https://hackage.haskell.org/package/base/docs/Data-Either.html">Either</a> monadic type, which uses <code>Right</code> and <code>Left</code> as containers meaning <em>no-error</em> and <em>error</em> respectively, as you can find in <strong>Rust</strong> <code>Result</code> or <strong>C++</strong> <code>std::expected</code>.</p>
<p>If we got a good result from the query, we'll format it using HTML. It's much nicer to look at than a bland <em>print</em>... Using the Jinja template approach, we'll build a <code>GVal</code> instance of <code>GhProject</code> as a dictionnary of fields that will be used to populate an HTML template.  Using <em>Generics</em> can do the conversion just by derivation, but hopefully you find it more informative to see how a bunch of fields are mapped to the <em>Ginger</em> VM context.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=19003f14-7955-4cf9-acca-95eca16b1c64">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The following code loads a template file, defines the <code>GhProject</code> mapping to <code>GVal</code>, adds some formatting for erroneous situations, and finally runs the template engine with the dataset received from the DB so the data is shown in a HTML format (be patient, the DB query may take a while to complete):</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=fb2d9852-94d8-4d4b-b61f-eb9b30e08eeb">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [71]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Maybe</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Mb</span>

<span class="nf">template_2</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kt">Prelude</span><span class="o">.</span><span class="n">readFile</span><span class="w"> </span><span class="s">"ph_1/xstatic/templates/templ_5.html"</span>


<span class="kr">instance</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="kt">ToGVal</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="kt">GhProject</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">toGVal</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">toGVal</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Mp</span><span class="o">.</span><span class="n">fromList</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">(</span><span class="s">"rank"</span><span class="p">,</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">rank</span><span class="p">)</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span><span class="p">,</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"section"</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">section</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"repo"</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">repo</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"stars"</span><span class="p">,</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">stars</span><span class="p">)</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"forks"</span><span class="p">,</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">forks</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"language"</span><span class="p">,</span><span class="w"> </span><span class="kt">Mb</span><span class="o">.</span><span class="n">fromMaybe</span><span class="w"> </span><span class="s">"&lt;nil&gt;"</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">language</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"url"</span><span class="p">,</span><span class="w"> </span><span class="kt">Mb</span><span class="o">.</span><span class="n">fromMaybe</span><span class="w"> </span><span class="s">"&lt;nil&gt;"</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"uname"</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">uname</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"issues"</span><span class="p">,</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">issues</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">"last_commit"</span><span class="p">,</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">lastCommit</span><span class="p">)</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="s">"description"</span><span class="p">,</span><span class="w"> </span><span class="kt">Mb</span><span class="o">.</span><span class="n">fromMaybe</span><span class="w"> </span><span class="s">"&lt;nil&gt;"</span><span class="w"> </span><span class="n">p</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
<span class="w">    </span><span class="p">]</span>

<span class="nf">derefGhProj</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="n">needle</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kr">case</span><span class="w"> </span><span class="n">needle</span><span class="w"> </span><span class="kr">of</span>
<span class="w">    </span><span class="s">"columns"</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">      </span><span class="kt">Gi</span><span class="o">.</span><span class="n">toGVal</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s">"Rank"</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="s">"Section"</span><span class="p">,</span><span class="w"> </span><span class="s">"Repo"</span><span class="p">,</span><span class="w"> </span><span class="s">"Stars"</span><span class="p">,</span><span class="w"> </span><span class="s">"Forks"</span><span class="p">,</span><span class="w"> </span><span class="s">"Language"</span>
<span class="w">          </span><span class="p">,</span><span class="w"> </span><span class="s">"Url"</span><span class="p">,</span><span class="w"> </span><span class="s">"User"</span><span class="p">,</span><span class="w"> </span><span class="s">"Issues"</span><span class="p">,</span><span class="w"> </span><span class="s">"Latest"</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="s">"results"</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">case</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="kr">of</span>
<span class="w">      </span><span class="kt">Left</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">toGVal</span><span class="w"> </span><span class="p">(</span><span class="s">"error"</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span><span class="p">)</span>
<span class="w">      </span><span class="kt">Right</span><span class="w"> </span><span class="n">vcProjs</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">toGVal</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Vc</span><span class="o">.</span><span class="n">toList</span><span class="w"> </span><span class="n">vcProjs</span>
<span class="w">    </span><span class="kr">_</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">toGVal</span><span class="w"> </span><span class="p">(</span><span class="s">"error"</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span><span class="p">)</span>


<span class="kt">Gi</span><span class="o">.</span><span class="n">htmlSource</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">runGinger</span><span class="w"> </span><span class="p">(</span><span class="kt">Gi</span><span class="o">.</span><span class="n">makeContextHtml</span><span class="w"> </span><span class="p">(</span><span class="n">derefGhProj</span><span class="w"> </span><span class="n">dbVal</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">loadTemplate</span><span class="w"> </span><span class="n">template_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><div class="overflow-x-auto shadow-md sm:rounded-lg" style="width: 150em">
<table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
<caption class="p-5 text-lg font-semibold text-left rtl:text-right text-gray-900 bg-white dark:text-white dark:bg-gray-800">
      GitHub TOP 100
      <p class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-400">
      A embellished presentation the top starred and/or forked repos of GitHub for the last 5 years.
      </p>
</caption>
<thead class="text-xs text-white uppercase bg-blue-600 dark:text-white">
<tr>
<th class="px-6 py-3" scope="col">Rank</th>
<th class="px-6 py-3" scope="col">Section</th>
<th class="px-6 py-3" scope="col">Repo</th>
<th class="px-6 py-3" scope="col">Stars</th>
<th class="px-6 py-3" scope="col">Forks</th>
<th class="px-6 py-3" scope="col">Language</th>
<th class="px-6 py-3" scope="col">Url</th>
<th class="px-6 py-3" scope="col">User</th>
<th class="px-6 py-3" scope="col">Issues</th>
<th class="px-6 py-3" scope="col">Latest</th>
<th class="px-6" scope="col" style="width: 50em">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="px-6 py-3" scope="col">7</td>
<td class="px-6 py-3" scope="col">top-100-forks</td>
<td class="px-6 py-3" scope="col">Complete-Python-3-Bootcamp</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">25295</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">81802</td>
<td class="px-6 py-3" scope="col">Jupyter Notebook</td>
<td>
<a href="https://github.com/Pierian-Data/Complete-Python-3-Bootcamp">Complete-Python-3-Bootcamp</a>
</td>
<td class="px-6 py-3" scope="col">Pierian-Data</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">120</td>
<td class="px-6 py-3" scope="col">2023-11-24 14:21:32</td>
<td class="px-6 py-3" scope="col">Course Files for Complete Python 3 Bootcamp Course on Udemy</td>
</tr>
<tr>
<td class="px-6 py-3" scope="col">7</td>
<td class="px-6 py-3" scope="col">top-100-forks</td>
<td class="px-6 py-3" scope="col">Complete-Python-3-Bootcamp</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">25267</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">81756</td>
<td class="px-6 py-3" scope="col">Jupyter Notebook</td>
<td>
<a href="https://github.com/Pierian-Data/Complete-Python-3-Bootcamp">Complete-Python-3-Bootcamp</a>
</td>
<td class="px-6 py-3" scope="col">Pierian-Data</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">119</td>
<td class="px-6 py-3" scope="col">2023-11-24 14:21:32</td>
<td class="px-6 py-3" scope="col">Course Files for Complete Python 3 Bootcamp Course on Udemy</td>
</tr>
<tr>
<td class="px-6 py-3" scope="col">7</td>
<td class="px-6 py-3" scope="col">top-100-forks</td>
<td class="px-6 py-3" scope="col">Complete-Python-3-Bootcamp</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">25328</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">81847</td>
<td class="px-6 py-3" scope="col">Jupyter Notebook</td>
<td>
<a href="https://github.com/Pierian-Data/Complete-Python-3-Bootcamp">Complete-Python-3-Bootcamp</a>
</td>
<td class="px-6 py-3" scope="col">Pierian-Data</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">120</td>
<td class="px-6 py-3" scope="col">2023-11-24 14:21:32</td>
<td class="px-6 py-3" scope="col">Course Files for Complete Python 3 Bootcamp Course on Udemy</td>
</tr>
<tr>
<td class="px-6 py-3" scope="col">7</td>
<td class="px-6 py-3" scope="col">top-100-forks</td>
<td class="px-6 py-3" scope="col">Complete-Python-3-Bootcamp</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">25313</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">81832</td>
<td class="px-6 py-3" scope="col">Jupyter Notebook</td>
<td>
<a href="https://github.com/Pierian-Data/Complete-Python-3-Bootcamp">Complete-Python-3-Bootcamp</a>
</td>
<td class="px-6 py-3" scope="col">Pierian-Data</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">120</td>
<td class="px-6 py-3" scope="col">2023-11-24 14:21:32</td>
<td class="px-6 py-3" scope="col">Course Files for Complete Python 3 Bootcamp Course on Udemy</td>
</tr>
<tr>
<td class="px-6 py-3" scope="col">7</td>
<td class="px-6 py-3" scope="col">top-100-forks</td>
<td class="px-6 py-3" scope="col">Complete-Python-3-Bootcamp</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">25276</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">81774</td>
<td class="px-6 py-3" scope="col">Jupyter Notebook</td>
<td>
<a href="https://github.com/Pierian-Data/Complete-Python-3-Bootcamp">Complete-Python-3-Bootcamp</a>
</td>
<td class="px-6 py-3" scope="col">Pierian-Data</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">119</td>
<td class="px-6 py-3" scope="col">2023-11-24 14:21:32</td>
<td class="px-6 py-3" scope="col">Course Files for Complete Python 3 Bootcamp Course on Udemy</td>
</tr>
<tr>
<td class="px-6 py-3" scope="col">7</td>
<td class="px-6 py-3" scope="col">top-100-forks</td>
<td class="px-6 py-3" scope="col">Complete-Python-3-Bootcamp</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">25333</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">81862</td>
<td class="px-6 py-3" scope="col">Jupyter Notebook</td>
<td>
<a href="https://github.com/Pierian-Data/Complete-Python-3-Bootcamp">Complete-Python-3-Bootcamp</a>
</td>
<td class="px-6 py-3" scope="col">Pierian-Data</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">120</td>
<td class="px-6 py-3" scope="col">2023-11-24 14:21:32</td>
<td class="px-6 py-3" scope="col">Course Files for Complete Python 3 Bootcamp Course on Udemy</td>
</tr>
<tr>
<td class="px-6 py-3" scope="col">7</td>
<td class="px-6 py-3" scope="col">top-100-forks</td>
<td class="px-6 py-3" scope="col">Complete-Python-3-Bootcamp</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">25274</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">81761</td>
<td class="px-6 py-3" scope="col">Jupyter Notebook</td>
<td>
<a href="https://github.com/Pierian-Data/Complete-Python-3-Bootcamp">Complete-Python-3-Bootcamp</a>
</td>
<td class="px-6 py-3" scope="col">Pierian-Data</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">119</td>
<td class="px-6 py-3" scope="col">2023-11-24 14:21:32</td>
<td class="px-6 py-3" scope="col">Course Files for Complete Python 3 Bootcamp Course on Udemy</td>
</tr>
<tr>
<td class="px-6 py-3" scope="col">7</td>
<td class="px-6 py-3" scope="col">top-100-forks</td>
<td class="px-6 py-3" scope="col">Complete-Python-3-Bootcamp</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">25318</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">81840</td>
<td class="px-6 py-3" scope="col">Jupyter Notebook</td>
<td>
<a href="https://github.com/Pierian-Data/Complete-Python-3-Bootcamp">Complete-Python-3-Bootcamp</a>
</td>
<td class="px-6 py-3" scope="col">Pierian-Data</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">120</td>
<td class="px-6 py-3" scope="col">2023-11-24 14:21:32</td>
<td class="px-6 py-3" scope="col">Course Files for Complete Python 3 Bootcamp Course on Udemy</td>
</tr>
<tr>
<td class="px-6 py-3" scope="col">7</td>
<td class="px-6 py-3" scope="col">top-100-forks</td>
<td class="px-6 py-3" scope="col">Complete-Python-3-Bootcamp</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">25280</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">81786</td>
<td class="px-6 py-3" scope="col">Jupyter Notebook</td>
<td>
<a href="https://github.com/Pierian-Data/Complete-Python-3-Bootcamp">Complete-Python-3-Bootcamp</a>
</td>
<td class="px-6 py-3" scope="col">Pierian-Data</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">120</td>
<td class="px-6 py-3" scope="col">2023-11-24 14:21:32</td>
<td class="px-6 py-3" scope="col">Course Files for Complete Python 3 Bootcamp Course on Udemy</td>
</tr>
<tr>
<td class="px-6 py-3" scope="col">7</td>
<td class="px-6 py-3" scope="col">top-100-forks</td>
<td class="px-6 py-3" scope="col">Complete-Python-3-Bootcamp</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">25304</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">81816</td>
<td class="px-6 py-3" scope="col">Jupyter Notebook</td>
<td>
<a href="https://github.com/Pierian-Data/Complete-Python-3-Bootcamp">Complete-Python-3-Bootcamp</a>
</td>
<td class="px-6 py-3" scope="col">Pierian-Data</td>
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">120</td>
<td class="px-6 py-3" scope="col">2023-11-24 14:21:32</td>
<td class="px-6 py-3" scope="col">Course Files for Complete Python 3 Bootcamp Course on Udemy</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=07f34f95-00c1-4058-80dd-66c8652ca4a9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>That's it! Now you know how to interact with a SQL DB server in a safe and efficient way, convert data back and forth between Haskell structures and DB tables, and it's also easy to create HTML out of datasets from Jinja templates.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=cd577aeb-2bf5-41c8-a3c7-3401b3235c84">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2> Javascript as a DSL</h2>
<p>For fun, let's look at another DSL: Javascript.
Yep, it's possible to write JS code as part of the Haskell code, have it syntax-checked and then sent to a <em>NodeJS</em> engine for processing.</p>
<p>I don't bother to describe what is going on, but at this point you should be able to understand the whole sequence of code.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=818e1d43-8e46-4dfc-a23d-71b01aa8c89e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [72]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="cm">{-# LANGUAGE DerivingVia #-}</span>
<span class="cm">{-# LANGUAGE TemplateHaskell #-}</span>
<span class="cm">{-# LANGUAGE TypeApplications #-}</span>
<span class="cm">{-# LANGUAGE DeriveGeneric #-}</span>
<span class="cm">{-# LANGUAGE DeriveAnyClass #-}</span>
<span class="cm">{-# LANGUAGE ViewPatterns #-}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=39697417-e035-42f7-9cb6-67ebaf109228">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [73]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="nn">Control.Exception</span><span class="w"> </span><span class="p">(</span><span class="nf">try</span><span class="p">,</span><span class="w"> </span><span class="kt">SomeException</span><span class="p">,</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Concurrent</span><span class="w"> </span><span class="p">(</span><span class="nf">threadDelay</span><span class="p">)</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">Data.Aeson</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">FromJSON</span><span class="w"> </span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">GHC.Generics</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">Generic</span><span class="w"> </span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Language.JavaScript.Inline</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Language.JavaScript.Inline.Core</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.ByteString.Lazy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">LBS</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Data.Text</span><span class="w"> </span><span class="p">(</span><span class="kt">Text</span><span class="p">,</span><span class="w"> </span><span class="nf">unpack</span><span class="p">)</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Monad</span><span class="w"> </span><span class="p">(</span><span class="nf">ap</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">GHC.TypeLits</span><span class="w"> </span><span class="p">(</span><span class="kt">KnownSymbol</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Data.Text.Array</span><span class="w"> </span><span class="p">(</span><span class="nf">run</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Data.Vector.Generic.Mutable</span><span class="w"> </span><span class="p">(</span><span class="nf">set</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=5ecd8551-52c9-4943-9ec3-d256759a42d9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [74]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">newtype</span><span class="w"> </span><span class="kt">JSReturn</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">JSReturn</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">String</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Generic</span><span class="p">,</span><span class="w"> </span><span class="kt">Show</span><span class="p">,</span><span class="w"> </span><span class="kt">FromJSON</span><span class="p">)</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="kt">FromJS</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="p">(</span><span class="kt">Aeson</span><span class="w"> </span><span class="kt">JSReturn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=d984af9f-de6a-4e5f-8497-48c754cfaf2e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [75]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">runJSTest</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="kt">JSReturn</span>
<span class="nf">runJSTest</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">session</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">newSession</span><span class="w"> </span><span class="n">defaultConfig</span>
<span class="w">  </span><span class="n">putStrLn</span><span class="w"> </span><span class="s">"@[runJSTest] starting."</span>
<span class="w">  </span><span class="n">rezA</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">eval</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="p">[</span><span class="n">js</span><span class="o">|</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">"@[runJSTest] JS starting."</span><span class="p">)</span>
<span class="w">    </span><span class="kr">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"allo"</span>
<span class="w">    </span><span class="kr">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"byebye"</span>

<span class="w">    </span><span class="n">doTest</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">async</span><span class="w"> </span><span class="nb">()</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">console</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">"@[runElmTest] JS doTest start."</span><span class="p">)</span>
<span class="w">      </span><span class="n">setTimeout</span><span class="p">(</span><span class="nb">()</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="n">console</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">"timeout!"</span><span class="p">),</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>
<span class="w">      </span><span class="n">console</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">"@[runElmTest] JS doTest end."</span><span class="p">)</span>
<span class="w">      </span><span class="n">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"result"</span><span class="kt">:</span><span class="w"> </span><span class="s">"run_JS_1: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">", "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">finalRez</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">await</span><span class="w"> </span><span class="n">doTest</span><span class="nb">()</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">"@[runJSTest] JS ending."</span><span class="p">)</span>
<span class="w">    </span><span class="n">return</span><span class="w"> </span><span class="n">finalRez</span>
<span class="w">   </span><span class="o">|</span><span class="p">]</span>
<span class="w">  </span><span class="n">closeSession</span><span class="w"> </span><span class="n">session</span>
<span class="w">  </span><span class="n">putStrLn</span><span class="w"> </span><span class="s">"@[runJSTest] finishing."</span>
<span class="w">  </span><span class="n">pure</span><span class="w"> </span><span class="n">rezA</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=2bb29bf2-7f2d-4622-91dd-d12aa284d84e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [76]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">runJSTest</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>@[runJSTest] starting.
@[runJSTest] JS starting.
@[newSession] msg : JSEvalResponse {jsEvalRespon@[runElmTest] JS doTest start.
seId = 288@[runElmTest] JS doTest end.
7, jsE@[runJSTest] JS ending.
valResponseContent = Right "{\"result\":\"run_JS_1: allo, byebye\"}"}
timeout!
@[runJSTest] finishing.
JSReturn {result = "run_JS_1: allo, byebye"}</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=f210b29c-b5be-4af6-afbc-7a856afeb219">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [77]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">runJS_B</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="kt">JSReturn</span>
<span class="nf">runJS_B</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">session</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">newSession</span><span class="w"> </span><span class="n">defaultConfig</span>
<span class="w">  </span><span class="n">rezA</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">eval</span><span class="w"> </span><span class="n">session</span><span class="w"> </span><span class="p">[</span><span class="n">js</span><span class="o">|</span>
<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">"@[runJSTest] JS starting."</span><span class="p">)</span>

<span class="w">    </span><span class="n">console</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">"@[runJSTest] JS ending."</span><span class="p">)</span>
<span class="w">    </span><span class="n">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">"result"</span><span class="kt">:</span><span class="w"> </span><span class="s">"JS_B: pwd = "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">process</span><span class="o">.</span><span class="n">cwd</span><span class="nb">()</span><span class="w"> </span><span class="p">}</span>
<span class="w">   </span><span class="o">|</span><span class="p">]</span>
<span class="w">  </span><span class="n">closeSession</span><span class="w"> </span><span class="n">session</span>
<span class="w">  </span><span class="n">pure</span><span class="w"> </span><span class="n">rezA</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=cf6c1bcd-b4ee-488b-a70d-3a3152c166ca">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [78]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">runJS_B</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>@[runJSTest] JS starting.
@[newSession] msg : JSEvalResponse {jsEvalResponseId = 2954, jsEvalResponseContent = Right "{\"result\":\"JS_B: pwd = /home/lhugo/P@[runJSTest] JS ending.
rojets/Fudd/IHaskell/IHaskell/notebooks_2\"}"}
JSReturn {result = "JS_B: pwd = /home/lhugo/Projets/Fudd/IHaskell/IHaskell/notebooks_2"}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=f394c0f6-b9b8-4e6d-b0e7-1a858bf58373">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The Javascript code does nothing useful, but it does showcase another kind of DSL with distributed execution. Interestingly you'll notice that the feedback from the Javascript code execution is asynchronous, so you can start running the <code>runJS_B</code> demo while the 'runJSTest` is still waiting for the timeout code to trigger.</p>
<p>Many language grammars have been encoded as DSL for Haskell. So you can let your imagination wonder a bit and think how interesting it is to connect let's say a large Python framework running within a Celery cluster or some Erlang application and interact with them from the Haskell code...</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=f9888a03-d9a8-46b2-a0d7-002658114831">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Enough fun with DSLs, we can now move on toward the last part of the introduction: web endpoints.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=b0d0ac38-f37b-4bec-834a-cf7eb0134f95">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h2>Serving some Web endpoints: the basics</h2>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=52b2da90-2de8-4a70-bd1f-6bed3d11a4ba">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The Web service architecture of the Haskell ecosystem has stabilized over the years the Web Application Interface (<a href="https://hackage.haskell.org/package/wai">Wai</a>) package. It provides a mature and efficient base layer for handling and responding to HTTP requests.</p>
<p>On top of <em>WAI</em> is another very stable package, the light-weight web server <a href="https://hackage.haskell.org/package/warp">Warp</a>. Together <em>WAI</em> and <em>Warp</em> provide a simple way to quickly prototype a web service.</p>
<p>Let's use the WAI/Warp pair to build a quick-and-dirty web handler, as one does in real-life to prototype an idea while testing stuff in the interpreter.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=9c49738e-6862-4adf-bf12-68cd7de139c8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>As usual, a few packages need to be brought into the namespace to move forward.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=2917708c-18e5-40d0-96c1-a20b5ad9f540">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [79]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Control.Concurrent</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Cc</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Network.Wai</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">W</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Network.Wai.Handler.Warp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Wr</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Network.HTTP.Types</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Ht</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=2a561865-39a0-445e-af72-ef4d705d2811">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Then we create a basic HTTP handler called <code>waiDemoServer</code> which will handle the "<em>/marco</em>" route for incoming clients. The reply will be an unconditional responder sending back the <code>tmplDemo</code> HTML template content constructed earlier in the notebook.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=34c157d9-060f-43b2-99c6-4cb16721febc">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [80]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">waiDemoServer</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">sendFct</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="n">sendFct</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">W</span><span class="o">.</span><span class="n">responseLBS</span>
<span class="w">    </span><span class="kt">Ht</span><span class="o">.</span><span class="n">status200</span>
<span class="w">    </span><span class="p">(</span><span class="kr">case</span><span class="w"> </span><span class="kt">Prelude</span><span class="o">.</span><span class="n">lookup</span><span class="w"> </span><span class="s">"marco"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">W</span><span class="o">.</span><span class="n">requestHeaders</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="kr">of</span>
<span class="w">       </span><span class="kt">Nothing</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">[]</span>
<span class="w">       </span><span class="kt">Just</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="p">[(</span><span class="s">"Polo"</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="p">)])</span>
<span class="w">    </span><span class="p">(</span><span class="kt">LBS</span><span class="o">.</span><span class="n">fromStrict</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">encodeUtf8</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">htmlSource</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">tmplDemo</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=6516d32c-ae47-4eaf-afe2-dfd29589303d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>There are two arguments for <code>waiDemoServer</code>: first the request received from the HTTP client, and second a responder function. That interface for <code>waiDemoServer</code> is standard stuff defined by WAI.</p>
<p>The behavior of our toy server will be to reply with a 200 (OK) status code together with the HTML content in <code>tmplDemo</code>. Additionally if the URL of the request matches the <em>/marco</em> route,  a <code>Polo</code> value is sent back in the headers of the response just to show how that works.</p>
<p>The web server is started with a <code>run &lt;port&gt; &lt;service-function&gt;</code>.  As we're working in a Jupyter notebook context, we'll fork the service to a sub-process that we can kill later:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=4833c94a-1718-4767-8dbf-2087785577b6">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [81]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">tid</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kt">Cc</span><span class="o">.</span><span class="n">forkIO</span><span class="w"> </span><span class="p">(</span><span class="kt">Wr</span><span class="o">.</span><span class="n">run</span><span class="w"> </span><span class="mi">8181</span><span class="w"> </span><span class="n">waiDemoServer</span><span class="p">)</span>
<span class="nf">print</span><span class="w"> </span><span class="n">tid</span>
<span class="kt">:!</span><span class="w"> </span><span class="n">date</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>ThreadId 5467</pre>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Wed May 22 02:56:43 PM +04 2024</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=dda9c924-cf05-4c00-8593-40ea124e6a4d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>If you are running this notebook from the docker image, you can hit <em><a href="https://**host">https://**host</a></em>/demo1* with your web browser.
In case you have direct access to port 8181 of this Jupyter host, you can hit <em><a href="http://**host**:8181/marco">http://**host**:8181/marco</a></em>  with your web browser.</p>
<p>But since this demo will likely be running on a virtual server hiding private ports, here's the code based on the basic HTTP client introduced earlier in the notebook to fetch the route and visualize the returned HTML right in a cell:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=a90618be-7e32-4160-9ac4-a64425734af8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [82]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">fetchDemo</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kr">let</span>
<span class="w">    </span><span class="n">url</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"GET http://localhost:8181/marco"</span>
<span class="w">    </span><span class="n">request</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">N</span><span class="o">.</span><span class="n">setQueryString</span><span class="w"> </span><span class="p">[(</span><span class="s">"arg"</span><span class="p">,</span><span class="w"> </span><span class="kt">Just</span><span class="w"> </span><span class="s">"123"</span><span class="p">)]</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">N</span><span class="o">.</span><span class="n">parseRequest_</span><span class="w"> </span><span class="n">url</span>
<span class="w">  </span><span class="kr">in</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="n">reqMgr</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kt">N</span><span class="o">.</span><span class="n">newManager</span><span class="w"> </span><span class="kt">N</span><span class="o">.</span><span class="n">defaultManagerSettings</span>
<span class="w">    </span><span class="kt">N</span><span class="o">.</span><span class="n">httpLbs</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">reqMgr</span>

<span class="nf">reply</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">fetchDemo</span>
<span class="kt">ID</span><span class="o">.</span><span class="n">html</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">TL</span><span class="o">.</span><span class="n">unpack</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">TL</span><span class="o">.</span><span class="n">decodeUtf8</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">reply</span><span class="o">.</span><span class="n">responseBody</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet"/>
<title>Haskell, Hidden Gem</title>
<script cross-origin="anonymous" src="https://unpkg.com/d3@7.8.5/dist/d3.min.js" type="text/javascript"></script>
</head>
<body>
<div class="container bg-gray-500 mx-auto p-4">
<h1 class="text-2xl text-red-900 font-bold mb-4">Haskell, Hidden Gem</h1>
<table class="min-w-full bg-orange-500 border border-gray-300">
<thead>
<tr>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-100 uppercase tracking-wider border-b">Name</th>
<th class="px-6 py-3 text-left text-xs font-medium text-gray-100 uppercase tracking-wider border-b">Destination</th>
</tr>
</thead>
<tbody>
<tr>
<td class="text-blue-800">#1 ALPINE CUSTOMS</td>
<td class="text-green-600"><a href="http://https://vpic.nhtsa.dot.gov/api/vehicles/getmake?id=12858">#1 ALPINE CUSTOMS</a></td>
</tr>
<tr>
<td class="text-blue-800">1/OFF KUSTOMS, LLC</td>
<td class="text-green-600"><a href="http://https://vpic.nhtsa.dot.gov/api/vehicles/getmake?id=4877">1/OFF KUSTOMS, LLC</a></td>
</tr>
<tr>
<td class="text-blue-800">102 IRONWORKS, INC.</td>
<td class="text-green-600"><a href="http://https://vpic.nhtsa.dot.gov/api/vehicles/getmake?id=11257">102 IRONWORKS, INC.</a></td>
</tr>
<tr>
<td class="text-blue-800">12832429 CANADA INC.</td>
<td class="text-green-600"><a href="http://https://vpic.nhtsa.dot.gov/api/vehicles/getmake?id=12255">12832429 CANADA INC.</a></td>
</tr>
<tr>
<td class="text-blue-800">17 CREEK ENTERPRISES</td>
<td class="text-green-600"><a href="http://https://vpic.nhtsa.dot.gov/api/vehicles/getmake?id=6387">17 CREEK ENTERPRISES</a></td>
</tr>
</tbody>
</table>
</div>
<div class="flex p-5 justify-center" id="d3 demo">
<svg height="200" id="dataviz_area" width="450"></svg>
<script>
          var svg = d3.select("#dataviz_area")
          var x = d3.scaleLinear()
            .domain([0, 100])         // This is the min and the max of the data: 0 to 100 if percentages
            .range([0, 400]);       // This is the corresponding value I want in Pixel

          // Show the axis that corresponds to this scale
          svg.call(d3.axisBottom(x));

                      svg.append("circle").attr("cx", x(20))
              .attr("cy", 90).attr("r", 40 )
              .style("fill", "green");
                      svg.append("circle").attr("cx", x(50))
              .attr("cy", 90).attr("r", 45 )
              .style("fill", "red");
                      svg.append("circle").attr("cx", x(85))
              .attr("cy", 90).attr("r", 50 )
              .style("fill", "blue");

        </script>
</div>
</body>
</html>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=882e33e9-b492-4c5f-a7ae-b281ae0dc0ec">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Is the SVG from <em>D3.js</em> showing up in the second half of the HTML page?  For me sometimes it does, sometimes it doesn't... Hopefully you can actually hit the route with your browser directly to get the correct result.</p>
<p>When you have are done with the request, run the next cell to kill the background process and keep the execution space clean.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=e64990be-b453-4dd1-8bbd-243b9f39ffac">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [83]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kt">Cc</span><span class="o">.</span><span class="n">killThread</span><span class="w"> </span><span class="n">tid</span>
<span class="kt">:!</span><span class="w"> </span><span class="n">date</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Wed May 22 02:56:45 PM +04 2024</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=57e3e425-5b41-41bc-a7dc-bf3331eede24">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<div class="float-right rounded"><img alt="No description has been provided for this image" class="rounded-full shadow-md shadow-gray-700" height="400" src="ph_1/xstatic/img/webFramework_1.png" style="float: right; margin: 0px 10px 0px 10px;" width="300"/></div>
<h2>Reaching the main objective: a production grade modern web app</h2>
<p>This is the conclusion of this notebook: a <em>normal, modern, efficient</em> web app built in the Haskell ecosystem, using HTMX and Tailwind in the frontend, server-side rendering of templates filled with data fetched by SQL queries in the backend and websocket low-latency communications between client and server. That plus authentication, security, distributed computing... the usual stuff.</p>
<p>You've already seen how to deal with JSON, how to render HTML from either server-side DOM (Blaze) or Jinja templates (Ginger), how to query a Postgresql database using embedded <strong>SQL</strong>, and how to do HTTP operations (client &amp; handler).</p>
<p>Further more I hope you have reached this cell in a <em>short</em> amount of time.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=4cd1398f-8bf3-478d-8ffb-2de01317dc4b">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We'll wrap-up everything covered so far into a basic modern web application by using the <a href="https://hackage.haskell.org/package/servant">Servant</a> package. <em>Servant</em> a mature web app server based on type combinators. Finally, here are the types! And this is not simple typing stuff... <em>Servant</em> uses types as programming logic rather than just for expressing data structures and constraints for functions. That will give you a glimpse of how powerful the type system of Haskell is compared to other programming languages and why it is so interesting as a programming language.</p>
<p><em>Servant</em> type-based approach to endpoint definition provides verifiable, composable and extendable route specfication for web services. Beside the usual advantages of strongly-typed code, type-derived logic can automatically deduce route extension rules, apply security handlers, adapt request &amp; reply behaviors based on middleware interactions, convert automatically data payloads from and to clients, generate client-side code and compliance testing code, and the list goes on.</p>
<p>If only <em>OpenAPI</em> was based on Haskell...</p>
<p>Once you've worked with Servant, you will find that the popular solutions of other ecosystems are simplistic, error-prone and inefficient. NextJS, Chi, Gin, Tokio, Rocket, Express, Flask, you name it, they just don't have the tools available in the Haskell ecosystem to compete.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=1abb58a3-47f5-49a7-8017-59923c92dad5">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>In order to implement all the functionality in the notebook, we'll have to deal with a few limitations of the environment.  For some reason, I can't get the local module import to work if the module hasn't been implemented within the notebook. For that reason the <code>WebServer.CorsPolicy</code> and <code>WebServer.JWT</code> module definnitions are in the first few cells of the notebook, which you need to be run for this part to work. In normal conditions you would simply import the two modules from files.</p>
<p>I put the language mode settings and the long list of imported packages as collapsed cells.  You can have a look at the code if you want to, but it's really not necessary for getting in the main part of the implementation.</p>
<p>Then to insert <em>markdown</em> cells for documenting the code I also had to define every symbol (function, type) before it is referred.  That forced me to lay out the code in the opposite order that I wouldd normally write it. Normally I would go top-down and write the main logic (<code>listen</code>) first then define more and more of the details referred to by the main logic. But here it's bottom-up order. Probably that some blocks of code will seem pretty abstract when they show up, and you'll have to wait until you read the code that uses them to better understand how the Servant system works.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=6609c5c4-c52f-423b-ae31-315f32fb3c11">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [84]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="cm">{-# LANGUAGE DataKinds #-}</span>
<span class="cm">{-# LANGUAGE TypeApplications #-}</span>
<span class="cm">{-# LANGUAGE TypeOperators #-}</span>
<span class="cm">{-# LANGUAGE TypeFamilies #-}</span>
<span class="cm">{-# LANGUAGE MultiParamTypeClasses #-}</span>
<span class="cm">{-# LANGUAGE DeriveGeneric #-}</span>
<span class="cm">{-# LANGUAGE DerivingStrategies #-}</span>
<span class="cm">{-# LANGUAGE DeriveAnyClass #-}</span>
<span class="cm">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=c63ef626-d5cf-439a-9c34-ebc1bcbf5a9a">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [85]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="nn">Control.Concurrent.Async</span><span class="w"> </span><span class="p">(</span><span class="nf">concurrently_</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Exception</span><span class="w"> </span><span class="p">(</span><span class="nf">bracket</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Monad</span><span class="w"> </span><span class="p">(</span><span class="nf">forever</span><span class="p">,</span><span class="w"> </span><span class="nf">void</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Monad.Catch</span><span class="w"> </span><span class="p">(</span><span class="kt">MonadCatch</span><span class="p">,</span><span class="w"> </span><span class="kt">MonadMask</span><span class="p">,</span><span class="w"> </span><span class="kt">MonadThrow</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Monad.Cont</span><span class="w"> </span><span class="p">(</span><span class="nf">runContT</span><span class="p">,</span><span class="w"> </span><span class="kt">ContT</span><span class="w"> </span><span class="p">(</span><span class="o">..</span><span class="p">),</span><span class="w"> </span><span class="kt">Cont</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Monad.Except</span><span class="w"> </span><span class="p">(</span><span class="kt">ExceptT</span><span class="p">,</span><span class="w"> </span><span class="kt">MonadError</span><span class="p">,</span><span class="w"> </span><span class="nf">withExceptT</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Monad.IO.Class</span><span class="w"> </span><span class="p">(</span><span class="kt">MonadIO</span><span class="p">,</span><span class="w"> </span><span class="nf">liftIO</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Monad.Reader</span><span class="w"> </span><span class="p">(</span><span class="kt">ReaderT</span><span class="p">,</span><span class="w"> </span><span class="kt">MonadReader</span><span class="p">,</span><span class="w"> </span><span class="nf">runReaderT</span><span class="p">,</span><span class="w"> </span><span class="nf">asks</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Control.Exception.Safe</span><span class="w"> </span><span class="p">(</span><span class="nf">tryAny</span><span class="p">)</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">Data.List.NonEmpty</span><span class="w"> </span><span class="p">(</span><span class="kt">NonEmpty</span><span class="w"> </span><span class="p">(</span><span class="o">..</span><span class="p">))</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Data.Int</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">DI</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">Data.Aeson</span><span class="w"> </span><span class="p">(</span><span class="kt">FromJSON</span><span class="w"> </span><span class="p">(</span><span class="o">..</span><span class="p">),</span><span class="w"> </span><span class="kt">ToJSON</span><span class="w"> </span><span class="p">(</span><span class="o">..</span><span class="p">),</span><span class="w"> </span><span class="kt">Value</span><span class="w"> </span><span class="p">(</span><span class="kt">Object</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">.:</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">.:?</span><span class="p">),</span><span class="w"> </span><span class="nf">eitherDecode</span><span class="p">)</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">Network.Wai.Handler.Warp</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Wr</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Network.Wai.Parse</span><span class="w"> </span><span class="p">(</span><span class="nf">setMaxRequestKeyLength</span><span class="p">,</span><span class="w"> </span><span class="nf">defaultParseRequestBodyOptions</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Network.HTTP.Media</span><span class="w"> </span><span class="p">((</span><span class="o">//</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="o">/:</span><span class="p">))</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Network.Wai.Middleware.RequestLogger</span><span class="w"> </span><span class="p">(</span><span class="nf">logStdout</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Network.Wai.Middleware.Servant.Errors</span><span class="w"> </span><span class="p">(</span><span class="nf">errorMw</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Network.WebSockets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Ws</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">GHC.Stack</span><span class="w"> </span><span class="p">(</span><span class="kt">HasCallStack</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Servant</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Srv</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Servant.API.Generic</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Servant.API.ContentTypes</span><span class="w"> </span><span class="p">(</span><span class="kt">FormUrlEncoded</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Servant.Auth.Server</span><span class="w"> </span><span class="p">(</span><span class="kt">Auth</span><span class="p">,</span><span class="w"> </span><span class="kt">AuthResult</span><span class="w"> </span><span class="p">(</span><span class="o">..</span><span class="p">),</span><span class="w"> </span><span class="kt">BasicAuth</span><span class="p">,</span><span class="w"> </span><span class="kt">BasicAuthCfg</span><span class="p">,</span><span class="w"> </span><span class="kt">CookieSettings</span><span class="w"> </span><span class="p">(</span><span class="kt">CookieSettings</span><span class="p">,</span><span class="w"> </span><span class="nf">cookieIsSecure</span><span class="p">)</span>
<span class="w">                  </span><span class="p">,</span><span class="w"> </span><span class="kt">IsSecure</span><span class="w"> </span><span class="p">(</span><span class="kt">NotSecure</span><span class="p">),</span><span class="w"> </span><span class="kt">FromBasicAuthData</span><span class="p">,</span><span class="w"> </span><span class="kt">JWT</span><span class="p">,</span><span class="w"> </span><span class="kt">JWTSettings</span><span class="p">,</span><span class="w"> </span><span class="kt">FromJWT</span><span class="w"> </span><span class="p">(</span><span class="o">..</span><span class="p">),</span><span class="w"> </span><span class="kt">ToJWT</span><span class="w"> </span><span class="p">(</span><span class="o">..</span><span class="p">),</span><span class="w"> </span><span class="nf">cookieIsSecure</span>
<span class="w">                  </span><span class="p">,</span><span class="w"> </span><span class="nf">defaultCookieSettings</span><span class="p">,</span><span class="w"> </span><span class="nf">defaultJWTSettings</span><span class="w"> </span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Servant.Auth.Server</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Sauth</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Servant.Multipart</span><span class="w"> </span><span class="p">(</span><span class="nf">defaultMultipartOptions</span><span class="p">,</span><span class="w"> </span><span class="kt">MultipartOptions</span><span class="w"> </span><span class="p">(</span><span class="o">..</span><span class="p">),</span><span class="w"> </span><span class="kt">Tmp</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Servant.Server.Generic</span><span class="w"> </span><span class="p">(</span><span class="kt">AsServerT</span><span class="p">,</span><span class="w"> </span><span class="nf">genericServerT</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Servant.API.WebSocket</span><span class="w"> </span><span class="p">(</span><span class="kt">WebSocket</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Web.FormUrlEncoded</span><span class="w"> </span><span class="p">(</span><span class="kt">FromForm</span><span class="w"> </span><span class="p">(</span><span class="o">..</span><span class="p">))</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">System.Posix.Signals</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Sgnl</span>

<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Text.Blaze.Htmx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">A</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Text.Blaze.Html.Renderer.Utf8</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">H</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Text.Blaze.Htmx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">X</span>
<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Text.Blaze.Htmx.WebSockets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">X</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=e84b10cb-f38f-4bd9-9826-4e884ae02747">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>In a normal coding environment, the helper logic is brought into a the main definitions, like this (remember that the <code>WebServer</code> modules are defined in the first cells of the notebook):</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=b8911079-e26f-4290-93c6-f5573d628fe9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [86]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="c1">-- Bring in the Cors Policy &amp; JWT helpers to configure the HTTP handler.</span>

<span class="kr">import</span><span class="w"> </span><span class="nn">WebServer.CorsPolicy</span><span class="w"> </span><span class="p">(</span><span class="nf">setCorsPolicy</span><span class="p">)</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">WebServer.JWT</span><span class="w"> </span><span class="p">(</span><span class="nf">generateKeyPairIO</span><span class="p">,</span><span class="w"> </span><span class="nf">readJWK</span><span class="p">)</span>

<span class="kr">import</span><span class="w"> </span><span class="k">qualified</span><span class="w"> </span><span class="nn">Options.Runtime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Ropt</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d25153b1-fd7b-4ba8-92e5-7a394e37846d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Forced to use the bottom-up code introduction, here are some data structures that will be used in the main code...</p>
<p>The <code>AppEnv</code> structure will represent the global state of the web service, and hold:</p>
<ul>
<li>the JWT settings used most importantly to handle the encoding/decoding of JW tokens in HTTP requests,</li>
<li>the execution options that control the setup of the web server (in this example we'll only use a port value),</li>
<li>the global DB context to pass to handlers so they can do <strong>SQL</strong> operations.</li>
</ul>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=0f8d09d3-9015-4a91-b20a-6cb758d8eb91">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [87]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">data</span><span class="w"> </span><span class="kt">AppEnv</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">AppEnv</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">jwtSettings</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">JWTSettings</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">rtOptions</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Ropt</span><span class="o">.</span><span class="kt">RunOptions</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">dbCtxt</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">DbC</span><span class="o">.</span><span class="kt">Connection</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c98c1a13-35cf-4d26-9c4e-c10439ea64c8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>HTML</code> type is introduced as a placeholder, that is no actual structure is attached to it. We then use it to tag the result of an endpoint handler with a MIME type corresponding to <em>text/html</em>. It ensures that the requesting client will render the HTML instead of showing its text.</p>
<p>The <code>RawHtml</code> is a demo of how to pass results back up the responder chain; in this case we'll only use it to hold some flat content, ie a long string that is a HTML page that needs to be sent back to the client.  But in real-life you could see a more complex kind of definition where the <code>instance MimeRender HTML RawHtml</code> logic extension adds all kind of post-processing functionality to produce the response that is actually sent back to the client.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=817557f7-14a8-4487-a494-12f96ca8a7b4">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [88]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">data</span><span class="w"> </span><span class="kt">HTML</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">HTML</span>
<span class="kr">newtype</span><span class="w"> </span><span class="kt">RawHtml</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">RawHtml</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">rawContent</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">LBS</span><span class="o">.</span><span class="kt">ByteString</span><span class="w"> </span><span class="p">}</span>

<span class="kr">instance</span><span class="w"> </span><span class="kt">Accept</span><span class="w"> </span><span class="kt">HTML</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">contentType</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"text"</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="s">"html"</span><span class="w"> </span><span class="o">/:</span><span class="w"> </span><span class="p">(</span><span class="s">"charset"</span><span class="p">,</span><span class="w"> </span><span class="s">"utf-8"</span><span class="p">)</span>

<span class="kr">instance</span><span class="w"> </span><span class="kt">MimeRender</span><span class="w"> </span><span class="kt">HTML</span><span class="w"> </span><span class="kt">RawHtml</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">mimeRender</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">rawContent</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=1d82604d-933e-4aa3-b129-824ec5e72c61">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><strong>Note:</strong> the <code>newtype</code> keyword is used in this example to define <code>RawHtml</code> instead of the usual <code>data</code> keyword. A <code>newtype</code> still creates a type, but it's a simpler kind of structure that has less runtime overhead. For example, a <code>newtype</code> data structure can only contain one value in a record.  Using <code>data</code> would also work but doing so gets the compiler to complain that a <code>newtype</code> is better...</p>
<p>To handle secure data exchange between the client and the server, we pass a JWT that holds securely the <code>SessionContext</code> structure. The conversion from/to JSON and the encryption/decryption are implemented by doing a derivation of the <code>FromJSON</code>, <code>ToJSON</code>, <code>FromJWT</code> and <code>ToJWT</code> typeclasses. That makes everything work automagically.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=58ae58a1-2698-4f71-9c4a-0f7944e9cbc6">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [89]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">newtype</span><span class="w"> </span><span class="kt">SessionContext</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">SessionContext</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">sessionID</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">DI</span><span class="o">.</span><span class="kt">Int32</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="kt">Generic</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">anyclass</span><span class="w"> </span><span class="p">(</span><span class="kt">FromJSON</span><span class="p">,</span><span class="w"> </span><span class="kt">ToJSON</span><span class="p">,</span><span class="w"> </span><span class="kt">FromJWT</span><span class="p">,</span><span class="w"> </span><span class="kt">ToJWT</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=2497ed0e-82d6-422a-a90e-0ca688b459b0">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>For a client to initially authenticate itself, it will send a simple JSON block with a <code>identity</code> and <code>trust</code> values. These values are manipulated in the code with the <code>LoginForm</code> structure. Similarly the <code>LoginResult</code> structure is used when the authentication succeeds in sending a JSON block with a context and an encrypted JWT back to the client.  Again the <code>FromJSON</code> and <code>ToJSON</code> derivations take core of the conversion process automagically.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=3e39ea78-dc51-4a3b-8aa0-14edef1190b4">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [90]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">data</span><span class="w"> </span><span class="kt">LoginForm</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">LoginForm</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">identity</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="p">,</span><span class="w"> </span><span class="n">trust</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="p">(</span><span class="kt">Eq</span><span class="p">,</span><span class="w"> </span><span class="kt">Show</span><span class="p">,</span><span class="w"> </span><span class="kt">Generic</span><span class="p">)</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">anyclass</span><span class="w"> </span><span class="p">(</span><span class="kt">ToJSON</span><span class="p">,</span><span class="w"> </span><span class="kt">FromJSON</span><span class="p">)</span>

<span class="kr">data</span><span class="w"> </span><span class="kt">LoginResult</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">LoginResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">context</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">SessionContext</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">jwt</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="kt">Generic</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">anyclass</span><span class="w"> </span><span class="p">(</span><span class="kt">ToJSON</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=7fc76242-7fcd-41a5-b2f9-19b9462a1220">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The web app has an endpoint providing a search feature.  The client will use a <em>HTML</em> <code>form</code> element to implement the capture and transmission of the search needle, and the <code>SearchContent</code> structure represents just that and it is derived with <code>FromForm</code> to trigger automatically the conversion from the HTTP request <em>application/x-www-form-urlencoded</em> data into a Haskell <code>Text</code> value.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=54c19424-c861-4e87-920c-98ff99ce1df6">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [91]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">newtype</span><span class="w"> </span><span class="kt">SearchContent</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">SearchContent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">needle</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="p">(</span><span class="kt">Eq</span><span class="p">,</span><span class="w"> </span><span class="kt">Show</span><span class="p">,</span><span class="w"> </span><span class="kt">Generic</span><span class="p">)</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">anyclass</span><span class="w"> </span><span class="p">(</span><span class="kt">FromForm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=572230b8-7691-4501-928a-53d14a999f1c">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>With these data structures out of the way, we get to the important part of the web server implementation: the route definitions. Using Servant combinators, the routes are presented as a set of structure definitions, the top-level one being <code>ServerRoutes</code>.</p>
<p>Servant routing specification is great for large-scale systems. To demo that point, we split the routing at the top-level into two branches: <code>anonymous</code> and <code>authenticated</code>.  Nothing special happens for the routes that are part of the <code>anonymous</code> branch and the definition just continues at the <code>AnonymousRoutes</code> type. But for the routes defined in the <code>authenticated</code> branch, some standard pre-processing logic will occur before their logic is executed.</p>
<p>Ok here's the cool stuff. The line of code:</p>
<p><code>route :- Auth '[JWT, Sauth.BasicAuth] SessionContext :&gt; ToServantApi AuthenticatedRoutes</code></p>
<p>is a type expression, not just a type definition. The exotic <code>:-</code>, <code>'[ ]</code> and <code>:&gt;</code> symbols are actually type functions defined by <em>Servant</em>; remember that Haskell gives developer a lot of flexibility in function naming. These functions operate on types rather than values. For the heavy-duty functional folks, that's 2nd order logic.</p>
<p>The code states that a <code>route</code> construct is extended (<code>:-</code>) so that the request handling logic first figures out the authentication (<code>Auth</code>) using JWT and BasicAuth (<code>'[JWT, Sauth.BasicAuth]</code>) and carries that into the session information (<code>SessionContext</code>) before chaining on to the next level of route definitions provided by the <code>AuthenticatedRoutes</code>.</p>
<p>The end-result of Servant advanced type operations is that we can assemble routes in logical groups which can be named, we can cluster and extend route definitions, we can specify formally the data structures that will come in and out of the HTTP request processing and handling, and we can get automatic complex conversions between client and server-side data. As the web app grows, this provides significant time saving during refactoring, cleaning and testing.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=20824766-ddd1-41db-b524-58de524262f9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The route definitions. Code first, description after:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=fbe27ed2-4990-4858-a530-70a37a8d3cf8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [92]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">data</span><span class="w"> </span><span class="kt">ServerRoutes</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">ServerRoutes</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">anonymous</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="kt">:-</span><span class="w"> </span><span class="kt">ToServantApi</span><span class="w"> </span><span class="kt">AnonymousRoutes</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">authenticated</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="kt">:-</span><span class="w"> </span><span class="kt">Auth</span><span class="w"> </span><span class="kt">'[JWT, Sauth.BasicAuth]</span><span class="w"> </span><span class="kt">SessionContext</span><span class="w"> </span><span class="kt">:&gt;</span><span class="w"> </span><span class="kt">ToServantApi</span><span class="w"> </span><span class="kt">AuthenticatedRoutes</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Generic</span><span class="p">)</span>


<span class="kr">data</span><span class="w"> </span><span class="kt">AnonymousRoutes</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">AnonymousRoutes</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">login</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="kt">:-</span><span class="w"> </span><span class="s">"inlogin"</span><span class="w"> </span><span class="kt">:&gt;</span><span class="w"> </span><span class="kt">ReqBody</span><span class="w"> </span><span class="kt">'[JSON]</span><span class="w"> </span><span class="kt">LoginForm</span><span class="w"> </span><span class="kt">:&gt;</span><span class="w"> </span><span class="kt">Post</span><span class="w"> </span><span class="kt">'[JSON]</span><span class="w"> </span><span class="kt">LoginResult</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">staticLink</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="kt">:-</span><span class="w"> </span><span class="s">"ph_1/xstatic"</span><span class="w"> </span><span class="kt">:&gt;</span><span class="w"> </span><span class="kt">CaptureAll</span><span class="w"> </span><span class="s">"path"</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="kt">:&gt;</span><span class="w"> </span><span class="kt">Get</span><span class="w"> </span><span class="kt">'[HTML]</span><span class="w"> </span><span class="kt">RawHtml</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="kt">:-</span><span class="w"> </span><span class="s">"stream"</span><span class="w"> </span><span class="kt">:&gt;</span><span class="w"> </span><span class="kt">WebSocket</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">search</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="kt">:-</span><span class="w"> </span><span class="s">"xsearch"</span><span class="w"> </span><span class="kt">:&gt;</span><span class="w"> </span><span class="kt">ReqBody</span><span class="w"> </span><span class="kt">'[FormUrlEncoded]</span><span class="w"> </span><span class="kt">SearchContent</span><span class="w"> </span><span class="kt">:&gt;</span><span class="w"> </span><span class="kt">Post</span><span class="w"> </span><span class="kt">'[HTML]</span><span class="w"> </span><span class="kt">RawHtml</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">homePage</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="kt">:-</span><span class="w"> </span><span class="kt">Get</span><span class="w"> </span><span class="kt">'[HTML]</span><span class="w"> </span><span class="kt">RawHtml</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Generic</span><span class="p">)</span>


<span class="kr">newtype</span><span class="w"> </span><span class="kt">AuthenticatedRoutes</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">AuthenticatedRoutes</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">privateAccess</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="kt">:-</span><span class="w"> </span><span class="s">"private"</span><span class="w"> </span><span class="kt">:&gt;</span><span class="w"> </span><span class="kt">ToServantApi</span><span class="w"> </span><span class="kt">PrivateRoutes</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Generic</span><span class="p">)</span>


<span class="kr">newtype</span><span class="w"> </span><span class="kt">PrivateRoutes</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">PrivateRoutes</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">getPage</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="kt">:-</span><span class="w"> </span><span class="s">"static"</span><span class="w"> </span><span class="kt">:&gt;</span><span class="w"> </span><span class="kt">Capture</span><span class="w"> </span><span class="s">"path"</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="kt">:&gt;</span><span class="w"> </span><span class="kt">Get</span><span class="w"> </span><span class="kt">'[HTML]</span><span class="w"> </span><span class="kt">RawHtml</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Generic</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=1816b1a6-808c-4f7e-858e-b1d9c43d4e5f">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>AnonymousRoutes</code> specifies 5 routes. You can probably already guess what is being defined if you read the 5 type definitions, but here is the explanation:</p>
<ul>
<li>the <code>login</code> route is at <em>/inlogin</em> (first part), it expects a payload of JSON from the client compabitle with the <code>LoginForm</code>, it comes in as a POST request and its handler will provide a <code>LoginResult</code> that will sent back as a JSON block.  That's the route a client uses to authenticate itself.</li>
<li>the <code>staticLink</code> route is at <em>/xstatic</em>, it expects more segments in the URL and these will be globbed up as a list of strings (<code>CaptureAll ...</code>; the <code>path</code> identifier is just a placeholder), it comes as a GET request and the handler will return some long text that the client will consume as <em>text/html</em> content (<code>GET '[HTML] RawHtml</code>).</li>
<li>the <code>stream</code> route is at <em>/stream</em>, and it's going to operate as a websocket connection.</li>
<li>the <code>search</code> route is at <em>/xsearch</em>, it expects a <em>urlencoded</em> form in the URL in the form of <code>SearchContent</code>, it comes in as a POST request and the handler will return some long text that the client (it's starting to be repetitive).</li>
<li>the <code>homePage</code> route is <em>/</em>, it simply comes in as GET request and returns <em>text/html</em>, ie a the HTML for the home page.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=7eda1671-6345-445e-9586-641c068cdfe3">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>AuthenticatedRoutes</code> is a grouping for handling requests to the <em>/private</em> path prefix. I wanted to showcase the convenient structuring and extension of route definitions in Servant, but I don't want to make the API too long, so there's only a very simple continuation in the group, defined by the <code>PrivateRoutes</code> type. That last definition, <code>PrivatesRoutes</code>, provides a <code>getPage</code> route. As it is an extension, the actual URL for that route will be <em>/private/static</em>. Like the <code>xstatic</code> route it is a globber, it comes in as a GET and the handler will return a HTML page.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=37c70676-aaf8-4623-bf65-11dfb9e89003">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>In real life you'd expect to have many more route definitions in the authenticated group and probably many levels of definitions. For an introductory example, we have enough.</p>
<p>Now that routes are specified as types, the entire conformance and meta-programming power of Haskell is available to analyse the specifications and activate all kind of further processing.  There's no extra description file required, no pre-parsing or conversion step, no boiler-plate code generation required.</p>
<p>The meta-programming features can also integrate popular 3rd party API specs in the <em>Servant</em> framework. For example if you have an API specified as a <em>GraphQL</em> file, the compiler can read the spec file directly (<a href="https://hackage.haskell.org/package/morpheus-graphql">Morpheus</a>) as the base for <em>Servant</em> route definitions. There are no intermediate file generated, no rewriting functions, etc; you can just focus on adding handler logic. There are similar solutions for <em>OpenAPI</em> files.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=e3a4e5b6-6dd3-4753-9fc3-33201b119e8e">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Specific error management for our handlers is defined by the <code>DemoServiceError</code> structure. When a request handler hits an issue, it throws an error specified in <code>DemoServiceError</code>. The Servant logic will do the rest to send a proper response to the client, using the <code>asHttpError</code> function to convert from our specific web app issues to standard HTTP errors.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=c0f46963-05b6-4d6d-83ee-2d8fdecd7e96">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [93]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">data</span><span class="w"> </span><span class="kt">DemoServiceError</span>
<span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">NotImplemented</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">UnexpectedError</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">NotAuthorized</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">Unaccessible</span>
<span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="kt">NotFound</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="p">(</span><span class="kt">Generic</span><span class="p">,</span><span class="w"> </span><span class="kt">Show</span><span class="p">,</span><span class="w"> </span><span class="kt">Eq</span><span class="p">)</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">anyclass</span><span class="w"> </span><span class="p">(</span><span class="kt">ToJSON</span><span class="p">,</span><span class="w"> </span><span class="kt">FromJSON</span><span class="p">)</span>


<span class="nf">asHttpError</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">DemoServiceError</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">ServerError</span>
<span class="nf">asHttpError</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kr">case</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="kr">of</span>
<span class="w">    </span><span class="kt">Unaccessible</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">err401</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">errBody</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"Resource not accessible."</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kt">NotImplemented</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">err500</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">errBody</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"Not Implemented."</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kt">UnexpectedError</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">err500</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">errBody</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">textToLBS</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kt">NotAuthorized</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">err401</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">errBody</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">textToLBS</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kt">NotFound</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">err404</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">errBody</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">textToLBS</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="kr">where</span>
<span class="w">    </span><span class="n">textToLBS</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">LBS</span><span class="o">.</span><span class="n">fromStrict</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">encodeUtf8</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d59f9519-504e-493f-bcdc-64fea5e40016">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Finally we define the <code>WebApp</code> structure to hold an execution state for route handlers invoked by Servant main logic. It's rather a technical detail, but importantly it connects the global data context <code>AppEnv</code> and the specific error management <code>DemoServiceError</code> with the request handlers execution. The <code>WebApp</code> type is automagically bound to the result of each route handler as per its specific route definition.</p>
<p><strong>Note:</strong> the <code>WebApp</code> type is deriving lots of <em>Monad</em> stuff because the <em>Monad</em> meta-programming is Haskell way of dealing with real life processing and state management, ie changing context and non-pure execution.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=50cb2d2f-cde5-4d7d-ac78-06fe20c8d925">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [94]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">newtype</span><span class="w"> </span><span class="kt">WebApp</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">WebApp</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">runApp</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">ReaderT</span><span class="w"> </span><span class="kt">AppEnv</span><span class="w"> </span><span class="p">(</span><span class="kt">ExceptT</span><span class="w"> </span><span class="kt">DemoServiceError</span><span class="w"> </span><span class="kt">IO</span><span class="p">)</span><span class="w"> </span><span class="n">a</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="kr">newtype</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="kt">Functor</span><span class="p">,</span><span class="w"> </span><span class="kt">Applicative</span><span class="p">,</span><span class="w"> </span><span class="kt">Monad</span><span class="p">,</span><span class="w"> </span><span class="kt">MonadMask</span><span class="p">,</span><span class="w"> </span><span class="kt">MonadCatch</span><span class="p">,</span><span class="w"> </span><span class="kt">MonadThrow</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="kt">MonadReader</span><span class="w"> </span><span class="kt">AppEnv</span><span class="p">,</span><span class="w"> </span><span class="kt">MonadIO</span><span class="p">,</span><span class="w"> </span><span class="kt">MonadError</span><span class="w"> </span><span class="kt">DemoServiceError</span>
<span class="w">  </span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=b1964652-ac1a-4b1b-add2-c02922736ef4">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We now get to the first route handler, <code>loginHandler</code>. It gets a LoginForm as a parameter and returns a LoginResult. Due to the bottom-up rather than top-down code presentation, the function will be linked to the <em>/inlogin</em> endpoint in code that will show up further down in the <em>handler associations</em> section.</p>
<p>As this is a demo without a real authentification system, the <code>loginHandler</code> simply pulls out JWT stuff with:</p>
<p><code>asks jwtSettings</code></p>
<p>which extracts the info from the <code>jwtSettings</code> field that is held in the <code>AppEnv</code> value (Haskell monad magic at work). If there's no problem doing so, it builds a new encrypted token with a fake <code>SessionContext</code> and puts that into a <code>LoginResult</code> value that is the result of the <code>loginHandler</code> call.  If there's a problem, an <code>UnexpectedError</code> is thrown.</p>
<p>In a real life application, the authentication logic would be provided in the <code>AppEnv</code> value, and it would be used to assess the validity of the login data. Alternatively a 3rd-party authentication system could have already provided a JWT for the client and then that token would simply be verified by <code>loginHandler</code>, ie there would be no <code>LoginForm</code> required and instead the route definition would specify how the JWT is received (in headers, as a URL parameter, etc).</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=68a63fe2-d8fa-4cf3-bc27-5005a75b0cfb">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [95]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">loginHandler</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">LoginForm</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">WebApp</span><span class="w"> </span><span class="kt">LoginResult</span>
<span class="nf">loginHandler</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">settings</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">asks</span><span class="w"> </span><span class="n">jwtSettings</span>
<span class="w">  </span><span class="n">jwtRez</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">liftIO</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Sauth</span><span class="o">.</span><span class="n">makeJWT</span><span class="w"> </span><span class="p">(</span><span class="kt">SessionContext</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="kt">Nothing</span>
<span class="w">  </span><span class="kr">case</span><span class="w"> </span><span class="n">jwtRez</span><span class="w"> </span><span class="kr">of</span>
<span class="w">    </span><span class="kt">Left</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">      </span><span class="n">throwError</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">UnexpectedError</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">err</span>
<span class="w">    </span><span class="kt">Right</span><span class="w"> </span><span class="n">jwtValue</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">      </span><span class="n">pure</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">LoginResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">context</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">SessionContext</span><span class="w"> </span><span class="mi">1</span>
<span class="w">          </span><span class="p">,</span><span class="w"> </span><span class="n">jwt</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">decodeUtf8</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">LBS</span><span class="o">.</span><span class="n">toStrict</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">jwtValue</span>
<span class="w">        </span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=655564cb-cd74-416c-b42b-1574b286c7dd">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>homePage</code> handler loads up a Jinja template, puts some values in its render context from the DB, and sends that back as the result to the client. In a real life application there would be some caching and/or session pooling to use the DB resource more efficiently.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=2733c98b-3e79-4219-bd9d-e6000a1a88d6">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [96]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">homePageHandler</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">WebApp</span><span class="w"> </span><span class="kt">RawHtml</span>
<span class="nf">homePageHandler</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">template</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">liftIO</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Prelude</span><span class="o">.</span><span class="n">readFile</span><span class="w"> </span><span class="s">"ph_1/xstatic/templates/templ_4.html"</span>
<span class="w">  </span><span class="kr">let</span>
<span class="w">    </span><span class="n">genHtml</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">htmlSource</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">runGinger</span><span class="w"> </span><span class="p">(</span><span class="kt">Gi</span><span class="o">.</span><span class="n">makeContextHtml</span><span class="w"> </span><span class="n">derefLabelB</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">loadTemplateB</span><span class="w"> </span><span class="n">template</span><span class="p">)</span>
<span class="w">  </span><span class="n">pure</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">RawHtml</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">LBS</span><span class="o">.</span><span class="n">fromStrict</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">encodeUtf8</span><span class="w">  </span><span class="o">$</span><span class="w"> </span><span class="n">genHtml</span>

<span class="nf">derefLabelB</span><span class="w"> </span><span class="n">needle</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">Gi</span><span class="o">.</span><span class="n">toGVal</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Mp</span><span class="o">.</span><span class="n">lookup</span><span class="w"> </span><span class="n">needle</span><span class="w"> </span><span class="n">demoData_1</span>

<span class="nf">loadTemplateB</span><span class="w"> </span><span class="n">aTemplate</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">either</span><span class="w"> </span><span class="p">(</span><span class="ne">error</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">show</span><span class="p">)</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">runIdentity</span><span class="w"> </span><span class="o">$</span>
<span class="w">    </span><span class="kt">Gi</span><span class="o">.</span><span class="n">parseGinger</span><span class="w"> </span><span class="p">(</span><span class="n">const</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="kt">Nothing</span><span class="p">)</span><span class="w"> </span><span class="kt">Nothing</span><span class="w"> </span><span class="n">aTemplate</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=fb4a5599-b362-4afa-a79d-ca3edb26066d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>searchHandler</code> is the endpoint logic that responds to a HTMX request, so it replies with HTML-formatted content in which values are fetched from the DB:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=05d310e0-8e37-4b3b-80fe-9bc877ca4fb2">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [97]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">searchHandler</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">SearchContent</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">WebApp</span><span class="w"> </span><span class="kt">RawHtml</span>
<span class="nf">searchHandler</span><span class="w"> </span><span class="n">searchContent</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">mbDbCtxt</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">asks</span><span class="w"> </span><span class="n">dbCtxt</span>
<span class="w">  </span><span class="n">dbVal</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kr">case</span><span class="w"> </span><span class="n">mbDbCtxt</span><span class="w"> </span><span class="kr">of</span>
<span class="w">    </span><span class="kt">Just</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="n">rezA</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">liftIO</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Se</span><span class="o">.</span><span class="n">run</span><span class="w"> </span><span class="p">(</span><span class="n">simpleQuery</span><span class="w"> </span><span class="n">searchContent</span><span class="o">.</span><span class="n">needle</span><span class="p">)</span><span class="w"> </span><span class="n">conn</span>
<span class="w">      </span><span class="kr">case</span><span class="w"> </span><span class="n">rezA</span><span class="w"> </span><span class="kr">of</span>
<span class="w">        </span><span class="kt">Left</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">Left</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">err</span>
<span class="w">        </span><span class="kt">Right</span><span class="w"> </span><span class="n">mbVal</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Right</span><span class="w"> </span><span class="n">mbVal</span>
<span class="w">    </span><span class="kt">Nothing</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">throwError</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">UnexpectedError</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"No database available."</span>
<span class="w">  </span><span class="kr">let</span>
<span class="w">    </span><span class="n">genHtml</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">htmlSource</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Gi</span><span class="o">.</span><span class="n">runGinger</span><span class="w"> </span><span class="p">(</span><span class="kt">Gi</span><span class="o">.</span><span class="n">makeContextHtml</span><span class="w"> </span><span class="p">(</span><span class="n">derefGhProj</span><span class="w"> </span><span class="n">dbVal</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="n">loadTemplate</span><span class="w"> </span><span class="n">template_2</span><span class="p">)</span>
<span class="w">  </span><span class="n">pure</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">RawHtml</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">LBS</span><span class="o">.</span><span class="n">fromStrict</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">encodeUtf8</span><span class="w">  </span><span class="o">$</span><span class="w"> </span><span class="n">genHtml</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=1226610f-36d4-4d73-a940-17191300dd74">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>anonStaticHandler</code> simply loads up files from the <em>xstatic/assets</em> local Jupyter server directory and sends that data back to the client as a <em>text/html</em> reply.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=0712c699-6642-4161-b0aa-e1d6ad007482">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [98]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">anonStaticHandler</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">WebApp</span><span class="w"> </span><span class="kt">RawHtml</span>
<span class="nf">anonStaticHandler</span><span class="w"> </span><span class="n">pageUrls</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="kr">let</span>
<span class="w">    </span><span class="n">fullPath</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Prelude</span><span class="o">.</span><span class="n">foldl</span><span class="w"> </span><span class="p">(</span><span class="nf">\</span><span class="n">accum</span><span class="w"> </span><span class="n">segment</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">accum</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s">"/"</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">segment</span><span class="p">)</span><span class="w"> </span><span class="s">"ph_1/xstatic"</span><span class="w"> </span><span class="n">pageUrls</span>
<span class="w">  </span><span class="c1">-- liftIO deals with getting the right order of IO and WebApp monadic contexts:</span>
<span class="w">  </span><span class="n">pageContent</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">liftIO</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">LBS</span><span class="o">.</span><span class="n">readFile</span><span class="w"> </span><span class="n">fullPath</span>
<span class="w">  </span><span class="n">pure</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">RawHtml</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">pageContent</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=d672344b-c044-4579-a24c-d317fcaad1c9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>prvStaticHandler</code> does the same job as the <code>anonStaticHandler</code>, but as it's in the private group or routes, it gets authentication and session information as parameters (the <code>AuthResult SessionContext</code> part). It would then allow/block or modify content access based on that. For the sake of simplicity of this demo, it ignores that information and just returns some HTML.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=3408357f-ecd3-4ad2-9fc4-0d754706b360">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [99]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">prvStaticHandler</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">AuthResult</span><span class="w"> </span><span class="kt">SessionContext</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">WebApp</span><span class="w"> </span><span class="kt">RawHtml</span>
<span class="nf">prvStaticHandler</span><span class="w"> </span><span class="n">authResult</span><span class="w"> </span><span class="n">pageUrl</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kr">case</span><span class="w"> </span><span class="n">authResult</span><span class="w"> </span><span class="kr">of</span>
<span class="w">    </span><span class="kt">Authenticated</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">      </span><span class="c1">-- TODO: fetch an interesting piece of information in HTML.</span>
<span class="w">      </span><span class="kr">let</span>
<span class="w">        </span><span class="n">content</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">renderHtml</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">div</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">toHtml</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">context</span><span class="o">.</span><span class="n">sessionID</span>
<span class="w">      </span><span class="kr">in</span>
<span class="w">        </span><span class="n">pure</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">RawHtml</span><span class="w"> </span><span class="n">content</span>
<span class="w">    </span><span class="kr">_</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">      </span><span class="n">throwError</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">NotAuthorized</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">pack</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">pageUrl</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=e3e7253f-36e8-464a-b4cf-6e2483128339">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Finally we have the <code>streamHandler</code> handler. It receives requests from clients over a websocket connection. It replies on the same connection with HTML-formatted data, as it is intented to be invoked from HTMX-enabled elements:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=9aa76418-5130-4643-92ad-8fa2508462a7">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [100]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">streamHandler</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">MonadIO</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="ow">=&gt;</span><span class="w"> </span><span class="kt">Ws</span><span class="o">.</span><span class="kt">Connection</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="nb">()</span>
<span class="nf">streamHandler</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="n">liftIO</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Ws</span><span class="o">.</span><span class="n">withPingThread</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">(</span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span><span class="p">)</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="c1">-- if you want to inspect streaming: liftIO $ Ws.sendTextData conn ("&lt;div id=\"notifications\" hx-swap-oob=\"beforeend\"&gt;Some message&lt;/div?" :: ByteString)</span>
<span class="w">    </span><span class="n">handleClient</span>
<span class="w">  </span><span class="kr">where</span>
<span class="w">    </span><span class="n">handleClient</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="n">rezA</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">tryAny</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">receiveStream</span>
<span class="w">      </span><span class="kr">case</span><span class="w"> </span><span class="n">rezA</span><span class="w"> </span><span class="kr">of</span>
<span class="w">        </span><span class="kt">Left</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">do</span>
<span class="w">          </span><span class="n">liftIO</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">putStrLn</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"@[streamHandler] situation: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">err</span>
<span class="w">          </span><span class="n">closeConnection</span>
<span class="w">        </span><span class="kt">Right</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">do</span>
<span class="w">          </span><span class="n">liftIO</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">putStrLn</span><span class="w"> </span><span class="s">"@[streamHandler] client disconnected."</span>
<span class="w">          </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span>

<span class="w">    </span><span class="n">receiveStream</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="n">rezA</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kt">Ws</span><span class="o">.</span><span class="n">receiveDataMessage</span><span class="w"> </span><span class="n">conn</span>
<span class="w">      </span><span class="kr">case</span><span class="w"> </span><span class="n">rezA</span><span class="w"> </span><span class="kr">of</span>
<span class="w">        </span><span class="kt">Ws</span><span class="o">.</span><span class="kt">Text</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="n">decodedMsg</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">          </span><span class="kr">let</span>
<span class="w">            </span><span class="n">hxMsg</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">eitherDecode</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Either</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="kt">HxWsMessage</span>
<span class="w">          </span><span class="kr">in</span>
<span class="w">          </span><span class="kr">case</span><span class="w"> </span><span class="n">hxMsg</span><span class="w"> </span><span class="kr">of</span>
<span class="w">            </span><span class="kt">Left</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">do</span>
<span class="w">              </span><span class="n">putStrLn</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"@[receiveStream] invalid HxWsMessage: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="n">unpack</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="n">decodeUtf8</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">LBS</span><span class="o">.</span><span class="n">toStrict</span><span class="p">)</span><span class="w"> </span><span class="n">msg</span>
<span class="w">              </span><span class="n">putStrLn</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"@[receiveStream] error: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">err</span>
<span class="w">            </span><span class="kt">Right</span><span class="w"> </span><span class="n">hxMsg</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">              </span><span class="kt">Ws</span><span class="o">.</span><span class="n">sendTextData</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">renderHtml</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">htmxReply</span><span class="w"> </span><span class="n">hxMsg</span><span class="o">.</span><span class="n">wsMessage</span>
<span class="w">        </span><span class="kt">Ws</span><span class="o">.</span><span class="kt">Binary</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">          </span><span class="n">putStrLn</span><span class="w"> </span><span class="s">"@[receiveStream] received binary."</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">closeConnection</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="kt">Ws</span><span class="o">.</span><span class="n">sendClose</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="p">(</span><span class="s">"Bye"</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">ByteString</span><span class="p">)</span>
<span class="w">      </span><span class="n">void</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Ws</span><span class="o">.</span><span class="n">receiveDataMessage</span><span class="w"> </span><span class="n">conn</span>

<span class="w">    </span><span class="n">htmxReply</span><span class="w"> </span><span class="n">aMessage</span><span class="w"> </span><span class="ow">=</span>
<span class="w">      </span><span class="kt">H</span><span class="o">.</span><span class="n">tbody</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="s">"notifications"</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">X</span><span class="o">.</span><span class="n">hxSwapOob</span><span class="w"> </span><span class="s">"beforeend"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">        </span><span class="kt">H</span><span class="o">.</span><span class="n">tr</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kr">do</span>
<span class="w">          </span><span class="kt">H</span><span class="o">.</span><span class="n">td</span><span class="w"> </span><span class="kt">H</span><span class="o">.!</span><span class="w"> </span><span class="kt">A</span><span class="o">.</span><span class="n">class_</span><span class="w"> </span><span class="s">"px-6 py-4 whitespace-nowrap text-sm text-slate-900"</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">H</span><span class="o">.</span><span class="n">toHtml</span><span class="w"> </span><span class="n">aMessage</span>
<span class="w">                </span>

<span class="kr">data</span><span class="w"> </span><span class="kt">HxWsHeaders</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">HxWsHeaders</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">request</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">trigger</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">triggerName</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Maybe</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">currentURL</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="n">stock</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="p">,</span><span class="w"> </span><span class="kt">Generic</span><span class="p">)</span>

<span class="kr">instance</span><span class="w"> </span><span class="kt">FromJSON</span><span class="w"> </span><span class="kt">HxWsHeaders</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">parseJSON</span><span class="w"> </span><span class="p">(</span><span class="kt">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">HxWsHeaders</span><span class="w"> </span><span class="o">&lt;$&gt;</span>
<span class="w">    </span><span class="n">obj</span><span class="w"> </span><span class="o">.:</span><span class="w"> </span><span class="s">"HX-Request"</span>
<span class="w">    </span><span class="o">&lt;*&gt;</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">.:</span><span class="w"> </span><span class="s">"HX-Trigger"</span>
<span class="w">    </span><span class="o">&lt;*&gt;</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">.:?</span><span class="w"> </span><span class="s">"HX-Trigger-Name"</span>
<span class="w">    </span><span class="o">&lt;*&gt;</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">.:</span><span class="w"> </span><span class="s">"HX-Target"</span>
<span class="w">    </span><span class="o">&lt;*&gt;</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">.:</span><span class="w"> </span><span class="s">"HX-Current-URL"</span>


<span class="kr">data</span><span class="w"> </span><span class="kt">HxWsMessage</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">HxWsMessage</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">wsMessage</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">headers</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">HxWsHeaders</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kr">deriving</span><span class="w"> </span><span class="p">(</span><span class="kt">Show</span><span class="p">,</span><span class="w"> </span><span class="kt">Generic</span><span class="p">)</span>


<span class="kr">instance</span><span class="w"> </span><span class="kt">FromJSON</span><span class="w"> </span><span class="kt">HxWsMessage</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">parseJSON</span><span class="w"> </span><span class="p">(</span><span class="kt">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">HxWsMessage</span><span class="w"> </span><span class="o">&lt;$&gt;</span>
<span class="w">    </span><span class="n">obj</span><span class="w"> </span><span class="o">.:</span><span class="w"> </span><span class="s">"ws-message"</span>
<span class="w">    </span><span class="o">&lt;*&gt;</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">.:</span><span class="w"> </span><span class="s">"HEADERS"</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=6cb4fe5d-84f1-4d4c-8e50-8495a7b800a8">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The <code>hxWsMessage</code> and <code>HxWsHeaders</code> structures receive the data sent by the HTMX logic on the client. They extend the <code>FromJSON</code> <em>typeclass</em> logic to match the format used by HTMX to send the client's data.</p>
<p><strong>Note:</strong> the flexibility of JSON conversion provided by the <code>FromJSON</code> <em>typeclass</em> results in more code than for example the <strong>Golang</strong> <code>struct</code> tags (<code>'json:...'</code>). In this notebook it's worthy to expose the conversion mechanisms for learning purposes. But of course there's a package out there that provides a camel-case formating function to achieve the same pre-defined field name encoding as in the <strong>Golang</strong> tags.</p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=ff4ad6fa-2c14-4d6d-a447-7c993a5e2e91">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We're almost done! After having defined the routes and handlers, we connect them together in the next block of code. First we specify the functions that use Servant's <code>genericServerT</code> combinator, second we define a value for each of the route types we've created a few cells ago, and third we associate each handler function that implement an endpoint.</p>
<p>The ultimate glue point for all these specifications to Servant general request handling logic is the weird looking</p>
<pre><code>serverApiProxy :: Proxy (ToServantApi ServerRoutes)
serverApiProxy = Proxy</code></pre>
<p>It's a typing trick! The important part is the type definition <code>Proxy (ToServantApi ServerRoutes)</code> for the function <code>serverApiProxy</code>.  That will be analyzed by the compiler to figure out all kind of futher logic expansion using the definitions of <code>ServerRoutes</code>. The function implementation is just providing a generic value of that <code>Proxy ...</code> type, using the constructor also named <code>Proxy</code>. The funciton itself has no real use.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=0c5b1a60-38c9-4967-9119-164413b76de0">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [101]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="c1">-- Handler associations:</span>
<span class="nf">serverApiProxy</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Proxy</span><span class="w"> </span><span class="p">(</span><span class="kt">ToServantApi</span><span class="w"> </span><span class="kt">ServerRoutes</span><span class="p">)</span>
<span class="nf">serverApiProxy</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Proxy</span>


<span class="nf">serverApiT</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">ToServant</span><span class="w"> </span><span class="kt">ServerRoutes</span><span class="w"> </span><span class="p">(</span><span class="kt">AsServerT</span><span class="w"> </span><span class="kt">WebApp</span><span class="p">)</span>
<span class="nf">serverApiT</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="n">genericServerT</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">ServerRoutes</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">anonymous</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">anonHandlers</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">authenticated</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">authHandlers</span>
<span class="w">  </span><span class="p">}</span>


<span class="nf">anonHandlers</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">ToServant</span><span class="w"> </span><span class="kt">AnonymousRoutes</span><span class="w"> </span><span class="p">(</span><span class="kt">AsServerT</span><span class="w"> </span><span class="kt">WebApp</span><span class="p">)</span>
<span class="nf">anonHandlers</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="n">genericServerT</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">AnonymousRoutes</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">login</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">loginHandler</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">staticLink</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">anonStaticHandler</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">streamHandler</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">homePage</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">homePageHandler</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">search</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">searchHandler</span>
<span class="w">  </span><span class="p">}</span>


<span class="nf">authHandlers</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">AuthResult</span><span class="w"> </span><span class="kt">SessionContext</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">ToServant</span><span class="w"> </span><span class="kt">AuthenticatedRoutes</span><span class="w"> </span><span class="p">(</span><span class="kt">AsServerT</span><span class="w"> </span><span class="kt">WebApp</span><span class="p">)</span>
<span class="nf">authHandlers</span><span class="w"> </span><span class="n">authResult</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="n">genericServerT</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">AuthenticatedRoutes</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">privateAccess</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">prvStaticHandler</span><span class="w"> </span><span class="n">authResult</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=79fb191b-2fe2-494c-be50-3845f77ae9fe">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>As the web service uses <em>form/url-encoded</em> authentication, there's a logic extension provided for our <code>SessionContext</code> structure that could do some validation and book-keeping. But in this demo it will just defer to the default validation function <code>authCheckFun</code>.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=a3b1b8f7-deed-48a3-b9e4-d968448eb8f1">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [102]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">type</span><span class="w"> </span><span class="kr">instance</span><span class="w"> </span><span class="kt">BasicAuthCfg</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Srv</span><span class="o">.</span><span class="kt">BasicAuthData</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="p">(</span><span class="kt">AuthResult</span><span class="w"> </span><span class="kt">SessionContext</span><span class="p">)</span>
<span class="kr">instance</span><span class="w"> </span><span class="kt">FromBasicAuthData</span><span class="w"> </span><span class="kt">SessionContext</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="n">fromBasicAuthData</span><span class="w"> </span><span class="n">authData</span><span class="w"> </span><span class="n">authCheckFun</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">authCheckFun</span><span class="w"> </span><span class="n">authData</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=c0bb1854-5558-4c1f-9818-06b391169f28">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We have reached the operation side of running a web service! First, the WAI control is defined, where the listen port, the pre-processing logic (<code>showBanner</code>!) and the process interruption management are defined (<code>shutdownHandler</code>).</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=b37dc21d-e7d6-4cb5-8718-3900b8fbb147">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [103]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">setupWai</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="nb">()</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Settings</span>
<span class="nf">setupWai</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">shutdownCallback</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">Wr</span><span class="o">.</span><span class="n">setPort</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">Wr</span><span class="o">.</span><span class="n">setGracefulShutdownTimeout</span><span class="w"> </span><span class="p">(</span><span class="kt">Just</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="kt">Wr</span><span class="o">.</span><span class="n">setInstallShutdownHandler</span><span class="w"> </span><span class="n">shutdownHandler</span>
<span class="w">    </span><span class="o">.</span><span class="w"> </span><span class="n">setBeforeMainLoop</span><span class="w"> </span><span class="n">showBanner</span>
<span class="w">    </span><span class="o">$</span><span class="w"> </span><span class="kt">Wr</span><span class="o">.</span><span class="n">defaultSettings</span>
<span class="w">  </span><span class="kr">where</span>
<span class="w">    </span><span class="n">showBanner</span><span class="w"> </span><span class="ow">=</span>
<span class="w">      </span><span class="n">putStrLn</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"@[setupWai] using port: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">port</span>
<span class="w">    </span><span class="n">shutdownHandler</span><span class="w"> </span><span class="n">closeSocket</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="n">void</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">installHandler</span><span class="w"> </span><span class="kt">Sgnl</span><span class="o">.</span><span class="n">sigTERM</span><span class="w"> </span><span class="p">(</span><span class="kt">Catch</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">shutdownCallback</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">closeSocket</span><span class="p">)</span><span class="w"> </span><span class="kt">Nothing</span>
<span class="w">      </span><span class="n">void</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">installHandler</span><span class="w"> </span><span class="kt">Sgnl</span><span class="o">.</span><span class="n">sigINT</span><span class="w"> </span><span class="p">(</span><span class="kt">Catch</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">shutdownCallback</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">closeSocket</span><span class="p">)</span><span class="w"> </span><span class="kt">Nothing</span>
<span class="w">      </span><span class="n">void</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">installHandler</span><span class="w"> </span><span class="kt">Sgnl</span><span class="o">.</span><span class="n">sigQUIT</span><span class="w"> </span><span class="p">(</span><span class="kt">Catch</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">shutdownCallback</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">closeSocket</span><span class="p">)</span><span class="w"> </span><span class="kt">Nothing</span>
<span class="w">      </span><span class="n">void</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">installHandler</span><span class="w"> </span><span class="kt">Sgnl</span><span class="o">.</span><span class="n">sigHUP</span><span class="w"> </span><span class="p">(</span><span class="kt">Catch</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">shutdownCallback</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">closeSocket</span><span class="p">)</span><span class="w"> </span><span class="kt">Nothing</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=fd5e3c00-3ad4-4484-9f99-980ef5faef00">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>We now have reached the definition of the overall bootstrap logic for the servicing, the <code>runAPI</code> function. It takes care of setting up the JWT encryption components, the DB connection, it puts the middlewares in place (logging, multi-part requests handler, CORS policy handlers), creates the global context <code>appEnv</code> that each handler will work with, builds the main server loop (<code>hostServerWithContext ...</code>) and finally returns everything linked together.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=734c1054-e939-4a20-b8cc-7ddcb562a967">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [104]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">runAPI</span><span class="w"> </span><span class="ow">::</span><span class="w">  </span><span class="kt">Ropt</span><span class="o">.</span><span class="kt">RunOptions</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="kt">Application</span>
<span class="nf">runAPI</span><span class="w"> </span><span class="n">rtOpts</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="c1">-- Initialize the JWT parameters:</span>
<span class="w">  </span><span class="n">myKey</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kr">case</span><span class="w"> </span><span class="n">rtOpts</span><span class="o">.</span><span class="n">jwkConfFile</span><span class="w"> </span><span class="kr">of</span>
<span class="w">    </span><span class="kt">Nothing</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">      </span><span class="n">generateKeyPairIO</span><span class="w"> </span><span class="s">"/tmp/jwk.json"</span>
<span class="w">    </span><span class="kt">Just</span><span class="w"> </span><span class="n">aPath</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">      </span><span class="n">readJWK</span><span class="w"> </span><span class="n">aPath</span>

<span class="w">  </span><span class="c1">-- Initialize the DB parameters:</span>
<span class="w">  </span><span class="n">eiConn</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kt">DbC</span><span class="o">.</span><span class="n">acquire</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">DbC</span><span class="o">.</span><span class="n">settings</span><span class="w"> </span><span class="s">"aws-0-eu-central-1.pooler.supabase.com"</span><span class="w"> </span><span class="mi">5432</span><span class="w"> </span><span class="s">"demoa.vtjcwbccdutdqcsxdaqr"</span><span class="w"> </span><span class="s">"justForDemo"</span><span class="w"> </span><span class="s">"demoha"</span>
<span class="w">  </span><span class="kr">case</span><span class="w"> </span><span class="n">eiConn</span><span class="w"> </span><span class="kr">of</span>
<span class="w">    </span><span class="kt">Left</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="ow">-&gt;</span>
<span class="w">      </span><span class="n">putStrLn</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="s">"@[runAPI] db connection err: "</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">err</span>
<span class="w">    </span><span class="kt">Right</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span>

<span class="w">  </span><span class="c1">-- pure computations:</span>
<span class="w">  </span><span class="kr">let</span>
<span class="w">    </span><span class="n">cookieCfg</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">defaultCookieSettings</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cookieIsSecure</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">NotSecure</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">jwtDefSettings</span><span class="w">  </span><span class="ow">=</span><span class="w"> </span><span class="kt">Sauth</span><span class="o">.</span><span class="n">defaultJWTSettings</span><span class="w"> </span><span class="n">myKey</span>
<span class="w">    </span><span class="c1">-- For file upload support, will be used in next demo:</span>
<span class="w">    </span><span class="n">multipartOpts</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="p">(</span><span class="n">defaultMultipartOptions</span><span class="w"> </span><span class="p">(</span><span class="kt">Proxy</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Proxy</span><span class="w"> </span><span class="kt">Tmp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">          </span><span class="n">generalOptions</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">setMaxRequestKeyLength</span><span class="w"> </span><span class="mi">512</span><span class="w"> </span><span class="n">defaultParseRequestBodyOptions</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">    </span><span class="c1">-- Define the overall Servant pre-processing required on requests:</span>
<span class="w">    </span><span class="n">runContext</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">cookieCfg</span><span class="w"> </span><span class="kt">:.</span><span class="w"> </span><span class="n">jwtDefSettings</span><span class="w"> </span><span class="kt">:.</span><span class="w"> </span><span class="n">fakeSessionValidation</span><span class="w"> </span><span class="kt">:.</span><span class="w"> </span><span class="n">multipartOpts</span><span class="w"> </span><span class="kt">:.</span><span class="w"> </span><span class="kt">EmptyContext</span>
<span class="w">    </span><span class="n">runCtxtProxy</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Proxy</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Proxy</span><span class="w"> </span><span class="kt">'[CookieSettings, JWTSettings, BasicAuthCfg]</span>

<span class="w">    </span><span class="c1">-- activate some middlewares for loggin, CORS, standardized error handling:</span>
<span class="w">    </span><span class="n">middlewares</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">linkUp</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="kt">:|</span><span class="w"> </span><span class="kr">case</span><span class="w"> </span><span class="n">rtOpts</span><span class="o">.</span><span class="n">corsPolicy</span><span class="w"> </span><span class="kr">of</span>
<span class="w">      </span><span class="kt">Nothing</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">logStdout</span><span class="p">,</span><span class="w"> </span><span class="n">errorMw</span><span class="w"> </span><span class="o">@</span><span class="kt">JSON</span><span class="w"> </span><span class="o">@</span><span class="kt">'["message", "status" ]</span><span class="w"> </span><span class="p">]</span>
<span class="w">      </span><span class="kt">Just</span><span class="w"> </span><span class="n">aPolicy</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">logStdout</span><span class="p">,</span><span class="w"> </span><span class="n">setCorsPolicy</span><span class="w"> </span><span class="n">aPolicy</span><span class="p">,</span><span class="w"> </span><span class="n">errorMw</span><span class="w"> </span><span class="o">@</span><span class="kt">JSON</span><span class="w"> </span><span class="o">@</span><span class="kt">'["message", "status" ]</span><span class="w"> </span><span class="p">]</span>

<span class="w">    </span><span class="n">mbDbConn</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">case</span><span class="w"> </span><span class="n">eiConn</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="kt">Left</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Nothing</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="kt">Right</span><span class="w"> </span><span class="n">aConn</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Just</span><span class="w"> </span><span class="n">aConn</span>
<span class="w">    </span><span class="c1">-- define the global runtime context for handlers:</span>
<span class="w">    </span><span class="n">appEnv</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">AppEnv</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">jwtSettings</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">jwtDefSettings</span><span class="p">,</span><span class="w"> </span><span class="n">rtOptions</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">rtOpts</span><span class="p">,</span><span class="w"> </span><span class="n">dbCtxt</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">mbDbConn</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">-- link all that stuff in Servant magic:</span>
<span class="w">    </span><span class="n">server</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">hoistServerWithContext</span><span class="w"> </span><span class="n">serverApiProxy</span><span class="w"> </span><span class="n">runCtxtProxy</span><span class="w"> </span><span class="p">(</span><span class="n">toHandler</span><span class="w"> </span><span class="n">appEnv</span><span class="p">)</span><span class="w"> </span><span class="n">serverApiT</span>

<span class="w">  </span><span class="c1">-- launch the servicing:</span>
<span class="w">  </span><span class="n">pure</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">middlewares</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">serveWithContext</span><span class="w"> </span><span class="n">serverApiProxy</span><span class="w"> </span><span class="n">runContext</span><span class="w"> </span><span class="n">server</span>
<span class="w">  </span><span class="kr">where</span>
<span class="w">    </span><span class="n">linkUp</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">NonEmpty</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="n">linkUp</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Prelude</span><span class="o">.</span><span class="n">foldr1</span><span class="w"> </span><span class="p">(</span><span class="o">.</span><span class="p">)</span>

<span class="w">    </span><span class="c1">-- | Boilerplate transformation between our service structures and Servant's 'Handler' monad:</span>
<span class="w">    </span><span class="n">toHandler</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">AppEnv</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">WebApp</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Srv</span><span class="o">.</span><span class="kt">Handler</span><span class="w"> </span><span class="n">a</span>
<span class="w">    </span><span class="n">toHandler</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="ow">=</span>
<span class="w">      </span><span class="kt">Handler</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">withExceptT</span><span class="w"> </span><span class="n">asHttpError</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">flip</span><span class="w"> </span><span class="n">runReaderT</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">runApp</span>

<span class="w">    </span><span class="n">fakeSessionValidation</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">BasicAuthData</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="p">(</span><span class="kt">AuthResult</span><span class="w"> </span><span class="kt">SessionContext</span><span class="p">)</span>
<span class="w">    </span><span class="n">fakeSessionValidation</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="ow">=</span>
<span class="w">      </span><span class="n">pure</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Authenticated</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">SessionContext</span><span class="w"> </span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=611a734f-be45-418b-8c89-027ee568b86d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>The main function for executing the service is <code>listen</code>. It's using the <a href="https://hackage.haskell.org/package/mtl-2.3.1/docs/Control-Monad-Cont.html">Continuations</a> package, which is Haskell ecosystem main formalization for a high-level manager of complex processing environments that include multiple processes, interruptions, initialization and cleanup requirements, and etc.  The function is most importantly a call to <code>runContT</code> which in turn will invoke:</p>
<pre><code>webHandling &lt;- runAPI rtOpts</code></pre>
<p>that sets up all the servicing logic for execution, and then</p>
<pre><code>runSettings settings webHandling</code></pre>
<p>that will create the WAI HTTP listener and starts Servant main request processing logic.</p>
<p>Additionally it defines what happens before, after, how to gracefully shutdown the process, etc, which in this demo is all mock logic.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=c0c68ab8-e79e-4f51-92cb-2105886bf472">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [105]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">listen</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Ropt</span><span class="o">.</span><span class="kt">RunOptions</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="nb">()</span>
<span class="nf">listen</span><span class="w"> </span><span class="n">rtOpts</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">  </span><span class="kr">let</span>
<span class="w">    </span><span class="n">fakeContT</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">ContT</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">bracket</span><span class="w"> </span><span class="p">(</span><span class="n">fakeContFct</span><span class="w"> </span><span class="s">"dummy."</span><span class="p">)</span><span class="w"> </span><span class="n">fakeEndFct</span>
<span class="w">  </span><span class="n">runContT</span><span class="w"> </span><span class="n">fakeContT</span><span class="w"> </span><span class="n">finalAction</span>
<span class="w">  </span><span class="kr">where</span>
<span class="w">  </span><span class="n">finalAction</span><span class="w"> </span><span class="n">dummy</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="kr">let</span><span class="w"> </span><span class="n">shutdownCallback</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">putStrLn</span><span class="w"> </span><span class="s">"@[finalAction] empty termination callback."</span>
<span class="w">        </span><span class="n">settings</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">setupWai</span><span class="w"> </span><span class="n">rtOpts</span><span class="o">.</span><span class="n">webServer</span><span class="o">.</span><span class="n">port</span><span class="w"> </span><span class="n">shutdownCallback</span>
<span class="w">    </span><span class="n">webHandling</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">runAPI</span><span class="w"> </span><span class="n">rtOpts</span>
<span class="w">    </span><span class="kt">Wr</span><span class="o">.</span><span class="n">runSettings</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="n">webHandling</span>

<span class="w">  </span><span class="n">fakeContFct</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="kt">Int</span>
<span class="w">  </span><span class="n">fakeContFct</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="p">(</span><span class="kt">Prelude</span><span class="o">.</span><span class="n">length</span><span class="w"> </span><span class="n">l</span><span class="p">)</span>

<span class="w">  </span><span class="n">fakeEndFct</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">IO</span><span class="w"> </span><span class="nb">()</span>
<span class="w">  </span><span class="n">fakeEndFct</span><span class="w"> </span><span class="n">aNum</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">pure</span><span class="w"> </span><span class="nb">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=0e1fb0f9-8b01-4507-9431-8bf4c3a92a58">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Like for the WAI/Warp example before, running the web service is done in a sub-thread with a call to the <code>forkIO</code> function.  The next lines spawn a full blown web server that is a realistic template for advanced and modern web app implementation:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs" id="cell-id=063df4a5-f5bd-4b15-b26e-371bcc9aafef">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [106]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">defaultRun</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">RunOptions</span>
<span class="nf">defaultRun</span><span class="w"> </span><span class="ow">=</span>
<span class="w">  </span><span class="kt">RunOptions</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">debug</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">webServer</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">WebServerOptions</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">port</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="mi">8180</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="s">"localhost"</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">jwkConfFile</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Nothing</span>
<span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">corsPolicy</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="kt">Nothing</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=d06cef6b-9b4c-4b3f-9b3d-1e42cb8ebdcd">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [107]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="nf">tid</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="kt">Cc</span><span class="o">.</span><span class="n">forkIO</span><span class="w"> </span><span class="p">(</span><span class="n">listen</span><span class="w"> </span><span class="n">defaultRun</span><span class="p">)</span>
<span class="kt">:!</span><span class="w"> </span><span class="n">date</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Wed May 22 02:56:58 PM +04 2024</pre>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=f51bf345-a67e-42c4-a486-c59e162101df">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [218]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kt">Cc</span><span class="o">.</span><span class="n">killThread</span><span class="w"> </span><span class="n">tid</span>
<span class="kt">:!</span><span class="w"> </span><span class="n">date</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="text/plain" tabindex="0">
<pre>Wed May 22 01:49:23 PM +04 2024</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=e3aaaa61-8bb8-4c22-a784-00461708621d">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p><span class="text-red-700">STOP HERE FOR NOW.</span></p>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=1adb46ba-bdbf-40db-81d4-235a704ce094">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<p>Let's use the route definition defined in the previous example to generate automatically a client for the API:</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell" id="cell-id=8081e5c6-1271-4fec-bfa1-f7a4c88b0d4a">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In [ ]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor" data-type="inline">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-Haskell"><pre><span></span><span class="kr">import</span><span class="w"> </span><span class="nn">Servant.Client</span>
<span class="kr">import</span><span class="w"> </span><span class="nn">Servant.Client.Core.Request</span>

<span class="kr">instance</span><span class="w"> </span><span class="kt">HasClient</span><span class="w"> </span><span class="kt">ClientM</span><span class="w"> </span><span class="kt">WebSocket</span><span class="w"> </span><span class="kr">where</span>
<span class="w">  </span><span class="kr">type</span><span class="w"> </span><span class="kt">Client</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">(</span><span class="kt">Stream</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="n">framing</span><span class="w"> </span><span class="n">ct</span><span class="w"> </span><span class="p">(</span><span class="kt">Headers</span><span class="w"> </span><span class="n">hs</span><span class="w"> </span><span class="n">a</span><span class="p">))</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">(</span><span class="kt">Headers</span><span class="w"> </span><span class="n">hs</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>

<span class="w">  </span><span class="n">hoistClientMonad</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="kr">_</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">ma</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="n">ma</span>

<span class="w">  </span><span class="n">clientWithRoute</span><span class="w"> </span><span class="n">_pm</span><span class="w"> </span><span class="kt">Proxy</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">withStreamingRequest</span><span class="w"> </span><span class="n">req'</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="nf">\</span><span class="n">gres</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kr">do</span>
<span class="w">      </span><span class="kr">let</span><span class="w"> </span><span class="n">mimeUnrender'</span><span class="w">    </span><span class="ow">=</span><span class="w"> </span><span class="n">mimeUnrender</span><span class="w"> </span><span class="p">(</span><span class="kt">Proxy</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Proxy</span><span class="w"> </span><span class="n">ct</span><span class="p">)</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">LBS</span><span class="o">.</span><span class="kt">ByteString</span><span class="w"> </span><span class="ow">-&gt;</span><span class="w"> </span><span class="kt">Either</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="n">chunk</span>
<span class="w">          </span><span class="n">framingUnrender'</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">framingUnrender</span><span class="w"> </span><span class="p">(</span><span class="kt">Proxy</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Proxy</span><span class="w"> </span><span class="n">framing</span><span class="p">)</span><span class="w"> </span><span class="n">mimeUnrender'</span>
<span class="w">      </span><span class="n">val</span><span class="w"> </span><span class="ow">&lt;-</span><span class="w"> </span><span class="n">fromSourceIO</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">framingUnrender'</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">responseBody</span><span class="w"> </span><span class="n">gres</span>
<span class="w">      </span><span class="n">return</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="kt">Headers</span>
<span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="n">getResponse</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">val</span>
<span class="w">        </span><span class="p">,</span><span class="w"> </span><span class="n">getHeadersHList</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">buildHeadersTo</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="n">toList</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">responseHeaders</span><span class="w"> </span><span class="n">gres</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="kr">where</span>
<span class="w">      </span><span class="n">req'</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">req</span>
<span class="w">          </span><span class="p">{</span><span class="w"> </span><span class="n">requestAccept</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">fromList</span><span class="w"> </span><span class="p">[</span><span class="n">contentType</span><span class="w"> </span><span class="p">(</span><span class="kt">Proxy</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Proxy</span><span class="w"> </span><span class="n">ct</span><span class="p">)]</span>
<span class="w">          </span><span class="p">,</span><span class="w"> </span><span class="n">requestMethod</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">reflectMethod</span><span class="w"> </span><span class="p">(</span><span class="kt">Proxy</span><span class="w"> </span><span class="ow">::</span><span class="w"> </span><span class="kt">Proxy</span><span class="w"> </span><span class="n">method</span><span class="p">)</span>
<span class="w">          </span><span class="p">}</span>

<span class="nf">loginC</span><span class="w"> </span><span class="kt">:&lt;|&gt;</span><span class="w"> </span><span class="n">staticC</span><span class="w"> </span><span class="kt">:&lt;|&gt;</span><span class="w"> </span><span class="n">streamC</span><span class="w"> </span><span class="kt">:&lt;|&gt;</span><span class="w"> </span><span class="n">homeC</span><span class="w"> </span><span class="kt">:&lt;|&gt;</span><span class="w"> </span><span class="n">searchC</span><span class="w"> </span><span class="kt">:&lt;|&gt;</span><span class="w"> </span><span class="n">privStaticC</span><span class="w"> </span><span class="ow">=</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">serverApiProxy</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="jp-Cell-outputWrapper">
<div class="jp-Collapser jp-OutputCollapser jp-Cell-outputCollapser">
</div>
<div class="jp-OutputArea jp-Cell-outputArea">
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedHTMLCommon jp-RenderedHTML jp-OutputArea-output" data-mime-type="text/html" tabindex="0">
<style>/* Styles used for the Hoogle display in the pager */
.hoogle-doc {
display: block;
padding-bottom: 1.3em;
padding-left: 0.4em;
}
.hoogle-code {
display: block;
font-family: monospace;
white-space: pre;
}
.hoogle-text {
display: block;
}
.hoogle-name {
color: green;
font-weight: bold;
}
.hoogle-head {
font-weight: bold;
}
.hoogle-sub {
display: block;
margin-left: 0.4em;
}
.hoogle-package {
font-weight: bold;
font-style: italic;
}
.hoogle-module {
font-weight: bold;
}
.hoogle-class {
font-weight: bold;
}

.get-type {
color: green;
font-weight: bold;
font-family: monospace;
display: block;
white-space: pre-wrap;
}
.show-type {
color: green;
font-weight: bold;
font-family: monospace;
margin-left: 1em;
}
.mono {
font-family: monospace;
display: block;
}
.err-msg {
color: red;
font-style: italic;
font-family: monospace;
white-space: pre;
display: block;
}
#unshowable {
color: red;
font-weight: bold;
}
.err-msg.in.collapse {
padding-top: 0.7em;
}

.highlight-code {
white-space: pre;
font-family: monospace;
}

.suggestion-warning {
font-weight: bold;
color: rgb(200, 130, 0);
}
.suggestion-error {
font-weight: bold;
color: red;
}
.suggestion-name {
font-weight: bold;
}

</style><div class="suggestion-name" style="clear:both;">Eta reduce</div><div class="suggestion-row" style="float: left;"><div class="suggestion-warning">Found:</div><div class="highlight-code" id="haskell">hoistClientMonad _ _ f ma = f ma</div></div><div class="suggestion-row" style="float: left;"><div class="suggestion-warning">Why Not:</div><div class="highlight-code" id="haskell">hoistClientMonad _ _ f = f</div></div>
</div>
</div>
<div class="jp-OutputArea-child">
<div class="jp-OutputPrompt jp-OutputArea-prompt"></div>
<div class="jp-RenderedText jp-OutputArea-output" data-mime-type="application/vnd.jupyter.stderr" tabindex="0">
<pre>
&lt;interactive&gt;:2:3: error:
    • Type indexes must match class instance head
      Expected: Client ClientM WebSocket
        Actual: Client m (Stream method status framing ct (Headers hs a))
    • In the type instance declaration for ‘Client’
      In the instance declaration for ‘HasClient ClientM WebSocket’</pre>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=2a8522f8-41a4-41c1-9e6b-cce16e7756d9">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1 id=""><a class="anchor-link" href="#">¶</a></h1>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell" id="cell-id=e9b6e542-2e88-44fa-80a2-736d5f2fa384">
<div class="jp-Cell-inputWrapper" tabindex="0">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput" data-mime-type="text/markdown">
<h1>References</h1>
<ul>
<li><a href="https://github.com/EvanLi/Github-Ranking">GitHub Top 100</a></li>
<li><a href="https://codepen.io/orvilleChomer/pen/mYBJzE">Youtube Embedding</a></li>
<li><a href="https://github.com/IHaskell/IHaskell">IHaskell Kernel for Jupyter</a></li>
</ul>
</div>
</div>
</div>
</div>


</div>
</div></main>
</body>
</html>
